{"pageId":"/pages/docs","routeParams":{"splat":"guides/shutdown-handling"},"data":{"doc":{"path":"/docs/guides/shutdown-handling","filePath":"/home/runner/work/isolated-workers/isolated-workers/docs/guides/shutdown-handling.md","title":"Shutdown Handling","description":"Configure how workers handle unexpected crashes and shutdowns","nav":{"section":"Configuration","order":4}},"segments":[{"type":"html","html":"<h1>Unexpected Shutdown Handling</h1>\n<p>Workers can crash unexpectedly due to out-of-memory errors, <code class=\"inline-code\">SIGKILL</code> signals, or other hard crashes. This guide explains how isolated-workers detects crashes, configures recovery strategies, and handles pending operations.</p>\n<h2>What is Unexpected Shutdown?</h2>\n<p>An unexpected shutdown occurs when a worker process terminates without going through the normal close procedure:</p>\n<p><strong>Common causes:</strong></p>\n<ul>\n<li><strong>Out-of-memory (OOM) crashes</strong> - Worker exceeds memory limits</li>\n<li><strong>SIGKILL</strong> - Process forcibly killed (e.g., <code class=\"inline-code\">kill -9</code>)</li>\n<li><strong>Segmentation faults</strong> - Native code crashes</li>\n<li><strong>Unhandled exceptions</strong> - Uncaught errors that terminate the process</li>\n</ul>\n<p><strong>Detection:</strong>\nisolated-workers listens to process exit events, which fire reliably for all crash types—including OOM kills that might not trigger socket errors.</p>\n<h2>Default Behavior</h2>\n<p>By default, pending operations are rejected immediately when a worker crashes unexpectedly:</p>"},{"type":"code-block","language":"typescript","content":"import { createWorker } from 'isolated-workers';\n\nconst worker = await createWorker<MyMessages>({\n  script: './worker.js',\n  // unexpectedShutdown defaults to: { strategy: 'reject' }\n});\n\ntry {\n  await worker.send('processData', { largeData });\n} catch (error) {\n  // Worker crashed during processing - request is rejected\n  console.error('Worker crashed:', error.message);\n}","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { <a href=\"/isolated-workers/api/create-worker\" class=\"code-link\" title=\"View createWorker documentation\">createWorker</a> } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'isolated-workers'</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> worker</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/create-worker\" class=\"code-link\" title=\"View createWorker documentation\">createWorker</a></span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">MyMessages</span><span style=\"color:#E1E4E8\">>({</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  script: </span><span style=\"color:#9ECBFF\">'./worker.js'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // unexpectedShutdown defaults to: { strategy: 'reject' }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">});</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">try</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  await</span><span style=\"color:#E1E4E8\"> worker.</span><span style=\"color:#B392F0\">send</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'processData'</span><span style=\"color:#E1E4E8\">, { largeData });</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">} </span><span style=\"color:#F97583\">catch</span><span style=\"color:#E1E4E8\"> (error) {</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Worker crashed during processing - request is rejected</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  console.</span><span style=\"color:#B392F0\">error</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'Worker crashed:'</span><span style=\"color:#E1E4E8\">, error.message);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>"},{"type":"html","html":"<h2>Configuration Strategies</h2>\n<p>isol-workers supports two strategies for handling unexpected shutdowns:</p>\n<h3>1. Reject Strategy (Default)</h3>\n<p>Immediately reject all pending operations when a crash is detected. Use this for non-idempotent operations where retrying could cause duplicate work or corruption.</p>"},{"type":"code-block","language":"typescript","content":"const worker = await createWorker<MyMessages>({\n  script: './worker.js',\n  unexpectedShutdown: {\n    strategy: 'reject',\n  },\n});","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> worker</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/create-worker\" class=\"code-link\" title=\"View createWorker documentation\">createWorker</a></span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">MyMessages</span><span style=\"color:#E1E4E8\">>({</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  script: </span><span style=\"color:#9ECBFF\">'./worker.js'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  unexpectedShutdown: {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    strategy: </span><span style=\"color:#9ECBFF\">'reject'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  },</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">});</span></span></code></pre>"},{"type":"html","html":"<h3>2. Retry Strategy</h3>\n<p>Automatically retry failed operations up to a specified number of attempts. Use this for idempotent operations that can be safely retried.</p>"},{"type":"code-block","language":"typescript","content":"const worker = await createWorker<MyMessages>({\n  script: './worker.js',\n  unexpectedShutdown: {\n    strategy: 'retry',\n    attempts: 3, // Optional: defaults to 1\n  },\n});","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> worker</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/create-worker\" class=\"code-link\" title=\"View createWorker documentation\">createWorker</a></span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">MyMessages</span><span style=\"color:#E1E4E8\">>({</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  script: </span><span style=\"color:#9ECBFF\">'./worker.js'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  unexpectedShutdown: {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    strategy: </span><span style=\"color:#9ECBFF\">'retry'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    attempts: </span><span style=\"color:#79B8FF\">3</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#6A737D\">// Optional: defaults to 1</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  },</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">});</span></span></code></pre>"},{"type":"html","html":"<h3>Per-Message-Type Overrides</h3>\n<p>Configure different strategies for different message types:</p>"},{"type":"code-block","language":"typescript","content":"const worker = await createWorker<MyMessages>({\n  script: './worker.js',\n  unexpectedShutdown: {\n    strategy: 'reject', // Default for all message types\n    processData: { strategy: 'retry', attempts: 3 }, // Idempotent - retry up to 3 times\n    deleteRecord: { strategy: 'reject' }, // Non-idempotent - reject immediately\n    fetchRemote: { strategy: 'retry' }, // Uses default of 1 attempt\n  },\n});","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> worker</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/create-worker\" class=\"code-link\" title=\"View createWorker documentation\">createWorker</a></span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">MyMessages</span><span style=\"color:#E1E4E8\">>({</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  script: </span><span style=\"color:#9ECBFF\">'./worker.js'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  unexpectedShutdown: {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    strategy: </span><span style=\"color:#9ECBFF\">'reject'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#6A737D\">// Default for all message types</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    processData: { strategy: </span><span style=\"color:#9ECBFF\">'retry'</span><span style=\"color:#E1E4E8\">, attempts: </span><span style=\"color:#79B8FF\">3</span><span style=\"color:#E1E4E8\"> }, </span><span style=\"color:#6A737D\">// Idempotent - retry up to 3 times</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    deleteRecord: { strategy: </span><span style=\"color:#9ECBFF\">'reject'</span><span style=\"color:#E1E4E8\"> }, </span><span style=\"color:#6A737D\">// Non-idempotent - reject immediately</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    fetchRemote: { strategy: </span><span style=\"color:#9ECBFF\">'retry'</span><span style=\"color:#E1E4E8\"> }, </span><span style=\"color:#6A737D\">// Uses default of 1 attempt</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  },</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">});</span></span></code></pre>"},{"type":"html","html":"<h2>Type-Safe Configuration</h2>\n<p>The <code class=\"inline-code\">UnexpectedShutdownConfig<t></t></code> type provides autocomplete for your message types:</p>"},{"type":"code-block","language":"typescript","content":"import { createWorker, type UnexpectedShutdownConfig } from 'isolated-workers';\n\nconst shutdownConfig: UnexpectedShutdownConfig<Messages> = {\n  strategy: 'reject',\n  processData: { strategy: 'retry', attempts: 3 }, // ← Autocomplete for your message types\n  safeQuery: { strategy: 'retry' },\n};","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { <a href=\"/isolated-workers/api/create-worker\" class=\"code-link\" title=\"View createWorker documentation\">createWorker</a>, </span><span style=\"color:#F97583\">type</span><span style=\"color:#E1E4E8\"> <a href=\"/isolated-workers/api/unexpected-shutdown-config\" class=\"code-link\" title=\"View UnexpectedShutdownConfig documentation\">UnexpectedShutdownConfig</a> } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'isolated-workers'</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> shutdownConfig</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/unexpected-shutdown-config\" class=\"code-link\" title=\"View UnexpectedShutdownConfig documentation\">UnexpectedShutdownConfig</a></span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">Messages</span><span style=\"color:#E1E4E8\">> </span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  strategy: </span><span style=\"color:#9ECBFF\">'reject'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  processData: { strategy: </span><span style=\"color:#9ECBFF\">'retry'</span><span style=\"color:#E1E4E8\">, attempts: </span><span style=\"color:#79B8FF\">3</span><span style=\"color:#E1E4E8\"> }, </span><span style=\"color:#6A737D\">// ← Autocomplete for your message types</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  safeQuery: { strategy: </span><span style=\"color:#9ECBFF\">'retry'</span><span style=\"color:#E1E4E8\"> },</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">};</span></span></code></pre>"},{"type":"html","html":"<h2>Error Handling</h2>\n<p>When a worker crashes, operations are rejected with a <code class=\"inline-code\"><a class=\"code-link\" href=\"/isolated-workers/isolated-workers/api/worker-crashed-error\">WorkerCrashedError</a></code> containing rich context:</p>\n<h3>WorkerCrashedError Properties</h3>"},{"type":"code-block","language":"typescript","content":"class WorkerCrashedError extends Error {\n  readonly reason: ShutdownReason; // Why the worker crashed\n  readonly messageType: string; // Which message type was processing\n  readonly attempt: number; // Current attempt number\n  readonly maxAttempts: number; // Maximum configured attempts\n}","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">class</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/worker-crashed-error\" class=\"code-link\" title=\"View WorkerCrashedError documentation\">WorkerCrashedError</a></span><span style=\"color:#F97583\"> extends</span><span style=\"color:#B392F0\"> Error</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  readonly</span><span style=\"color:#FFAB70\"> reason</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/shutdown-reason\" class=\"code-link\" title=\"View ShutdownReason documentation\">ShutdownReason</a></span><span style=\"color:#E1E4E8\">; </span><span style=\"color:#6A737D\">// Why the worker crashed</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  readonly</span><span style=\"color:#FFAB70\"> messageType</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#E1E4E8\">; </span><span style=\"color:#6A737D\">// Which message type was processing</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  readonly</span><span style=\"color:#FFAB70\"> attempt</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> number</span><span style=\"color:#E1E4E8\">; </span><span style=\"color:#6A737D\">// Current attempt number</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  readonly</span><span style=\"color:#FFAB70\"> maxAttempts</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> number</span><span style=\"color:#E1E4E8\">; </span><span style=\"color:#6A737D\">// Maximum configured attempts</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>"},{"type":"html","html":"<h3>ShutdownReason Types</h3>"},{"type":"code-block","language":"typescript","content":"type ShutdownReason =\n  | { type: 'exit'; code: number | null; signal: string | null } // Process exit (code or signal)\n  | { type: 'error'; error: Error } // Socket/IPC error\n  | { type: 'close' }; // Connection closed","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">type</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/shutdown-reason\" class=\"code-link\" title=\"View ShutdownReason documentation\">ShutdownReason</a></span><span style=\"color:#F97583\"> =</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  |</span><span style=\"color:#E1E4E8\"> { </span><span style=\"color:#FFAB70\">type</span><span style=\"color:#F97583\">:</span><span style=\"color:#9ECBFF\"> 'exit'</span><span style=\"color:#E1E4E8\">; </span><span style=\"color:#FFAB70\">code</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> number</span><span style=\"color:#F97583\"> |</span><span style=\"color:#79B8FF\"> null</span><span style=\"color:#E1E4E8\">; </span><span style=\"color:#FFAB70\">signal</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#F97583\"> |</span><span style=\"color:#79B8FF\"> null</span><span style=\"color:#E1E4E8\"> } </span><span style=\"color:#6A737D\">// Process exit (code or signal)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  |</span><span style=\"color:#E1E4E8\"> { </span><span style=\"color:#FFAB70\">type</span><span style=\"color:#F97583\">:</span><span style=\"color:#9ECBFF\"> 'error'</span><span style=\"color:#E1E4E8\">; </span><span style=\"color:#FFAB70\">error</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> Error</span><span style=\"color:#E1E4E8\"> } </span><span style=\"color:#6A737D\">// Socket/IPC error</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  |</span><span style=\"color:#E1E4E8\"> { </span><span style=\"color:#FFAB70\">type</span><span style=\"color:#F97583\">:</span><span style=\"color:#9ECBFF\"> 'close'</span><span style=\"color:#E1E4E8\"> }; </span><span style=\"color:#6A737D\">// Connection closed</span></span></code></pre>"},{"type":"html","html":"<h3>Accessing Error Details</h3>"},{"type":"code-block","language":"typescript","content":"try {\n  await worker.send('processData', { data });\n} catch (error) {\n  if (error instanceof WorkerCrashedError) {\n    console.error('Worker crashed:', error.message);\n    console.error('Processing:', error.messageType);\n    console.error('Attempt:', error.attempt, '/', error.maxAttempts);\n\n    // Access raw shutdown reason\n    if (error.reason.type === 'exit') {\n      console.error('Exit code:', error.reason.code);\n      console.error('Signal:', error.reason.signal); // e.g., 'SIGKILL'\n    }\n  }\n}","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">try</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  await</span><span style=\"color:#E1E4E8\"> worker.</span><span style=\"color:#B392F0\">send</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'processData'</span><span style=\"color:#E1E4E8\">, { data });</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">} </span><span style=\"color:#F97583\">catch</span><span style=\"color:#E1E4E8\"> (error) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  if</span><span style=\"color:#E1E4E8\"> (error </span><span style=\"color:#F97583\">instanceof</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/worker-crashed-error\" class=\"code-link\" title=\"View WorkerCrashedError documentation\">WorkerCrashedError</a></span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    console.</span><span style=\"color:#B392F0\">error</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'Worker crashed:'</span><span style=\"color:#E1E4E8\">, error.message);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    console.</span><span style=\"color:#B392F0\">error</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'Processing:'</span><span style=\"color:#E1E4E8\">, error.messageType);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    console.</span><span style=\"color:#B392F0\">error</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'Attempt:'</span><span style=\"color:#E1E4E8\">, error.attempt, </span><span style=\"color:#9ECBFF\">'/'</span><span style=\"color:#E1E4E8\">, error.maxAttempts);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    // Access raw shutdown reason</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    if</span><span style=\"color:#E1E4E8\"> (error.reason.type </span><span style=\"color:#F97583\">===</span><span style=\"color:#9ECBFF\"> 'exit'</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      console.</span><span style=\"color:#B392F0\">error</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'Exit code:'</span><span style=\"color:#E1E4E8\">, error.reason.code);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      console.</span><span style=\"color:#B392F0\">error</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'Signal:'</span><span style=\"color:#E1E4E8\">, error.reason.signal); </span><span style=\"color:#6A737D\">// e.g., 'SIGKILL'</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>"},{"type":"html","html":"<h3>Error Messages</h3>\n<p>The error message provides context about the crash:</p>\n<ul>\n<li><strong>Immediate reject</strong>: <code class=\"inline-code\">\"Worker crashed unexpectedly while processing 'processData'\"</code></li>\n<li><strong>After retries exhausted</strong>: <code class=\"inline-code\">\"Worker crashed after 3 attempts while processing 'processData'\"</code></li>\n<li><strong>With exit details</strong>: <code class=\"inline-code\">\"Worker crashed (exit code 137, signal SIGKILL) while processing 'processData'\"</code></li>\n</ul>\n<h2>Best Practices</h2>\n<h3>1. Use Retry for Idempotent Operations</h3>\n<p>Idempotent operations can be safely retried without side effects:</p>"},{"type":"code-block","language":"typescript","content":"unexpectedShutdown: {\n  // Idempotent: Can retry safely\n  fetchUser: { strategy: 'retry', attempts: 3 },\n  validateInput: { strategy: 'retry', attempts: 2 },\n\n  // Non-idempotent: Reject to avoid duplicates\n  createPayment: { strategy: 'reject' },\n  sendNotification: { strategy: 'reject' },\n  deleteRecord: { strategy: 'reject' },\n}","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">unexpectedShutdown</span><span style=\"color:#E1E4E8\">: {</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Idempotent: Can retry safely</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  fetchUser</span><span style=\"color:#E1E4E8\">: { </span><span style=\"color:#B392F0\">strategy</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">'retry'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#B392F0\">attempts</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#79B8FF\">3</span><span style=\"color:#E1E4E8\"> },</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  validateInput</span><span style=\"color:#E1E4E8\">: { </span><span style=\"color:#B392F0\">strategy</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">'retry'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#B392F0\">attempts</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#79B8FF\">2</span><span style=\"color:#E1E4E8\"> },</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Non-idempotent: Reject to avoid duplicates</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  createPayment</span><span style=\"color:#E1E4E8\">: { </span><span style=\"color:#B392F0\">strategy</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">'reject'</span><span style=\"color:#E1E4E8\"> },</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  sendNotification</span><span style=\"color:#E1E4E8\">: { </span><span style=\"color:#B392F0\">strategy</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">'reject'</span><span style=\"color:#E1E4E8\"> },</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  deleteRecord</span><span style=\"color:#E1E4E8\">: { </span><span style=\"color:#B392F0\">strategy</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">'reject'</span><span style=\"color:#E1E4E8\"> },</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>"},{"type":"html","html":"<h3>2. Set Appropriate Retry Limits</h3>\n<p>Consider the cost and likelihood of success when setting retry limits:</p>"},{"type":"code-block","language":"typescript","content":"unexpectedShutdown: {\n  // Quick operations: Higher retry count (transient failures)\n  healthCheck: { strategy: 'retry', attempts: 5 },\n\n  // Medium operations: Moderate retries\n  fetchFromCache: { strategy: 'retry', attempts: 3 },\n\n  // Slow operations: Lower retries (startup overhead)\n  processLargeFile: { strategy: 'retry', attempts: 2 },\n}","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">unexpectedShutdown</span><span style=\"color:#E1E4E8\">: {</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Quick operations: Higher retry count (transient failures)</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  healthCheck</span><span style=\"color:#E1E4E8\">: { </span><span style=\"color:#B392F0\">strategy</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">'retry'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#B392F0\">attempts</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#79B8FF\">5</span><span style=\"color:#E1E4E8\"> },</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Medium operations: Moderate retries</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  fetchFromCache</span><span style=\"color:#E1E4E8\">: { </span><span style=\"color:#B392F0\">strategy</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">'retry'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#B392F0\">attempts</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#79B8FF\">3</span><span style=\"color:#E1E4E8\"> },</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Slow operations: Lower retries (startup overhead)</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  processLargeFile</span><span style=\"color:#E1E4E8\">: { </span><span style=\"color:#B392F0\">strategy</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">'retry'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#B392F0\">attempts</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#79B8FF\">2</span><span style=\"color:#E1E4E8\"> },</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>"},{"type":"html","html":"<h3>3. Log Shutdown Details for Debugging</h3>\n<p>Capture shutdown reasons to diagnose crash patterns:</p>"},{"type":"code-block","language":"typescript","content":"try {\n  await worker.send('processData', { data });\n} catch (error) {\n  if (error instanceof WorkerCrashedError) {\n    // Log for monitoring/alerting\n    logger.error('Worker crashed', {\n      messageType: error.messageType,\n      attempt: error.attempt,\n      maxAttempts: error.maxAttempts,\n      reason: error.reason,\n    });\n\n    // Check for OOM kills\n    if (error.reason.type === 'exit' && error.reason.code === 137) {\n      logger.warn('Possible OOM - consider increasing memory limits');\n    }\n  }\n}","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">try</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  await</span><span style=\"color:#E1E4E8\"> worker.</span><span style=\"color:#B392F0\">send</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'processData'</span><span style=\"color:#E1E4E8\">, { data });</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">} </span><span style=\"color:#F97583\">catch</span><span style=\"color:#E1E4E8\"> (error) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  if</span><span style=\"color:#E1E4E8\"> (error </span><span style=\"color:#F97583\">instanceof</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/worker-crashed-error\" class=\"code-link\" title=\"View WorkerCrashedError documentation\">WorkerCrashedError</a></span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    // Log for monitoring/alerting</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    logger.</span><span style=\"color:#B392F0\">error</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'Worker crashed'</span><span style=\"color:#E1E4E8\">, {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      messageType: error.messageType,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      attempt: error.attempt,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      maxAttempts: error.maxAttempts,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      reason: error.reason,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    });</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    // Check for OOM kills</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    if</span><span style=\"color:#E1E4E8\"> (error.reason.type </span><span style=\"color:#F97583\">===</span><span style=\"color:#9ECBFF\"> 'exit'</span><span style=\"color:#F97583\"> &#x26;&#x26;</span><span style=\"color:#E1E4E8\"> error.reason.code </span><span style=\"color:#F97583\">===</span><span style=\"color:#79B8FF\"> 137</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      logger.</span><span style=\"color:#B392F0\">warn</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'Possible OOM - consider increasing memory limits'</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>"},{"type":"html","html":"<h3>4. Handle Expected vs Unexpected Shutdowns</h3>\n<p>The library distinguishes between expected and unexpected shutdowns:</p>\n<ul>\n<li><strong>Expected shutdown</strong>: User calls <code class=\"inline-code\">worker.close()</code> → Pending operations rejected with normal \"Worker closed\" error (no retry logic)</li>\n<li><strong>Unexpected shutdown</strong>: Worker crashes → Operations rejected with <code class=\"inline-code\"><a class=\"code-link\" href=\"/isolated-workers/isolated-workers/api/worker-crashed-error\">WorkerCrashedError</a></code> (retry logic applies)</li>\n</ul>"},{"type":"code-block","language":"typescript","content":"// Expected shutdown - no retry\nawait worker.close();\n\n// Unexpected shutdown - retry logic applies\n// (worker crashes due to OOM, SIGKILL, etc.)","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// Expected shutdown - no retry</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> worker.</span><span style=\"color:#B392F0\">close</span><span style=\"color:#E1E4E8\">();</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Unexpected shutdown - retry logic applies</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// (worker crashes due to OOM, SIGKILL, etc.)</span></span></code></pre>"},{"type":"html","html":"<h2>Complete Configuration Example</h2>"},{"type":"code-block","language":"typescript","content":"import { createWorker } from 'isolated-workers';\nimport type { UnexpectedShutdownConfig } from 'isolated-workers';\n\nconst shutdownConfig: UnexpectedShutdownConfig<MyMessages> = {\n  strategy: 'reject', // Default: reject non-idempotent operations\n\n  // Idempotent read operations - safe to retry\n  fetchData: { strategy: 'retry', attempts: 3 },\n  validateSchema: { strategy: 'retry', attempts: 5 },\n  healthCheck: { strategy: 'retry', attempts: 5 },\n\n  // Idempotent writes with deduplication - can retry\n  upsertRecord: { strategy: 'retry', attempts: 2 },\n\n  // Non-idempotent writes - reject immediately\n  createInvoice: { strategy: 'reject' },\n  chargePayment: { strategy: 'reject' },\n  publishEvent: { strategy: 'reject' },\n};\n\nconst worker = await createWorker<MyMessages>({\n  script: './worker.js',\n  unexpectedShutdown: shutdownConfig,\n  timeout: 60000, // Configure message timeout separately\n});\n\n// Usage with error handling\nasync function processDataSafely(data: unknown) {\n  try {\n    return await worker.send('fetchData', { id: data.id });\n  } catch (error) {\n    if (error instanceof WorkerCrashedError) {\n      console.error(\n        `Worker crashed on attempt ${error.attempt}/${error.maxAttempts}`\n      );\n\n      // Check if we should escalate\n      if (error.reason.type === 'exit' && error.reason.signal === 'SIGKILL') {\n        alert('Worker was forcibly killed - check system resources');\n      }\n\n      throw error; // Re-throw or implement fallback\n    }\n    throw error;\n  }\n}","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { <a href=\"/isolated-workers/api/create-worker\" class=\"code-link\" title=\"View createWorker documentation\">createWorker</a> } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'isolated-workers'</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#F97583\"> type</span><span style=\"color:#E1E4E8\"> { <a href=\"/isolated-workers/api/unexpected-shutdown-config\" class=\"code-link\" title=\"View UnexpectedShutdownConfig documentation\">UnexpectedShutdownConfig</a> } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'isolated-workers'</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> shutdownConfig</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/unexpected-shutdown-config\" class=\"code-link\" title=\"View UnexpectedShutdownConfig documentation\">UnexpectedShutdownConfig</a></span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">MyMessages</span><span style=\"color:#E1E4E8\">> </span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  strategy: </span><span style=\"color:#9ECBFF\">'reject'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#6A737D\">// Default: reject non-idempotent operations</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Idempotent read operations - safe to retry</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  fetchData: { strategy: </span><span style=\"color:#9ECBFF\">'retry'</span><span style=\"color:#E1E4E8\">, attempts: </span><span style=\"color:#79B8FF\">3</span><span style=\"color:#E1E4E8\"> },</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  validateSchema: { strategy: </span><span style=\"color:#9ECBFF\">'retry'</span><span style=\"color:#E1E4E8\">, attempts: </span><span style=\"color:#79B8FF\">5</span><span style=\"color:#E1E4E8\"> },</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  healthCheck: { strategy: </span><span style=\"color:#9ECBFF\">'retry'</span><span style=\"color:#E1E4E8\">, attempts: </span><span style=\"color:#79B8FF\">5</span><span style=\"color:#E1E4E8\"> },</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Idempotent writes with deduplication - can retry</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  upsertRecord: { strategy: </span><span style=\"color:#9ECBFF\">'retry'</span><span style=\"color:#E1E4E8\">, attempts: </span><span style=\"color:#79B8FF\">2</span><span style=\"color:#E1E4E8\"> },</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Non-idempotent writes - reject immediately</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  createInvoice: { strategy: </span><span style=\"color:#9ECBFF\">'reject'</span><span style=\"color:#E1E4E8\"> },</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  chargePayment: { strategy: </span><span style=\"color:#9ECBFF\">'reject'</span><span style=\"color:#E1E4E8\"> },</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  publishEvent: { strategy: </span><span style=\"color:#9ECBFF\">'reject'</span><span style=\"color:#E1E4E8\"> },</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> worker</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/create-worker\" class=\"code-link\" title=\"View createWorker documentation\">createWorker</a></span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">MyMessages</span><span style=\"color:#E1E4E8\">>({</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  script: </span><span style=\"color:#9ECBFF\">'./worker.js'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  unexpectedShutdown: shutdownConfig,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  timeout: </span><span style=\"color:#79B8FF\">60000</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#6A737D\">// Configure message timeout separately</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">});</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Usage with error handling</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">async</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> processDataSafely</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">data</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> unknown</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  try</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> worker.</span><span style=\"color:#B392F0\">send</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'fetchData'</span><span style=\"color:#E1E4E8\">, { id: data.id });</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  } </span><span style=\"color:#F97583\">catch</span><span style=\"color:#E1E4E8\"> (error) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    if</span><span style=\"color:#E1E4E8\"> (error </span><span style=\"color:#F97583\">instanceof</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/worker-crashed-error\" class=\"code-link\" title=\"View WorkerCrashedError documentation\">WorkerCrashedError</a></span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      console.</span><span style=\"color:#B392F0\">error</span><span style=\"color:#E1E4E8\">(</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">        `Worker crashed on attempt ${</span><span style=\"color:#E1E4E8\">error</span><span style=\"color:#9ECBFF\">.</span><span style=\"color:#E1E4E8\">attempt</span><span style=\"color:#9ECBFF\">}/${</span><span style=\"color:#E1E4E8\">error</span><span style=\"color:#9ECBFF\">.</span><span style=\"color:#E1E4E8\">maxAttempts</span><span style=\"color:#9ECBFF\">}`</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      );</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">      // Check if we should escalate</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">      if</span><span style=\"color:#E1E4E8\"> (error.reason.type </span><span style=\"color:#F97583\">===</span><span style=\"color:#9ECBFF\"> 'exit'</span><span style=\"color:#F97583\"> &#x26;&#x26;</span><span style=\"color:#E1E4E8\"> error.reason.signal </span><span style=\"color:#F97583\">===</span><span style=\"color:#9ECBFF\"> 'SIGKILL'</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">        alert</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'Worker was forcibly killed - check system resources'</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">      throw</span><span style=\"color:#E1E4E8\"> error; </span><span style=\"color:#6A737D\">// Re-throw or implement fallback</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    }</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    throw</span><span style=\"color:#E1E4E8\"> error;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>"},{"type":"html","html":"<h2>API Reference</h2>\n<h3>WorkerOptions.unexpectedShutdown</h3>\n<p>Optional configuration for handling unexpected worker shutdowns.</p>\n<p><strong>Type:</strong> <code class=\"inline-code\">UnexpectedShutdownConfig<t> | undefined</t></code></p>\n<p><strong>Default:</strong> <code class=\"inline-code\">{ strategy: 'reject' }</code></p>\n<h3>UnexpectedShutdownStrategy</h3>\n<p>Strategy for handling operations when a worker crashes.</p>"},{"type":"code-block","language":"typescript","content":"type UnexpectedShutdownStrategy =\n  | { strategy: 'reject' } // Reject pending operations immediately\n  | { strategy: 'retry'; attempts?: number }; // Retry operations (default: 1 attempt)","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">type</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/unexpected-shutdown-strategy\" class=\"code-link\" title=\"View UnexpectedShutdownStrategy documentation\">UnexpectedShutdownStrategy</a></span><span style=\"color:#F97583\"> =</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  |</span><span style=\"color:#E1E4E8\"> { </span><span style=\"color:#FFAB70\">strategy</span><span style=\"color:#F97583\">:</span><span style=\"color:#9ECBFF\"> 'reject'</span><span style=\"color:#E1E4E8\"> } </span><span style=\"color:#6A737D\">// Reject pending operations immediately</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  |</span><span style=\"color:#E1E4E8\"> { </span><span style=\"color:#FFAB70\">strategy</span><span style=\"color:#F97583\">:</span><span style=\"color:#9ECBFF\"> 'retry'</span><span style=\"color:#E1E4E8\">; </span><span style=\"color:#FFAB70\">attempts</span><span style=\"color:#F97583\">?:</span><span style=\"color:#79B8FF\"> number</span><span style=\"color:#E1E4E8\"> }; </span><span style=\"color:#6A737D\">// Retry operations (default: 1 attempt)</span></span></code></pre>"},{"type":"html","html":"<h3>UnexpectedShutdownConfig<t></t></h3>\n<p>Worker-level shutdown strategy with optional per-message-type overrides.</p>"},{"type":"code-block","language":"typescript","content":"type UnexpectedShutdownConfig<T extends MessageDefinitions> =\n  UnexpectedShutdownStrategy & {\n    [K in MessageType<T>]?: UnexpectedShutdownStrategy;\n  };","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">type</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/unexpected-shutdown-config\" class=\"code-link\" title=\"View UnexpectedShutdownConfig documentation\">UnexpectedShutdownConfig</a></span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">T</span><span style=\"color:#F97583\"> extends</span><span style=\"color:#B392F0\"> MessageDefinitions</span><span style=\"color:#E1E4E8\">> </span><span style=\"color:#F97583\">=</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  <a href=\"/isolated-workers/api/unexpected-shutdown-strategy\" class=\"code-link\" title=\"View UnexpectedShutdownStrategy documentation\">UnexpectedShutdownStrategy</a></span><span style=\"color:#F97583\"> &#x26;</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    [</span><span style=\"color:#B392F0\">K</span><span style=\"color:#F97583\"> in</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/message-type\" class=\"code-link\" title=\"View MessageType documentation\">MessageType</a></span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">T</span><span style=\"color:#E1E4E8\">>]</span><span style=\"color:#F97583\">?:</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/unexpected-shutdown-strategy\" class=\"code-link\" title=\"View UnexpectedShutdownStrategy documentation\">UnexpectedShutdownStrategy</a></span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  };</span></span></code></pre>"},{"type":"html","html":"<h3>WorkerCrashedError</h3>\n<p>Error thrown when a worker crashes during operation processing.</p>"},{"type":"code-block","language":"typescript","content":"class WorkerCrashedError extends Error {\n  readonly reason: ShutdownReason; // Crash details\n  readonly messageType: string; // Message type being processed\n  readonly attempt: number; // Current attempt number\n  readonly maxAttempts: number; // Maximum configured attempts\n}","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">class</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/worker-crashed-error\" class=\"code-link\" title=\"View WorkerCrashedError documentation\">WorkerCrashedError</a></span><span style=\"color:#F97583\"> extends</span><span style=\"color:#B392F0\"> Error</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  readonly</span><span style=\"color:#FFAB70\"> reason</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/shutdown-reason\" class=\"code-link\" title=\"View ShutdownReason documentation\">ShutdownReason</a></span><span style=\"color:#E1E4E8\">; </span><span style=\"color:#6A737D\">// Crash details</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  readonly</span><span style=\"color:#FFAB70\"> messageType</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#E1E4E8\">; </span><span style=\"color:#6A737D\">// Message type being processed</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  readonly</span><span style=\"color:#FFAB70\"> attempt</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> number</span><span style=\"color:#E1E4E8\">; </span><span style=\"color:#6A737D\">// Current attempt number</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  readonly</span><span style=\"color:#FFAB70\"> maxAttempts</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> number</span><span style=\"color:#E1E4E8\">; </span><span style=\"color:#6A737D\">// Maximum configured attempts</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>"},{"type":"html","html":"<h3>ShutdownReason</h3>\n<p>Details about why a worker shut down.</p>"},{"type":"code-block","language":"typescript","content":"type ShutdownReason =\n  | { type: 'exit'; code: number | null; signal: string | null }\n  | { type: 'error'; error: Error }\n  | { type: 'close' };","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">type</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/shutdown-reason\" class=\"code-link\" title=\"View ShutdownReason documentation\">ShutdownReason</a></span><span style=\"color:#F97583\"> =</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  |</span><span style=\"color:#E1E4E8\"> { </span><span style=\"color:#FFAB70\">type</span><span style=\"color:#F97583\">:</span><span style=\"color:#9ECBFF\"> 'exit'</span><span style=\"color:#E1E4E8\">; </span><span style=\"color:#FFAB70\">code</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> number</span><span style=\"color:#F97583\"> |</span><span style=\"color:#79B8FF\"> null</span><span style=\"color:#E1E4E8\">; </span><span style=\"color:#FFAB70\">signal</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#F97583\"> |</span><span style=\"color:#79B8FF\"> null</span><span style=\"color:#E1E4E8\"> }</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  |</span><span style=\"color:#E1E4E8\"> { </span><span style=\"color:#FFAB70\">type</span><span style=\"color:#F97583\">:</span><span style=\"color:#9ECBFF\"> 'error'</span><span style=\"color:#E1E4E8\">; </span><span style=\"color:#FFAB70\">error</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> Error</span><span style=\"color:#E1E4E8\"> }</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  |</span><span style=\"color:#E1E4E8\"> { </span><span style=\"color:#FFAB70\">type</span><span style=\"color:#F97583\">:</span><span style=\"color:#9ECBFF\"> 'close'</span><span style=\"color:#E1E4E8\"> };</span></span></code></pre>"},{"type":"html","html":"<h2>See Also</h2>\n<ul>\n<li><a href=\"/isolated-workers/docs/guides/error-handling\">Error Handling</a> - Error propagation patterns</li>\n<li><a href=\"/isolated-workers/docs/guides/timeout-configuration\">Timeout Configuration</a> - Configure operation timeouts</li>\n<li><a href=\"/isolated-workers/docs/guides/worker-lifecycle\">Worker Lifecycle</a> - Managing worker state and cleanup</li>\n</ul>"}]}}