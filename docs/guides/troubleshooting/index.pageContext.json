{"pageId":"/pages/docs","routeParams":{"splat":"guides/troubleshooting"},"data":{"doc":{"path":"/docs/guides/troubleshooting","filePath":"/home/runner/work/isolated-workers/isolated-workers/docs/guides/troubleshooting.md","title":"Troubleshooting","description":"Common issues and how to resolve them","nav":{"section":"Guides","order":7}},"segments":[{"type":"html","html":"<h1>Troubleshooting</h1>\n<p>This guide covers common issues you may encounter when using isolated-workers and how to resolve them.</p>\n<h2>Connection Errors</h2>\n<h3>Worker Failed to Start</h3>\n<p><strong>Problem</strong>: <code class=\"inline-code\"><a class=\"code-link\" href=\"/isolated-workers/isolated-workers/api/create-worker\">createWorker</a></code> throws an error indicating the worker failed to start.</p>\n<p><strong>Cause</strong>: This typically occurs when:</p>\n<ul>\n<li>The script path is incorrect or the file doesn't exist</li>\n<li>The worker script has syntax errors</li>\n<li>The Node.js executable can't be found</li>\n<li>The script file doesn't have execute permissions</li>\n</ul>\n<p><strong>Solution</strong>: Verify your script path and ensure the file exists and is valid JavaScript/TypeScript.</p>"},{"type":"code-block","language":"typescript","content":"import { createWorker } from 'isolated-workers';\nimport { resolve } from 'path';\n\n// Use absolute paths to avoid path resolution issues\nconst worker = await createWorker<Messages>({\n  script: resolve(__dirname, './worker.js'),\n});","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { <a href=\"/isolated-workers/api/create-worker\" class=\"code-link\" title=\"View createWorker documentation\">createWorker</a> } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'isolated-workers'</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { resolve } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'path'</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Use absolute paths to avoid path resolution issues</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> worker</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/create-worker\" class=\"code-link\" title=\"View createWorker documentation\">createWorker</a></span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">Messages</span><span style=\"color:#E1E4E8\">>({</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  script: </span><span style=\"color:#B392F0\">resolve</span><span style=\"color:#E1E4E8\">(__dirname, </span><span style=\"color:#9ECBFF\">'./worker.js'</span><span style=\"color:#E1E4E8\">),</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">});</span></span></code></pre>"},{"type":"html","html":"<p><strong>Debugging Steps</strong>:</p>\n<ol>\n<li>Try running the worker script directly: <code class=\"inline-code\">node ./worker.js</code></li>\n<li>Check for syntax errors in your IDE or with <code class=\"inline-code\">node --check ./worker.js</code></li>\n<li>Ensure the path is absolute or correctly relative to the current working directory</li>\n</ol>\n<h3>Connection Timeout</h3>\n<p><strong>Problem</strong>: Worker starts but connection times out with \"Connection timeout\" or similar error.</p>\n<p><strong>Cause</strong>: The worker process started but didn't establish an IPC connection. This usually means the worker script doesn't call <code class=\"inline-code\"><a class=\"code-link\" href=\"/isolated-workers/isolated-workers/api/start-worker-server\">startWorkerServer</a></code>.</p>\n<p><strong>Solution</strong>: Ensure your worker script calls <code class=\"inline-code\"><a class=\"code-link\" href=\"/isolated-workers/isolated-workers/api/start-worker-server\">startWorkerServer</a></code> at the top level:</p>"},{"type":"code-block","language":"typescript","content":"// worker.ts - CORRECT\nimport { startWorkerServer } from 'isolated-workers';\n\nstartWorkerServer<Messages>({\n  handlers: {\n    // your handlers\n  },\n});","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// worker.ts - CORRECT</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { <a href=\"/isolated-workers/api/start-worker-server\" class=\"code-link\" title=\"View startWorkerServer documentation\">startWorkerServer</a> } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'isolated-workers'</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B392F0\"><a href=\"/isolated-workers/api/start-worker-server\" class=\"code-link\" title=\"View startWorkerServer documentation\">startWorkerServer</a></span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">Messages</span><span style=\"color:#E1E4E8\">>({</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  handlers: {</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    // your handlers</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  },</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">});</span></span></code></pre>"},{"type":"html","html":"<p>Common mistakes to avoid:</p>"},{"type":"code-block","language":"typescript","content":"// WRONG - startWorkerServer inside async function that's never called\nasync function main() {\n  startWorkerServer<Messages>({ handlers: {} });\n}\n\n// WRONG - conditional that might not execute\nif (process.env.SOME_VAR) {\n  startWorkerServer<Messages>({ handlers: {} });\n}","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// WRONG - <a href=\"/isolated-workers/api/start-worker-server\" class=\"code-link\" title=\"View startWorkerServer documentation\">startWorkerServer</a> inside async function that's never called</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">async</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> main</span><span style=\"color:#E1E4E8\">() {</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  <a href=\"/isolated-workers/api/start-worker-server\" class=\"code-link\" title=\"View startWorkerServer documentation\">startWorkerServer</a></span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">Messages</span><span style=\"color:#E1E4E8\">>({ handlers: {} });</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// WRONG - conditional that might not execute</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">if</span><span style=\"color:#E1E4E8\"> (process.env.</span><span style=\"color:#79B8FF\">SOME_VAR</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  <a href=\"/isolated-workers/api/start-worker-server\" class=\"code-link\" title=\"View startWorkerServer documentation\">startWorkerServer</a></span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">Messages</span><span style=\"color:#E1E4E8\">>({ handlers: {} });</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>"},{"type":"html","html":"<h3>Socket Permission Issues</h3>\n<p><strong>Problem</strong>: Error messages about socket permissions or \"EACCES\" errors.</p>\n<p><strong>Cause</strong>: On Unix systems, socket files are created in a temporary directory. Permission issues can occur if:</p>\n<ul>\n<li>The temp directory has restrictive permissions</li>\n<li>A previous socket file wasn't cleaned up and is owned by a different user</li>\n<li>SELinux or AppArmor policies are blocking socket creation</li>\n</ul>\n<p><strong>Solution</strong>:</p>\n<ol>\n<li>Check temp directory permissions:</li>\n</ol>"},{"type":"code-block","language":"bash","content":"ls -la /tmp","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">ls</span><span style=\"color:#79B8FF\"> -la</span><span style=\"color:#9ECBFF\"> /tmp</span></span></code></pre>"},{"type":"html","html":"<ol start=\"2\">\n<li>Clean up stale socket files:</li>\n</ol>"},{"type":"code-block","language":"bash","content":"rm -f /tmp/isolated-workers-*","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">rm</span><span style=\"color:#79B8FF\"> -f</span><span style=\"color:#9ECBFF\"> /tmp/isolated-workers-</span><span style=\"color:#79B8FF\">*</span></span></code></pre>"},{"type":"html","html":"<ol start=\"3\">\n<li>Specify a custom socket path with proper permissions:</li>\n</ol>"},{"type":"code-block","language":"typescript","content":"const worker = await createWorker<Messages>({\n  script: './worker.js',\n  socketPath: '/path/to/socket.sock', // Optional - defaults to auto-generated path\n});","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> worker</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/create-worker\" class=\"code-link\" title=\"View createWorker documentation\">createWorker</a></span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">Messages</span><span style=\"color:#E1E4E8\">>({</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  script: </span><span style=\"color:#9ECBFF\">'./worker.js'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  socketPath: </span><span style=\"color:#9ECBFF\">'/path/to/socket.sock'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#6A737D\">// Optional - defaults to auto-generated path</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">});</span></span></code></pre>"},{"type":"html","html":"<h2>Message Errors</h2>\n<h3>Message Timeout</h3>\n<p><strong>Problem</strong>: A request times out with \"Message timeout\" or similar error.</p>\n<p><strong>Cause</strong>: The worker handler is taking longer than the configured timeout. This can happen when:</p>\n<ul>\n<li>The operation is legitimately slow (file I/O, network requests, heavy computation)</li>\n<li>The handler is stuck in an infinite loop</li>\n<li>The handler is waiting on a resource that's not available</li>\n</ul>\n<p><strong>Solution</strong>: Configure appropriate timeouts for your operations:</p>"},{"type":"code-block","language":"typescript","content":"import { createWorker, type TimeoutConfig } from 'isolated-workers';\n\nconst timeout: TimeoutConfig<Messages> = {\n  WORKER_MESSAGE: 5000, // 5s default\n  processLargeFile: 120000, // 2 minutes for slow operations\n  quickCheck: 1000, // 1 second for fast operations\n};\n\nconst worker = await createWorker<Messages>({\n  script: './worker.js',\n  timeout,\n});","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { <a href=\"/isolated-workers/api/create-worker\" class=\"code-link\" title=\"View createWorker documentation\">createWorker</a>, </span><span style=\"color:#F97583\">type</span><span style=\"color:#E1E4E8\"> <a href=\"/isolated-workers/api/timeout-config\" class=\"code-link\" title=\"View TimeoutConfig documentation\">TimeoutConfig</a> } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'isolated-workers'</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> timeout</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/timeout-config\" class=\"code-link\" title=\"View TimeoutConfig documentation\">TimeoutConfig</a></span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">Messages</span><span style=\"color:#E1E4E8\">> </span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  WORKER_MESSAGE: </span><span style=\"color:#79B8FF\">5000</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#6A737D\">// 5s default</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  processLargeFile: </span><span style=\"color:#79B8FF\">120000</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#6A737D\">// 2 minutes for slow operations</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  quickCheck: </span><span style=\"color:#79B8FF\">1000</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#6A737D\">// 1 second for fast operations</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> worker</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/create-worker\" class=\"code-link\" title=\"View createWorker documentation\">createWorker</a></span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">Messages</span><span style=\"color:#E1E4E8\">>({</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  script: </span><span style=\"color:#9ECBFF\">'./worker.js'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  timeout,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">});</span></span></code></pre>"},{"type":"html","html":"<p>For handlers that may take variable time, implement progress reporting or break the work into smaller chunks.</p>\n<h3>Serialization Errors</h3>\n<p><strong>Problem</strong>: Errors about \"circular structure\" or \"not JSON serializable\" when sending messages.</p>\n<p><strong>Cause</strong>: Messages between host and worker are serialized as JSON. Objects that can't be serialized cause errors:</p>\n<ul>\n<li>Circular references</li>\n<li>Functions</li>\n<li>BigInt values</li>\n<li>Symbols</li>\n<li>Class instances with methods</li>\n</ul>\n<p><strong>Solution</strong>: Ensure all message payloads are plain JSON-serializable objects:</p>"},{"type":"code-block","language":"typescript","content":"// WRONG - contains function and circular reference\nconst message = {\n  data: myData,\n  callback: () => console.log('done'), // Functions can't be serialized\n  self: null as any,\n};\nmessage.self = message; // Circular reference\n\n// CORRECT - plain data only\nconst message = {\n  data: myData,\n  callbackId: 'done-callback', // Use IDs instead of functions\n};","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// WRONG - contains function and circular reference</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> message</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  data: myData,</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  callback</span><span style=\"color:#E1E4E8\">: () </span><span style=\"color:#F97583\">=></span><span style=\"color:#E1E4E8\"> console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'done'</span><span style=\"color:#E1E4E8\">), </span><span style=\"color:#6A737D\">// Functions can't be serialized</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  self: </span><span style=\"color:#79B8FF\">null</span><span style=\"color:#F97583\"> as</span><span style=\"color:#79B8FF\"> any</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">};</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">message.self </span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\"> message; </span><span style=\"color:#6A737D\">// Circular reference</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// CORRECT - plain data only</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> message</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  data: myData,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  callbackId: </span><span style=\"color:#9ECBFF\">'done-callback'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#6A737D\">// Use IDs instead of functions</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">};</span></span></code></pre>"},{"type":"html","html":"<p>For complex data, use a custom serializer. See <a href=\"/isolated-workers/docs/guides/custom-serializers\">Custom Serializers</a> for details.</p>\n<h3>Type Mismatches</h3>\n<p><strong>Problem</strong>: Runtime errors about unexpected message types or missing handlers.</p>\n<p><strong>Cause</strong>: The host and worker have different message type definitions. This can happen when:</p>\n<ul>\n<li>Message definitions are duplicated instead of shared</li>\n<li>The worker wasn't rebuilt after message type changes</li>\n<li>Different versions of message definitions are used</li>\n</ul>\n<p><strong>Solution</strong>: Share message definitions between host and worker:</p>"},{"type":"code-block","language":"typescript","content":"// messages.ts - shared definitions\nimport { defineMessages } from 'isolated-workers';\n\nexport type Messages = defineMessages<{\n  greet: { name: string } => string;\n  calculate: { a: number; b: number } => number;\n}>;","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// messages.ts - shared definitions</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { defineMessages } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'isolated-workers'</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#F97583\"> type</span><span style=\"color:#B392F0\"> Messages</span><span style=\"color:#F97583\"> =</span><span style=\"color:#B392F0\"> defineMessages</span><span style=\"color:#E1E4E8\">&#x3C;{</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  greet</span><span style=\"color:#F97583\">:</span><span style=\"color:#E1E4E8\"> { </span><span style=\"color:#FFAB70\">name</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#E1E4E8\"> } </span><span style=\"color:#F97583\">=></span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  calculate</span><span style=\"color:#F97583\">:</span><span style=\"color:#E1E4E8\"> { </span><span style=\"color:#FFAB70\">a</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> number</span><span style=\"color:#E1E4E8\">; </span><span style=\"color:#FFAB70\">b</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> number</span><span style=\"color:#E1E4E8\"> } </span><span style=\"color:#F97583\">=></span><span style=\"color:#79B8FF\"> number</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}>;</span></span></code></pre>"},{"type":"code-block","language":"typescript","content":"// host.ts\nimport { Messages } from './messages.js';\nconst worker = await createWorker<Messages>({ script: './worker.js' });\n\n// worker.ts\nimport { Messages } from './messages.js';\nstartWorkerServer<Messages>({\n  handlers: {\n    /* ... */\n  },\n});","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// host.ts</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { Messages } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> './messages.js'</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> worker</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/create-worker\" class=\"code-link\" title=\"View createWorker documentation\">createWorker</a></span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">Messages</span><span style=\"color:#E1E4E8\">>({ script: </span><span style=\"color:#9ECBFF\">'./worker.js'</span><span style=\"color:#E1E4E8\"> });</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// worker.ts</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { Messages } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> './messages.js'</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\"><a href=\"/isolated-workers/api/start-worker-server\" class=\"code-link\" title=\"View startWorkerServer documentation\">startWorkerServer</a></span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">Messages</span><span style=\"color:#E1E4E8\">>({</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  handlers: {</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    /* ... */</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  },</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">});</span></span></code></pre>"},{"type":"html","html":"<p>Always rebuild both host and worker after changing message definitions.</p>\n<h2>Lifecycle Issues</h2>\n<h3>Worker Crashes Unexpectedly</h3>\n<p><strong>Problem</strong>: Worker process terminates without an explicit <code class=\"inline-code\">close()</code> call.</p>\n<p><strong>Cause</strong>: Common causes include:</p>\n<ul>\n<li>Unhandled promise rejections in the worker</li>\n<li>Uncaught exceptions in handlers</li>\n<li>Out of memory errors</li>\n<li>Segmentation faults from native modules</li>\n<li>Process killed by system (OOM killer)</li>\n</ul>\n<p><strong>Solution</strong>:</p>\n<ol>\n<li>Add error handling in your worker:</li>\n</ol>"},{"type":"code-block","language":"typescript","content":"process.on('uncaughtException', (error) => {\n  console.error('Worker uncaught exception:', error);\n  process.exit(1);\n});\n\nprocess.on('unhandledRejection', (reason) => {\n  console.error('Worker unhandled rejection:', reason);\n  process.exit(1);\n});\n\nstartWorkerServer<Messages>({\n  handlers: {\n    // Wrap handlers in try/catch for better error reporting\n    riskyOperation: async (payload) => {\n      try {\n        return await doRiskyWork(payload);\n      } catch (error) {\n        console.error('Handler error:', error);\n        throw error;\n      }\n    },\n  },\n});","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">process.</span><span style=\"color:#B392F0\">on</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'uncaughtException'</span><span style=\"color:#E1E4E8\">, (</span><span style=\"color:#FFAB70\">error</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#F97583\">=></span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  console.</span><span style=\"color:#B392F0\">error</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'Worker uncaught exception:'</span><span style=\"color:#E1E4E8\">, error);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  process.</span><span style=\"color:#B392F0\">exit</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#79B8FF\">1</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">});</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">process.</span><span style=\"color:#B392F0\">on</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'unhandledRejection'</span><span style=\"color:#E1E4E8\">, (</span><span style=\"color:#FFAB70\">reason</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#F97583\">=></span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  console.</span><span style=\"color:#B392F0\">error</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'Worker unhandled rejection:'</span><span style=\"color:#E1E4E8\">, reason);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  process.</span><span style=\"color:#B392F0\">exit</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#79B8FF\">1</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">});</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B392F0\"><a href=\"/isolated-workers/api/start-worker-server\" class=\"code-link\" title=\"View startWorkerServer documentation\">startWorkerServer</a></span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">Messages</span><span style=\"color:#E1E4E8\">>({</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  handlers: {</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    // Wrap handlers in try/catch for better error reporting</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">    riskyOperation</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#F97583\">async</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#FFAB70\">payload</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#F97583\">=></span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">      try</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">        return</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> doRiskyWork</span><span style=\"color:#E1E4E8\">(payload);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      } </span><span style=\"color:#F97583\">catch</span><span style=\"color:#E1E4E8\"> (error) {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">        console.</span><span style=\"color:#B392F0\">error</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'Handler error:'</span><span style=\"color:#E1E4E8\">, error);</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">        throw</span><span style=\"color:#E1E4E8\"> error;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    },</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  },</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">});</span></span></code></pre>"},{"type":"html","html":"<ol start=\"2\">\n<li>Implement worker restart logic in the host:</li>\n</ol>"},{"type":"code-block","language":"typescript","content":"async function withWorker<T>(\n  fn: (worker: WorkerClient<Messages>) => Promise<T>\n): Promise<T> {\n  const worker = await createWorker<Messages>({ script: './worker.js' });\n  try {\n    return await fn(worker);\n  } catch (error) {\n    if (!worker.isActive) {\n      console.log('Worker crashed, this may need a retry');\n    }\n    throw error;\n  } finally {\n    await worker.close();\n  }\n}","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">async</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> withWorker</span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">T</span><span style=\"color:#E1E4E8\">>(</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  fn</span><span style=\"color:#F97583\">:</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#FFAB70\">worker</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/worker-client\" class=\"code-link\" title=\"View WorkerClient documentation\">WorkerClient</a></span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">Messages</span><span style=\"color:#E1E4E8\">>) </span><span style=\"color:#F97583\">=></span><span style=\"color:#B392F0\"> Promise</span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">T</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">)</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> Promise</span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">T</span><span style=\"color:#E1E4E8\">> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> worker</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/create-worker\" class=\"code-link\" title=\"View createWorker documentation\">createWorker</a></span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">Messages</span><span style=\"color:#E1E4E8\">>({ script: </span><span style=\"color:#9ECBFF\">'./worker.js'</span><span style=\"color:#E1E4E8\"> });</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  try</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> fn</span><span style=\"color:#E1E4E8\">(worker);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  } </span><span style=\"color:#F97583\">catch</span><span style=\"color:#E1E4E8\"> (error) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    if</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#F97583\">!</span><span style=\"color:#E1E4E8\">worker.isActive) {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'Worker crashed, this may need a retry'</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    }</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    throw</span><span style=\"color:#E1E4E8\"> error;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  } </span><span style=\"color:#F97583\">finally</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    await</span><span style=\"color:#E1E4E8\"> worker.</span><span style=\"color:#B392F0\">close</span><span style=\"color:#E1E4E8\">();</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>"},{"type":"html","html":"<h3>\"Worker is Not Active\" Errors</h3>\n<p><strong>Problem</strong>: Sending a message throws \"Worker is not active\" error.</p>\n<p><strong>Cause</strong>: Attempting to send a message after the worker has been closed or crashed:</p>\n<ul>\n<li>Called <code class=\"inline-code\">worker.close()</code> before sending</li>\n<li>Worker process crashed</li>\n<li>Worker was never started successfully</li>\n</ul>\n<p><strong>Solution</strong>: Check worker status before sending:</p>"},{"type":"code-block","language":"typescript","content":"if (worker.isActive && worker.isConnected) {\n  await worker.send('message', payload);\n} else {\n  console.log('Worker unavailable, recreating...');\n  worker = await createWorker<Messages>({ script: './worker.js' });\n  await worker.send('message', payload);\n}","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">if</span><span style=\"color:#E1E4E8\"> (worker.isActive </span><span style=\"color:#F97583\">&#x26;&#x26;</span><span style=\"color:#E1E4E8\"> worker.isConnected) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  await</span><span style=\"color:#E1E4E8\"> worker.</span><span style=\"color:#B392F0\">send</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'message'</span><span style=\"color:#E1E4E8\">, payload);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">} </span><span style=\"color:#F97583\">else</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'Worker unavailable, recreating...'</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  worker </span><span style=\"color:#F97583\">=</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/create-worker\" class=\"code-link\" title=\"View createWorker documentation\">createWorker</a></span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">Messages</span><span style=\"color:#E1E4E8\">>({ script: </span><span style=\"color:#9ECBFF\">'./worker.js'</span><span style=\"color:#E1E4E8\"> });</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  await</span><span style=\"color:#E1E4E8\"> worker.</span><span style=\"color:#B392F0\">send</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'message'</span><span style=\"color:#E1E4E8\">, payload);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>"},{"type":"html","html":"<p>Or use a wrapper that handles reconnection:</p>"},{"type":"code-block","language":"typescript","content":"class WorkerPool<T> {\n  private worker: WorkerClient<T> | null = null;\n\n  async send<K extends keyof T>(\n    type: K,\n    payload: MessageOf<T, K>\n  ): Promise<ResultOf<T, K>> {\n    if (!this.worker?.isActive) {\n      this.worker = await createWorker<T>({ script: this.script });\n    }\n    return this.worker.send(type, payload);\n  }\n}","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">class</span><span style=\"color:#B392F0\"> WorkerPool</span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">T</span><span style=\"color:#E1E4E8\">> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  private</span><span style=\"color:#FFAB70\"> worker</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/worker-client\" class=\"code-link\" title=\"View WorkerClient documentation\">WorkerClient</a></span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">T</span><span style=\"color:#E1E4E8\">> </span><span style=\"color:#F97583\">|</span><span style=\"color:#79B8FF\"> null</span><span style=\"color:#F97583\"> =</span><span style=\"color:#79B8FF\"> null</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  async</span><span style=\"color:#B392F0\"> send</span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">K</span><span style=\"color:#F97583\"> extends</span><span style=\"color:#F97583\"> keyof</span><span style=\"color:#B392F0\"> T</span><span style=\"color:#E1E4E8\">>(</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">    type</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> K</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">    payload</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/message-of\" class=\"code-link\" title=\"View MessageOf documentation\">MessageOf</a></span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">T</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#B392F0\">K</span><span style=\"color:#E1E4E8\">></span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  )</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> Promise</span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\"><a href=\"/isolated-workers/api/result-of\" class=\"code-link\" title=\"View ResultOf documentation\">ResultOf</a></span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">T</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#B392F0\">K</span><span style=\"color:#E1E4E8\">>> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    if</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#F97583\">!</span><span style=\"color:#79B8FF\">this</span><span style=\"color:#E1E4E8\">.worker?.isActive) {</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">      this</span><span style=\"color:#E1E4E8\">.worker </span><span style=\"color:#F97583\">=</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/create-worker\" class=\"code-link\" title=\"View createWorker documentation\">createWorker</a></span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">T</span><span style=\"color:#E1E4E8\">>({ script: </span><span style=\"color:#79B8FF\">this</span><span style=\"color:#E1E4E8\">.script });</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    }</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#79B8FF\"> this</span><span style=\"color:#E1E4E8\">.worker.</span><span style=\"color:#B392F0\">send</span><span style=\"color:#E1E4E8\">(type, payload);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>"},{"type":"html","html":"<h3>Memory Leaks from Unclosed Workers</h3>\n<p><strong>Problem</strong>: Memory usage grows over time, especially when creating many workers.</p>\n<p><strong>Cause</strong>: Workers that aren't properly closed leave:</p>\n<ul>\n<li>Socket files on disk</li>\n<li>Node.js process running in background</li>\n<li>IPC channels open</li>\n</ul>\n<p><strong>Solution</strong>: Always close workers in a <code class=\"inline-code\">finally</code> block:</p>"},{"type":"code-block","language":"typescript","content":"const worker = await createWorker<Messages>({ script: './worker.js' });\ntry {\n  await doWork(worker);\n} finally {\n  await worker.close();\n}","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> worker</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/create-worker\" class=\"code-link\" title=\"View createWorker documentation\">createWorker</a></span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">Messages</span><span style=\"color:#E1E4E8\">>({ script: </span><span style=\"color:#9ECBFF\">'./worker.js'</span><span style=\"color:#E1E4E8\"> });</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">try</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  await</span><span style=\"color:#B392F0\"> doWork</span><span style=\"color:#E1E4E8\">(worker);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">} </span><span style=\"color:#F97583\">finally</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  await</span><span style=\"color:#E1E4E8\"> worker.</span><span style=\"color:#B392F0\">close</span><span style=\"color:#E1E4E8\">();</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>"},{"type":"html","html":"<p>For long-running applications, consider pooling and reusing workers instead of creating new ones for each operation.</p>\n<p>To check for orphaned worker processes:</p>"},{"type":"code-block","language":"bash","content":"# Find isolated-workers processes\nps aux | grep \"node.*worker\"\n\n# Check for stale socket files\nls -la /tmp/isolated-workers-*","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\"># Find isolated-workers processes</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">ps</span><span style=\"color:#9ECBFF\"> aux</span><span style=\"color:#F97583\"> |</span><span style=\"color:#B392F0\"> grep</span><span style=\"color:#9ECBFF\"> \"node.*worker\"</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\"># Check for stale socket files</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">ls</span><span style=\"color:#79B8FF\"> -la</span><span style=\"color:#9ECBFF\"> /tmp/isolated-workers-</span><span style=\"color:#79B8FF\">*</span></span></code></pre>"},{"type":"html","html":"<h2>Debugging Tips</h2>\n<h3>Enabling Debug Logging</h3>\n<p>Configure logging using the <code class=\"inline-code\">logLevel</code> parameter:</p>"},{"type":"code-block","language":"typescript","content":"const worker = await createWorker<Messages>({\n  script: './worker.js',\n  logLevel: 'debug', // 'debug' | 'info' | 'warn' | 'error'\n});","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> worker</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/create-worker\" class=\"code-link\" title=\"View createWorker documentation\">createWorker</a></span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">Messages</span><span style=\"color:#E1E4E8\">>({</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  script: </span><span style=\"color:#9ECBFF\">'./worker.js'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  logLevel: </span><span style=\"color:#9ECBFF\">'debug'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#6A737D\">// 'debug' | 'info' | 'warn' | 'error'</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">});</span></span></code></pre>"},{"type":"html","html":"<h3>Checking Worker stdout/stderr</h3>\n<p>Worker output can be captured for debugging:</p>"},{"type":"code-block","language":"typescript","content":"const worker = await createWorker<Messages>({\n  script: './worker.js',\n  spawnOptions: { stdio: ['pipe', 'pipe', 'pipe'] }, // Capture all streams\n});\n\n// Access worker output (if exposed by your wrapper)\nworker.process.stdout?.on('data', (data) => {\n  console.log('Worker stdout:', data.toString());\n});\n\nworker.process.stderr?.on('data', (data) => {\n  console.error('Worker stderr:', data.toString());\n});","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> worker</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/create-worker\" class=\"code-link\" title=\"View createWorker documentation\">createWorker</a></span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">Messages</span><span style=\"color:#E1E4E8\">>({</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  script: </span><span style=\"color:#9ECBFF\">'./worker.js'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  spawnOptions: { stdio: [</span><span style=\"color:#9ECBFF\">'pipe'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#9ECBFF\">'pipe'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#9ECBFF\">'pipe'</span><span style=\"color:#E1E4E8\">] }, </span><span style=\"color:#6A737D\">// Capture all streams</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">});</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Access worker output (if exposed by your wrapper)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">worker.process.stdout?.</span><span style=\"color:#B392F0\">on</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'data'</span><span style=\"color:#E1E4E8\">, (</span><span style=\"color:#FFAB70\">data</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#F97583\">=></span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'Worker stdout:'</span><span style=\"color:#E1E4E8\">, data.</span><span style=\"color:#B392F0\">toString</span><span style=\"color:#E1E4E8\">());</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">});</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">worker.process.stderr?.</span><span style=\"color:#B392F0\">on</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'data'</span><span style=\"color:#E1E4E8\">, (</span><span style=\"color:#FFAB70\">data</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#F97583\">=></span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  console.</span><span style=\"color:#B392F0\">error</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'Worker stderr:'</span><span style=\"color:#E1E4E8\">, data.</span><span style=\"color:#B392F0\">toString</span><span style=\"color:#E1E4E8\">());</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">});</span></span></code></pre>"},{"type":"html","html":"<p>Or simply add console.log statements in your worker and run with inherited stdio:</p>"},{"type":"code-block","language":"typescript","content":"const worker = await createWorker<Messages>({\n  script: './worker.js',\n  spawnOptions: { stdio: 'inherit' }, // Worker output goes to parent console\n});","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> worker</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/create-worker\" class=\"code-link\" title=\"View createWorker documentation\">createWorker</a></span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">Messages</span><span style=\"color:#E1E4E8\">>({</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  script: </span><span style=\"color:#9ECBFF\">'./worker.js'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  spawnOptions: { stdio: </span><span style=\"color:#9ECBFF\">'inherit'</span><span style=\"color:#E1E4E8\"> }, </span><span style=\"color:#6A737D\">// Worker output goes to parent console</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">});</span></span></code></pre>"},{"type":"html","html":"<h3>Using Middleware for Message Inspection</h3>\n<p>Add middleware to log all messages for debugging:</p>"},{"type":"code-block","language":"typescript","content":"const worker = await createWorker<Messages>({\n  script: './worker.js',\n  middleware: [\n    {\n      beforeSend: (message) => {\n        console.log('Sending:', JSON.stringify(message, null, 2));\n        return message;\n      },\n      afterReceive: (response) => {\n        console.log('Received:', JSON.stringify(response, null, 2));\n        return response;\n      },\n    },\n  ],\n});","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> worker</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/create-worker\" class=\"code-link\" title=\"View createWorker documentation\">createWorker</a></span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">Messages</span><span style=\"color:#E1E4E8\">>({</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  script: </span><span style=\"color:#9ECBFF\">'./worker.js'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  middleware: [</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    {</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">      beforeSend</span><span style=\"color:#E1E4E8\">: (</span><span style=\"color:#FFAB70\">message</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#F97583\">=></span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">        console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'Sending:'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#79B8FF\">JSON</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">stringify</span><span style=\"color:#E1E4E8\">(message, </span><span style=\"color:#79B8FF\">null</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#79B8FF\">2</span><span style=\"color:#E1E4E8\">));</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">        return</span><span style=\"color:#E1E4E8\"> message;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      },</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">      afterReceive</span><span style=\"color:#E1E4E8\">: (</span><span style=\"color:#FFAB70\">response</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#F97583\">=></span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">        console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'Received:'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#79B8FF\">JSON</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">stringify</span><span style=\"color:#E1E4E8\">(response, </span><span style=\"color:#79B8FF\">null</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#79B8FF\">2</span><span style=\"color:#E1E4E8\">));</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">        return</span><span style=\"color:#E1E4E8\"> response;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      },</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    },</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  ],</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">});</span></span></code></pre>"},{"type":"html","html":"<p>See <a href=\"/isolated-workers/docs/guides/middleware\">Middleware</a> for more details on the middleware system.</p>\n<h2>Platform-Specific Issues</h2>\n<h3>Windows Named Pipe Considerations</h3>\n<p><strong>Problem</strong>: Connection issues or errors on Windows systems.</p>\n<p><strong>Cause</strong>: Windows uses named pipes instead of Unix sockets. Some considerations:</p>\n<ul>\n<li>Named pipe paths have different format (<code class=\"inline-code\">\\\\.\\pipe\\name</code>)</li>\n<li>Maximum path length differs from Unix</li>\n<li>Pipe cleanup works differently</li>\n</ul>\n<p><strong>Solution</strong>: isolated-workers handles platform differences automatically, but be aware of:</p>\n<ol>\n<li>Pipe naming: Avoid special characters in worker identifiers</li>\n<li>Permissions: Run as administrator if you encounter access issues</li>\n<li>Cleanup: Named pipes are automatically cleaned up when the process exits, but stale pipes may need manual cleanup</li>\n</ol>"},{"type":"code-block","language":"powershell","content":"# List named pipes (PowerShell)\nGet-ChildItem \\\\.\\pipe\\ | Where-Object { $_.Name -like \"*isolated-workers*\" }","highlightedHtml":"<pre class=\"shiki\"><code># List named pipes (PowerShell)\nGet-ChildItem \\\\.\\pipe\\ | Where-Object { $_.Name -like \"*isolated-workers*\" }</code></pre>"},{"type":"html","html":"<h3>Unix Socket Path Length Limits</h3>\n<p><strong>Problem</strong>: \"ENAMETOOLONG\" error when creating workers on Unix systems.</p>\n<p><strong>Cause</strong>: Unix domain sockets have a maximum path length (typically 104-108 characters on macOS, 108 on Linux). Long socket paths exceed this limit.</p>\n<p><strong>Solution</strong>:</p>\n<ol>\n<li>Use a shorter socket directory:</li>\n</ol>"},{"type":"code-block","language":"typescript","content":"const worker = await createWorker<Messages>({\n  script: './worker.js',\n  socketDir: '/tmp/iw', // Short path\n});","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> worker</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/create-worker\" class=\"code-link\" title=\"View createWorker documentation\">createWorker</a></span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">Messages</span><span style=\"color:#E1E4E8\">>({</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  script: </span><span style=\"color:#9ECBFF\">'./worker.js'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  socketDir: </span><span style=\"color:#9ECBFF\">'/tmp/iw'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#6A737D\">// Short path</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">});</span></span></code></pre>"},{"type":"html","html":"<ol start=\"2\">\n<li>Use shorter worker identifiers:</li>\n</ol>"},{"type":"code-block","language":"typescript","content":"const worker = await createWorker<Messages>({\n  script: './worker.js',\n  id: 'w1', // Instead of 'my-very-long-worker-identifier'\n});","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> worker</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/create-worker\" class=\"code-link\" title=\"View createWorker documentation\">createWorker</a></span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">Messages</span><span style=\"color:#E1E4E8\">>({</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  script: </span><span style=\"color:#9ECBFF\">'./worker.js'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  id: </span><span style=\"color:#9ECBFF\">'w1'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#6A737D\">// Instead of 'my-very-long-worker-identifier'</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">});</span></span></code></pre>"},{"type":"html","html":"<ol start=\"3\">\n<li>Let isolated-workers choose the path automatically (it handles truncation):</li>\n</ol>"},{"type":"code-block","language":"typescript","content":"// Don't specify socketDir - uses optimized default\nconst worker = await createWorker<Messages>({\n  script: './worker.js',\n});","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// Don't specify socketDir - uses optimized default</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> worker</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/create-worker\" class=\"code-link\" title=\"View createWorker documentation\">createWorker</a></span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">Messages</span><span style=\"color:#E1E4E8\">>({</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  script: </span><span style=\"color:#9ECBFF\">'./worker.js'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">});</span></span></code></pre>"},{"type":"html","html":"<h2>Getting More Help</h2>\n<p>If you're still experiencing issues:</p>\n<ol>\n<li>Check the <a href=\"https://github.com/AgentEnder/isolated-workers/issues\">GitHub Issues</a> for similar problems</li>\n<li>Enable debug logging and capture the output</li>\n<li>Create a minimal reproduction case</li>\n<li>Open a new issue with your debug output and reproduction</li>\n</ol>\n<h2>See Also</h2>\n<ul>\n<li><a href=\"/isolated-workers/docs/guides/error-handling\">Error Handling</a> - How errors propagate from workers</li>\n<li><a href=\"/isolated-workers/docs/guides/worker-lifecycle\">Worker Lifecycle</a> - Managing worker state and shutdown</li>\n<li><a href=\"/isolated-workers/docs/guides/timeout-configuration\">Timeout Configuration</a> - Configuring operation timeouts</li>\n<li><a href=\"/isolated-workers/docs/guides/middleware\">Middleware</a> - Adding custom message processing</li>\n</ul>"}]}}