{"pageId":"/pages/docs","routeParams":{"splat":"guides/security"},"data":{"doc":{"path":"/docs/guides/security","filePath":"/home/runner/work/isolated-workers/isolated-workers/docs/guides/security.md","title":"Security Considerations","description":"Security best practices for worker-based applications","nav":{"section":"Guides","order":9}},"segments":[{"type":"html","html":"<h1>Security Considerations</h1>\n<p>This guide covers security aspects of using isolated-workers. It is important to understand both what protection process isolation provides and what it does NOT provide.</p>\n<h2>Process Isolation</h2>\n<h3>What Process Separation Provides</h3>\n<p>When you spawn a worker with isolated-workers, it runs in a separate Node.js process. This provides several security benefits:</p>\n<p><strong>Memory Isolation</strong>: The worker process has its own V8 heap, completely separate from the host. A worker cannot directly access variables, closures, or objects in the host process. This prevents accidental data leakage between components.</p>\n<p><strong>Crash Isolation</strong>: If a worker crashes (uncaught exception, segfault, out of memory), the host process continues running. You can detect the crash and spawn a new worker:</p>"},{"type":"code-block","language":"typescript","content":"try {\n  await worker.send('riskyOperation', data);\n} catch (error) {\n  if (!worker.isActive) {\n    console.log('Worker crashed, spawning replacement');\n    worker = await createWorker<Messages>({ script: './worker.js' });\n  }\n}","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">try</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  await</span><span style=\"color:#E1E4E8\"> worker.</span><span style=\"color:#B392F0\">send</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'riskyOperation'</span><span style=\"color:#E1E4E8\">, data);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">} </span><span style=\"color:#F97583\">catch</span><span style=\"color:#E1E4E8\"> (error) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  if</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#F97583\">!</span><span style=\"color:#E1E4E8\">worker.isActive) {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'Worker crashed, spawning replacement'</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    worker </span><span style=\"color:#F97583\">=</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/create-worker\" class=\"code-link\" title=\"View createWorker documentation\">createWorker</a></span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">Messages</span><span style=\"color:#E1E4E8\">>({ script: </span><span style=\"color:#9ECBFF\">'./worker.js'</span><span style=\"color:#E1E4E8\"> });</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>"},{"type":"html","html":"<p><strong>Resource Limits</strong>: Operating system process limits apply independently. A worker consuming excessive memory will be killed by the OS without affecting the host.</p>\n<h3>What Process Separation Does NOT Provide</h3>\n<p><strong>No Sandboxing</strong>: The worker process has full access to:</p>\n<ul>\n<li>The filesystem (same permissions as the parent process)</li>\n<li>Network (can make HTTP requests, open sockets)</li>\n<li>Environment variables</li>\n<li>Child process spawning (<code class=\"inline-code\">child_process.spawn</code>)</li>\n<li>Native modules and Node.js APIs</li>\n</ul>\n<p><strong>No Capability Restrictions</strong>: Unlike browser workers or Deno, Node.js workers can do anything the user running the process can do. isolated-workers does not add a permission system.</p>\n<p><strong>Same User Context</strong>: Workers run as the same OS user as the host. They inherit file permissions, group memberships, and access rights.</p>\n<h2>Socket Security</h2>\n<p>isolated-workers uses Unix domain sockets on POSIX systems and named pipes on Windows for IPC.</p>\n<h3>Unix Socket Permissions</h3>\n<p>Unix sockets are created with the process's umask. By default, this typically means:</p>\n<ul>\n<li>Owner has read/write access</li>\n<li>Group and others may have read access depending on umask</li>\n</ul>\n<p>For sensitive applications, consider:</p>"},{"type":"code-block","language":"typescript","content":"// Set restrictive umask before creating workers\nconst originalUmask = process.umask(0o077);\nconst worker = await createWorker<Messages>({ script: './worker.js' });\nprocess.umask(originalUmask);","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// Set restrictive umask before creating workers</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> originalUmask</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> process.</span><span style=\"color:#B392F0\">umask</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#79B8FF\">0o077</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> worker</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/create-worker\" class=\"code-link\" title=\"View createWorker documentation\">createWorker</a></span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">Messages</span><span style=\"color:#E1E4E8\">>({ script: </span><span style=\"color:#9ECBFF\">'./worker.js'</span><span style=\"color:#E1E4E8\"> });</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">process.</span><span style=\"color:#B392F0\">umask</span><span style=\"color:#E1E4E8\">(originalUmask);</span></span></code></pre>"},{"type":"html","html":"<h3>Socket Path Location</h3>\n<p>Sockets are created in a temporary directory. The path includes random components to prevent prediction:</p>"},{"type":"code-block","language":"text","content":"/tmp/isolated-workers-<random>/worker-<id>.sock","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>/tmp/isolated-workers-&#x3C;random>/worker-&#x3C;id>.sock</span></span></code></pre>"},{"type":"html","html":"<p>Considerations:</p>\n<ul>\n<li><code class=\"inline-code\">/tmp</code> is often world-readable on shared systems</li>\n<li>Symlink attacks are possible if the temp directory is predictable</li>\n<li>On shared hosting, other users might enumerate socket files</li>\n</ul>\n<p>For high-security environments, configure a private socket directory:</p>"},{"type":"code-block","language":"typescript","content":"const worker = await createWorker<Messages>({\n  script: './worker.js',\n  socketPath: '/run/user/1000/myapp/worker.sock',\n});","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> worker</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/create-worker\" class=\"code-link\" title=\"View createWorker documentation\">createWorker</a></span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">Messages</span><span style=\"color:#E1E4E8\">>({</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  script: </span><span style=\"color:#9ECBFF\">'./worker.js'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  socketPath: </span><span style=\"color:#9ECBFF\">'/run/user/1000/myapp/worker.sock'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">});</span></span></code></pre>"},{"type":"html","html":"<h3>Named Pipes on Windows</h3>\n<p>Windows named pipes have their own ACL (Access Control List). By default, isolated-workers creates pipes accessible to the current user. Named pipes are created in the <code class=\"inline-code\">\\\\.\\pipe\\</code> namespace which is system-managed.</p>\n<h2>Message Validation</h2>\n<h3>Why Validate Even with TypeScript?</h3>\n<p>TypeScript types are erased at runtime. A malicious or buggy worker can send any data:</p>"},{"type":"code-block","language":"typescript","content":"// Host expects this type\ntype Result = { success: boolean; count: number };\n\n// But worker could actually send\n{ success: \"maybe\", count: \"lots\", __proto__: maliciousObject }","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// Host expects this type</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">type</span><span style=\"color:#B392F0\"> Result</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> { </span><span style=\"color:#FFAB70\">success</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> boolean</span><span style=\"color:#E1E4E8\">; </span><span style=\"color:#FFAB70\">count</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> number</span><span style=\"color:#E1E4E8\"> };</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// But worker could actually send</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">{ </span><span style=\"color:#B392F0\">success</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"maybe\"</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#B392F0\">count</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#9ECBFF\">\"lots\"</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#B392F0\">__proto__</span><span style=\"color:#E1E4E8\">: maliciousObject }</span></span></code></pre>"},{"type":"html","html":"<p>TypeScript won't catch this at runtime. Your application will proceed with incorrect data.</p>\n<h3>Runtime Validation Recommendations</h3>\n<p>Use a runtime validation library for messages containing user-provided or untrusted data:</p>"},{"type":"code-block","language":"typescript","content":"import { z } from 'zod';\n\nconst ResultSchema = z.object({\n  success: z.boolean(),\n  count: z.number().int().nonnegative(),\n});\n\n// In message handler\nhandlers: {\n  processData: async (payload) => {\n    const result = await doProcessing(payload);\n    return ResultSchema.parse(result); // Validates before sending\n  };\n}\n\n// In host, after receiving\nconst response = await worker.send('processData', data);\nconst validated = ResultSchema.parse(response); // Validates after receiving","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { z } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'zod'</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> ResultSchema</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> z.</span><span style=\"color:#B392F0\">object</span><span style=\"color:#E1E4E8\">({</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  success: z.</span><span style=\"color:#B392F0\">boolean</span><span style=\"color:#E1E4E8\">(),</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  count: z.</span><span style=\"color:#B392F0\">number</span><span style=\"color:#E1E4E8\">().</span><span style=\"color:#B392F0\">int</span><span style=\"color:#E1E4E8\">().</span><span style=\"color:#B392F0\">nonnegative</span><span style=\"color:#E1E4E8\">(),</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">});</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// In message handler</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">handlers</span><span style=\"color:#E1E4E8\">: {</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  processData</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#F97583\">async</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#FFAB70\">payload</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#F97583\">=></span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> result</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> doProcessing</span><span style=\"color:#E1E4E8\">(payload);</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#E1E4E8\"> ResultSchema.</span><span style=\"color:#B392F0\">parse</span><span style=\"color:#E1E4E8\">(result); </span><span style=\"color:#6A737D\">// Validates before sending</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  };</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// In host, after receiving</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> response</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> worker.</span><span style=\"color:#B392F0\">send</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'processData'</span><span style=\"color:#E1E4E8\">, data);</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> validated</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> ResultSchema.</span><span style=\"color:#B392F0\">parse</span><span style=\"color:#E1E4E8\">(response); </span><span style=\"color:#6A737D\">// Validates after receiving</span></span></code></pre>"},{"type":"html","html":"<h3>Protecting Against Malformed Messages</h3>\n<p>Workers receive serialized JSON over the socket. Consider these attack vectors:</p>\n<p><strong>Prototype Pollution</strong>: Use <code class=\"inline-code\">JSON.parse</code> with a reviver or a safe parsing library:</p>"},{"type":"code-block","language":"typescript","content":"// If using custom serialization\nfunction safeParse(json: string) {\n  return JSON.parse(json, (key, value) => {\n    if (key === '__proto__' || key === 'constructor') {\n      return undefined;\n    }\n    return value;\n  });\n}","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// If using custom serialization</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">function</span><span style=\"color:#B392F0\"> safeParse</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">json</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  return</span><span style=\"color:#79B8FF\"> JSON</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">parse</span><span style=\"color:#E1E4E8\">(json, (</span><span style=\"color:#FFAB70\">key</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">value</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#F97583\">=></span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    if</span><span style=\"color:#E1E4E8\"> (key </span><span style=\"color:#F97583\">===</span><span style=\"color:#9ECBFF\"> '__proto__'</span><span style=\"color:#F97583\"> ||</span><span style=\"color:#E1E4E8\"> key </span><span style=\"color:#F97583\">===</span><span style=\"color:#9ECBFF\"> 'constructor'</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">      return</span><span style=\"color:#79B8FF\"> undefined</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    }</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#E1E4E8\"> value;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  });</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>"},{"type":"html","html":"<p><strong>Large Payloads</strong>: A malicious sender could exhaust memory with huge messages. Consider size limits in your serializer or at the application level.</p>\n<p><strong>Deeply Nested Objects</strong>: Can cause stack overflow during parsing. Limit nesting depth if accepting untrusted input.</p>\n<h2>Sandboxing Considerations</h2>\n<h3>When You Need Additional Sandboxing</h3>\n<p>isolated-workers provides process isolation, not security sandboxing. You need additional measures when:</p>\n<ul>\n<li>Running untrusted code (user-submitted scripts, plugins)</li>\n<li>Processing untrusted input that could exploit Node.js vulnerabilities</li>\n<li>Handling sensitive data that must not reach the filesystem or network</li>\n<li>Operating in multi-tenant environments</li>\n</ul>\n<h3>Options for Additional Sandboxing</h3>\n<p><strong>vm2 or isolated-vm</strong>: For running untrusted JavaScript in a restricted context:</p>"},{"type":"code-block","language":"typescript","content":"// Worker code\nimport ivm from 'isolated-vm';\n\nhandlers: {\n  runUntrusted: (code: string) => {\n    const isolate = new ivm.Isolate({ memoryLimit: 128 });\n    const context = await isolate.createContext();\n    // Execute code in sandbox\n  };\n}","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// Worker code</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> ivm </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'isolated-vm'</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B392F0\">handlers</span><span style=\"color:#E1E4E8\">: {</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  runUntrusted</span><span style=\"color:#E1E4E8\">: (</span><span style=\"color:#FFAB70\">code</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#F97583\">=></span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> isolate</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> new</span><span style=\"color:#E1E4E8\"> ivm.</span><span style=\"color:#B392F0\">Isolate</span><span style=\"color:#E1E4E8\">({ memoryLimit: </span><span style=\"color:#79B8FF\">128</span><span style=\"color:#E1E4E8\"> });</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> context</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> isolate.</span><span style=\"color:#B392F0\">createContext</span><span style=\"color:#E1E4E8\">();</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    // Execute code in sandbox</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  };</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>"},{"type":"html","html":"<p><strong>Docker/Containers</strong>: Run workers in containers with restricted capabilities:</p>"},{"type":"code-block","language":"typescript","content":"// Use child_process to spawn containerized workers\nconst worker = spawn('docker', [\n  'run',\n  '--rm',\n  '--network=none',\n  '--read-only',\n  'worker-image',\n  'node',\n  '/app/worker.js',\n]);","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// Use child_process to spawn containerized workers</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> worker</span><span style=\"color:#F97583\"> =</span><span style=\"color:#B392F0\"> spawn</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'docker'</span><span style=\"color:#E1E4E8\">, [</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">  'run'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">  '--rm'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">  '--network=none'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">  '--read-only'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">  'worker-image'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">  'node'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">  '/app/worker.js'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">]);</span></span></code></pre>"},{"type":"html","html":"<p><strong>Operating System Sandboxing</strong>:</p>\n<ul>\n<li>Linux: seccomp, AppArmor, SELinux</li>\n<li>macOS: sandbox-exec</li>\n<li>Windows: AppContainer</li>\n</ul>\n<h3>What isolated-workers Intentionally Does Not Do</h3>\n<p>We do not implement sandboxing because:</p>\n<ol>\n<li><strong>Complexity</strong>: Proper sandboxing is extremely difficult to get right</li>\n<li><strong>Platform differences</strong>: Each OS has different sandboxing mechanisms</li>\n<li><strong>Performance</strong>: Sandboxing adds overhead</li>\n<li><strong>Use case mismatch</strong>: Most worker use cases involve trusted code</li>\n</ol>\n<p>If you need sandboxing, use purpose-built tools rather than expecting it from a process communication library.</p>\n<h2>Environment Variables</h2>\n<h3>Passing Sensitive Data to Workers</h3>\n<p>Workers inherit the parent's environment by default. This includes sensitive variables like API keys:</p>"},{"type":"code-block","language":"typescript","content":"// Worker automatically has access to process.env.API_KEY","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// Worker automatically has access to process.env.API_KEY</span></span></code></pre>"},{"type":"html","html":"<p>To limit exposure, explicitly pass only needed variables:</p>"},{"type":"code-block","language":"typescript","content":"const worker = await createWorker<Messages>({\n  script: './worker.js',\n  env: {\n    NODE_ENV: process.env.NODE_ENV,\n    DATABASE_URL: process.env.DATABASE_URL,\n    // Explicitly omit AWS_SECRET_ACCESS_KEY, etc.\n  },\n});","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> worker</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/create-worker\" class=\"code-link\" title=\"View createWorker documentation\">createWorker</a></span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">Messages</span><span style=\"color:#E1E4E8\">>({</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  script: </span><span style=\"color:#9ECBFF\">'./worker.js'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  env: {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    NODE_ENV: process.env.</span><span style=\"color:#79B8FF\">NODE_ENV</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    DATABASE_URL: process.env.</span><span style=\"color:#79B8FF\">DATABASE_URL</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    // Explicitly omit AWS_SECRET_ACCESS_KEY, etc.</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  },</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">});</span></span></code></pre>"},{"type":"html","html":"<h3>Avoiding Secrets in Message Payloads</h3>\n<p>Message payloads may be logged, serialized, or cached. Avoid including secrets:</p>"},{"type":"code-block","language":"typescript","content":"// Bad - secret in message\nawait worker.send('callApi', {\n  endpoint: '/users',\n  apiKey: 'sk_live_xxxxx', // Could be logged\n});\n\n// Good - worker reads secret from environment\nawait worker.send('callApi', {\n  endpoint: '/users',\n  // Worker uses process.env.API_KEY internally\n});","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// Bad - secret in message</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> worker.</span><span style=\"color:#B392F0\">send</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'callApi'</span><span style=\"color:#E1E4E8\">, {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  endpoint: </span><span style=\"color:#9ECBFF\">'/users'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  apiKey: </span><span style=\"color:#9ECBFF\">'sk_live_xxxxx'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#6A737D\">// Could be logged</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">});</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Good - worker reads secret from environment</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#E1E4E8\"> worker.</span><span style=\"color:#B392F0\">send</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'callApi'</span><span style=\"color:#E1E4E8\">, {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  endpoint: </span><span style=\"color:#9ECBFF\">'/users'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Worker uses process.env.API_KEY internally</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">});</span></span></code></pre>"},{"type":"html","html":"<p>If you must pass sensitive data in messages, consider:</p>\n<ol>\n<li>Using encrypted payloads (see <a href=\"/isolated-workers/docs/guides/custom-serializers\">Custom Serializers</a>)</li>\n<li>Implementing message redaction in logging middleware</li>\n<li>Using short-lived tokens instead of long-lived secrets</li>\n</ol>\n<h2>Best Practices</h2>\n<h3>1. Validate All Inputs</h3>\n<p>Never trust data crossing the process boundary:</p>"},{"type":"code-block","language":"typescript","content":"handlers: {\n  processFile: async ({ path }) => {\n    // Validate path doesn't escape expected directory\n    const resolved = resolve(path);\n    if (!resolved.startsWith('/app/uploads/')) {\n      throw new Error('Invalid file path');\n    }\n    return processFile(resolved);\n  };\n}","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">handlers</span><span style=\"color:#E1E4E8\">: {</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  processFile</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#F97583\">async</span><span style=\"color:#E1E4E8\"> ({ </span><span style=\"color:#FFAB70\">path</span><span style=\"color:#E1E4E8\"> }) </span><span style=\"color:#F97583\">=></span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    // Validate path doesn't escape expected directory</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> resolved</span><span style=\"color:#F97583\"> =</span><span style=\"color:#B392F0\"> resolve</span><span style=\"color:#E1E4E8\">(path);</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    if</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#F97583\">!</span><span style=\"color:#E1E4E8\">resolved.</span><span style=\"color:#B392F0\">startsWith</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'/app/uploads/'</span><span style=\"color:#E1E4E8\">)) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">      throw</span><span style=\"color:#F97583\"> new</span><span style=\"color:#B392F0\"> Error</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'Invalid file path'</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    }</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#B392F0\"> processFile</span><span style=\"color:#E1E4E8\">(resolved);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  };</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>"},{"type":"html","html":"<h3>2. Use Timeouts to Prevent DoS</h3>\n<p>Always configure timeouts to prevent workers from hanging indefinitely:</p>"},{"type":"code-block","language":"typescript","content":"const worker = await createWorker<Messages>({\n  script: './worker.js',\n  timeout: {\n    WORKER_STARTUP: 5000,\n    WORKER_MESSAGE: 30000,\n    expensiveOperation: 120000,\n  },\n});","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> worker</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/create-worker\" class=\"code-link\" title=\"View createWorker documentation\">createWorker</a></span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">Messages</span><span style=\"color:#E1E4E8\">>({</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  script: </span><span style=\"color:#9ECBFF\">'./worker.js'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  timeout: {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    WORKER_STARTUP: </span><span style=\"color:#79B8FF\">5000</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    WORKER_MESSAGE: </span><span style=\"color:#79B8FF\">30000</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    expensiveOperation: </span><span style=\"color:#79B8FF\">120000</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  },</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">});</span></span></code></pre>"},{"type":"html","html":"<p>See <a href=\"/isolated-workers/docs/guides/timeout-configuration\">Timeout Configuration</a> for details.</p>\n<h3>3. Clean Up Workers Properly</h3>\n<p>Leaked workers consume resources and leave socket files:</p>"},{"type":"code-block","language":"typescript","content":"const worker = await createWorker<Messages>({ script: './worker.js' });\n\ntry {\n  await doWork(worker);\n} finally {\n  await worker.close(); // Always clean up\n}","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> worker</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/create-worker\" class=\"code-link\" title=\"View createWorker documentation\">createWorker</a></span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">Messages</span><span style=\"color:#E1E4E8\">>({ script: </span><span style=\"color:#9ECBFF\">'./worker.js'</span><span style=\"color:#E1E4E8\"> });</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">try</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  await</span><span style=\"color:#B392F0\"> doWork</span><span style=\"color:#E1E4E8\">(worker);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">} </span><span style=\"color:#F97583\">finally</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  await</span><span style=\"color:#E1E4E8\"> worker.</span><span style=\"color:#B392F0\">close</span><span style=\"color:#E1E4E8\">(); </span><span style=\"color:#6A737D\">// Always clean up</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>"},{"type":"html","html":"<p>For long-lived applications, track all workers and clean up on shutdown:</p>"},{"type":"code-block","language":"typescript","content":"const workers: WorkerClient<Messages>[] = [];\n\nprocess.on('SIGTERM', async () => {\n  await Promise.all(workers.map((w) => w.close()));\n  process.exit(0);\n});","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> workers</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/worker-client\" class=\"code-link\" title=\"View WorkerClient documentation\">WorkerClient</a></span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">Messages</span><span style=\"color:#E1E4E8\">>[] </span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\"> [];</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">process.</span><span style=\"color:#B392F0\">on</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'SIGTERM'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#F97583\">async</span><span style=\"color:#E1E4E8\"> () </span><span style=\"color:#F97583\">=></span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  await</span><span style=\"color:#79B8FF\"> Promise</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">all</span><span style=\"color:#E1E4E8\">(workers.</span><span style=\"color:#B392F0\">map</span><span style=\"color:#E1E4E8\">((</span><span style=\"color:#FFAB70\">w</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#F97583\">=></span><span style=\"color:#E1E4E8\"> w.</span><span style=\"color:#B392F0\">close</span><span style=\"color:#E1E4E8\">()));</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  process.</span><span style=\"color:#B392F0\">exit</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#79B8FF\">0</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">});</span></span></code></pre>"},{"type":"html","html":"<h3>4. Limit Worker Permissions When Possible</h3>\n<p>Run workers with reduced privileges:</p>"},{"type":"code-block","language":"typescript","content":"// Drop privileges in worker after startup\n// (Linux only, requires starting as root)\nif (process.getuid() === 0) {\n  process.setgid(1000);\n  process.setuid(1000);\n}","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// Drop privileges in worker after startup</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// (Linux only, requires starting as root)</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">if</span><span style=\"color:#E1E4E8\"> (process.</span><span style=\"color:#B392F0\">getuid</span><span style=\"color:#E1E4E8\">() </span><span style=\"color:#F97583\">===</span><span style=\"color:#79B8FF\"> 0</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  process.</span><span style=\"color:#B392F0\">setgid</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#79B8FF\">1000</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  process.</span><span style=\"color:#B392F0\">setuid</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#79B8FF\">1000</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>"},{"type":"html","html":"<h3>5. Avoid Dynamic Script Paths</h3>\n<p>Never construct worker script paths from user input:</p>"},{"type":"code-block","language":"typescript","content":"// DANGEROUS - path injection\nconst worker = await createWorker({\n  script: `./workers/${userInput}.js`,\n});\n\n// SAFE - whitelist allowed workers\nconst allowedWorkers = {\n  image: './workers/image-processor.js',\n  pdf: './workers/pdf-generator.js',\n};\n\nconst script = allowedWorkers[userInput];\nif (!script) {\n  throw new Error('Unknown worker type');\n}\nconst worker = await createWorker({ script });","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// DANGEROUS - path injection</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> worker</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/create-worker\" class=\"code-link\" title=\"View createWorker documentation\">createWorker</a></span><span style=\"color:#E1E4E8\">({</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  script: </span><span style=\"color:#9ECBFF\">`./workers/${</span><span style=\"color:#E1E4E8\">userInput</span><span style=\"color:#9ECBFF\">}.js`</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">});</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// SAFE - whitelist allowed workers</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> allowedWorkers</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  image: </span><span style=\"color:#9ECBFF\">'./workers/image-processor.js'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  pdf: </span><span style=\"color:#9ECBFF\">'./workers/pdf-generator.js'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> script</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> allowedWorkers[userInput];</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">if</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#F97583\">!</span><span style=\"color:#E1E4E8\">script) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  throw</span><span style=\"color:#F97583\"> new</span><span style=\"color:#B392F0\"> Error</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'Unknown worker type'</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> worker</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/create-worker\" class=\"code-link\" title=\"View createWorker documentation\">createWorker</a></span><span style=\"color:#E1E4E8\">({ script });</span></span></code></pre>"},{"type":"html","html":"<h3>6. Monitor Worker Resource Usage</h3>\n<p>In production, monitor workers for anomalies:</p>"},{"type":"code-block","language":"typescript","content":"// Periodically check worker health\nsetInterval(async () => {\n  if (!worker.isActive) {\n    metrics.increment('worker.crash');\n    worker = await createWorker<Messages>({ script: './worker.js' });\n  }\n}, 5000);","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// Periodically check worker health</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">setInterval</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#F97583\">async</span><span style=\"color:#E1E4E8\"> () </span><span style=\"color:#F97583\">=></span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  if</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#F97583\">!</span><span style=\"color:#E1E4E8\">worker.isActive) {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    metrics.</span><span style=\"color:#B392F0\">increment</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'worker.crash'</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    worker </span><span style=\"color:#F97583\">=</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/create-worker\" class=\"code-link\" title=\"View createWorker documentation\">createWorker</a></span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">Messages</span><span style=\"color:#E1E4E8\">>({ script: </span><span style=\"color:#9ECBFF\">'./worker.js'</span><span style=\"color:#E1E4E8\"> });</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}, </span><span style=\"color:#79B8FF\">5000</span><span style=\"color:#E1E4E8\">);</span></span></code></pre>"},{"type":"html","html":"<h2>Summary</h2>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<table><thead><tr><th>Aspect</th><th>What isolated-workers Provides</th><th>What You Must Handle</th></tr></thead><tbody><tr><td>Memory</td><td>Complete isolation between processes</td><td>N/A</td></tr><tr><td>Crashes</td><td>Host survives worker crashes</td><td>Restart logic</td></tr><tr><td>Filesystem</td><td>N/A</td><td>Access control, path validation</td></tr><tr><td>Network</td><td>N/A</td><td>Firewall rules, if needed</td></tr><tr><td>Code execution</td><td>Process-level separation</td><td>Sandboxing for untrusted code</td></tr><tr><td>Message integrity</td><td>Type definitions</td><td>Runtime validation</td></tr><tr><td>Secrets</td><td>Environment isolation option</td><td>Avoiding secrets in payloads</td></tr></tbody></table>\n<p>isolated-workers makes it easy to run code in separate processes with type-safe communication. It does not attempt to be a security sandbox. For threat models involving untrusted code or hostile input, combine isolated-workers with appropriate security tools for your platform.</p>\n<h2>Driver Security Considerations</h2>\n<h3>child_process vs worker_threads</h3>\n<p>isolated-workers defaults to using <code class=\"inline-code\">child_process</code> for spawning workers, but you can configure it to use <code class=\"inline-code\">worker_threads</code>. Each driver has different security implications:</p>\n<p><strong>child_process (default)</strong>:</p>\n<ul>\n<li>Spawns a completely separate Node.js process with its own V8 instance</li>\n<li>Full OS-level process isolation and memory separation</li>\n<li>Can be sandboxed using OS-level mechanisms (seccomp, AppArmor, containers)</li>\n<li>Higher memory overhead per worker</li>\n<li>More isolation but slower message passing</li>\n</ul>\n<p><strong>worker_threads</strong>:</p>\n<ul>\n<li>Runs workers as threads within the same Node.js process</li>\n<li>Shared memory access between threads (can be both a feature and a risk)</li>\n<li>No OS-level process boundary</li>\n<li>Lower memory overhead and faster message passing</li>\n<li>Less isolation - thread crashes can affect the main process</li>\n<li>Cannot use OS-level sandboxing mechanisms</li>\n</ul>\n<p>When choosing a driver for security-sensitive applications:</p>\n<ul>\n<li>Use <code class=\"inline-code\">child_process</code> for running untrusted code requiring strong isolation</li>\n<li>Use <code class=\"inline-code\">worker_threads</code> for trusted code where performance and shared memory are beneficial</li>\n<li>Remember that <code class=\"inline-code\">worker_threads</code> provides no security boundary beyond code-level isolation</li>\n</ul>\n<h3>Using Resource Limits with Worker Threads</h3>\n<p>When using the <code class=\"inline-code\">worker_threads</code> driver, you can set resource limits to constrain worker resource usage:</p>"},{"type":"code-block","language":"typescript","content":"const worker = await createWorker<Messages>({\n  script: './worker.js',\n  driver: 'worker_threads',\n  resourceLimits: {\n    maxOldGenerationSizeMb: 128, // Maximum size of the heap in MB\n    maxYoungGenerationSizeMb: 16, // Maximum size of the young generation in MB\n    codeRangeSizeMb: 16, // Size of pre-allocated memory for code\n    stackSizeMb: 4, // Maximum stack size in MB\n  },\n});","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> worker</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/create-worker\" class=\"code-link\" title=\"View createWorker documentation\">createWorker</a></span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">Messages</span><span style=\"color:#E1E4E8\">>({</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  script: </span><span style=\"color:#9ECBFF\">'./worker.js'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  driver: </span><span style=\"color:#9ECBFF\">'worker_threads'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  resourceLimits: {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    maxOldGenerationSizeMb: </span><span style=\"color:#79B8FF\">128</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#6A737D\">// Maximum size of the heap in MB</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    maxYoungGenerationSizeMb: </span><span style=\"color:#79B8FF\">16</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#6A737D\">// Maximum size of the young generation in MB</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    codeRangeSizeMb: </span><span style=\"color:#79B8FF\">16</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#6A737D\">// Size of pre-allocated memory for code</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    stackSizeMb: </span><span style=\"color:#79B8FF\">4</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#6A737D\">// Maximum stack size in MB</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  },</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">});</span></span></code></pre>"},{"type":"html","html":"<p>These limits help prevent workers from consuming excessive memory:</p>\n<ul>\n<li>Set <code class=\"inline-code\">maxOldGenerationSizeMb</code> based on expected memory usage</li>\n<li>Use lower limits for multiple concurrent workers to share system memory</li>\n<li>Monitor workers that hit limits - they may be OOM or have memory leaks</li>\n<li>Limits only apply to <code class=\"inline-code\">worker_threads</code> driver (not <code class=\"inline-code\">child_process</code>)</li>\n</ul>\n<p>For <code class=\"inline-code\">child_process</code>, use OS-level resource limits via <code class=\"inline-code\">ulimit</code> or container constraints.</p>\n<h2>See Also</h2>\n<ul>\n<li><a href=\"/isolated-workers/docs/guides/error-handling\">Error Handling</a> - Handling errors across process boundaries</li>\n<li><a href=\"/isolated-workers/docs/guides/worker-lifecycle\">Worker Lifecycle</a> - Proper worker cleanup</li>\n<li><a href=\"/isolated-workers/docs/guides/timeout-configuration\">Timeout Configuration</a> - Preventing denial of service</li>\n<li><a href=\"/isolated-workers/docs/guides/custom-serializers\">Custom Serializers</a> - Encryption for sensitive data</li>\n</ul>"}]}}