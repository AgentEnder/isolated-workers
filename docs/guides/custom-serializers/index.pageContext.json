{"pageId":"/pages/docs","routeParams":{"splat":"guides/custom-serializers"},"data":{"doc":{"path":"/docs/guides/custom-serializers","filePath":"/home/runner/work/isolated-workers/isolated-workers/docs/guides/custom-serializers.md","title":"Custom Serializers","description":"Use custom serialization for binary formats, compression, or encryption","nav":{"section":"Guides","order":4}},"segments":[{"type":"html","html":"<h1>Custom Serializers</h1>\n<p>By default, isolated-workers uses JSON for message serialization. You can provide a custom serializer to use binary formats like MessagePack, add compression, or implement encryption.</p>\n<h2>The Serializer Interface</h2>\n<p>Create a custom serializer by extending the <code class=\"inline-code\"><a class=\"code-link\" href=\"/isolated-workers/isolated-workers/api/serializer\">Serializer</a></code> base class:</p>"},{"type":"code-block","language":"typescript","content":"import { Serializer } from 'isolated-workers';\n\nclass MySerializer extends Serializer {\n  serialize<T>(data: T): string | Uint8Array {\n    // Convert data to string or bytes\n  }\n\n  deserialize<T>(input: string | Uint8Array): T {\n    // Parse string or bytes back to data\n  }\n\n  // Required: custom message terminator\n  // JsonSerializer uses '\\n' by default\n  terminator = '\\n';\n}\n\n> **Note**: Terminator can also be `Uint8Array` for binary protocols.","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { <a href=\"/isolated-workers/api/serializer\" class=\"code-link\" title=\"View Serializer documentation\">Serializer</a> } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'isolated-workers'</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">class</span><span style=\"color:#B392F0\"> MySerializer</span><span style=\"color:#F97583\"> extends</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/serializer\" class=\"code-link\" title=\"View Serializer documentation\">Serializer</a></span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  serialize</span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">T</span><span style=\"color:#E1E4E8\">>(</span><span style=\"color:#FFAB70\">data</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> T</span><span style=\"color:#E1E4E8\">)</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#F97583\"> |</span><span style=\"color:#B392F0\"> Uint8Array</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    // Convert data to string or bytes</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  deserialize</span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">T</span><span style=\"color:#E1E4E8\">>(</span><span style=\"color:#FFAB70\">input</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#F97583\"> |</span><span style=\"color:#B392F0\"> Uint8Array</span><span style=\"color:#E1E4E8\">)</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> T</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    // Parse string or bytes back to data</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Required: custom message terminator</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // JsonSerializer uses '\\n' by default</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  terminator</span><span style=\"color:#F97583\"> =</span><span style=\"color:#9ECBFF\"> '</span><span style=\"color:#79B8FF\">\\n</span><span style=\"color:#9ECBFF\">'</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">></span><span style=\"color:#F97583\"> **</span><span style=\"color:#E1E4E8\">Note</span><span style=\"color:#F97583\">**</span><span style=\"color:#E1E4E8\">: Terminator can also be </span><span style=\"color:#9ECBFF\">`Uint8Array`</span><span style=\"color:#E1E4E8\"> for binary protocols.</span></span></code></pre>"},{"type":"html","html":"<h2>Example: Verbose JSON Serializer</h2>\n<p>Here's a serializer that wraps messages with metadata for debugging:</p>"},{"type":"file","filename":"serializer.ts","language":"typescript","content":"/**\n * A verbose JSON serializer that adds metadata to each message.\n * This is for demonstration - in production you might use a more\n * efficient binary format.\n */\nexport class VerboseJsonSerializer extends Serializer {\n  private static messageCount = 0;\n\n  serialize<T>(data: T): string {\n    VerboseJsonSerializer.messageCount++;\n    const wrapped = {\n      _serializer: 'VerboseJsonSerializer',\n      _messageId: VerboseJsonSerializer.messageCount,\n      _timestamp: Date.now(),\n      data,\n    };\n    return JSON.stringify(wrapped);\n  }\n\n  deserialize<T>(input: string | Uint8Array): T {\n    const str =\n      typeof input === 'string' ? input : new TextDecoder().decode(input);\n    const wrapped = JSON.parse(str) as {\n      _serializer: string;\n      _messageId: number;\n      _timestamp: number;\n      data: T;\n    };\n\n    // Log metadata (in real code, you might use this for debugging/tracing)\n    console.log(\n      `[SERIALIZER] Message #${wrapped._messageId} from ${wrapped._serializer}`\n    );\n\n    return wrapped.data;\n  }\n\n  // Custom terminator - using double newline to avoid conflicts\n  terminator = '\\n\\n';\n}","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">/**</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\"> * A verbose JSON serializer that adds metadata to each message.</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\"> * This is for demonstration - in production you might use a more</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\"> * efficient binary format.</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\"> */</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#F97583\"> class</span><span style=\"color:#B392F0\"> VerboseJsonSerializer</span><span style=\"color:#F97583\"> extends</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/serializer\" class=\"code-link\" title=\"View Serializer documentation\">Serializer</a></span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  private</span><span style=\"color:#F97583\"> static</span><span style=\"color:#FFAB70\"> messageCount</span><span style=\"color:#F97583\"> =</span><span style=\"color:#79B8FF\"> 0</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  serialize</span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">T</span><span style=\"color:#E1E4E8\">>(</span><span style=\"color:#FFAB70\">data</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> T</span><span style=\"color:#E1E4E8\">)</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    VerboseJsonSerializer.messageCount</span><span style=\"color:#F97583\">++</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> wrapped</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      _serializer: </span><span style=\"color:#9ECBFF\">'VerboseJsonSerializer'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      _messageId: VerboseJsonSerializer.messageCount,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      _timestamp: Date.</span><span style=\"color:#B392F0\">now</span><span style=\"color:#E1E4E8\">(),</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      data,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    };</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#79B8FF\"> JSON</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">stringify</span><span style=\"color:#E1E4E8\">(wrapped);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  deserialize</span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">T</span><span style=\"color:#E1E4E8\">>(</span><span style=\"color:#FFAB70\">input</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#F97583\"> |</span><span style=\"color:#B392F0\"> Uint8Array</span><span style=\"color:#E1E4E8\">)</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> T</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> str</span><span style=\"color:#F97583\"> =</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">      typeof</span><span style=\"color:#E1E4E8\"> input </span><span style=\"color:#F97583\">===</span><span style=\"color:#9ECBFF\"> 'string'</span><span style=\"color:#F97583\"> ?</span><span style=\"color:#E1E4E8\"> input </span><span style=\"color:#F97583\">:</span><span style=\"color:#F97583\"> new</span><span style=\"color:#B392F0\"> TextDecoder</span><span style=\"color:#E1E4E8\">().</span><span style=\"color:#B392F0\">decode</span><span style=\"color:#E1E4E8\">(input);</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> wrapped</span><span style=\"color:#F97583\"> =</span><span style=\"color:#79B8FF\"> JSON</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">parse</span><span style=\"color:#E1E4E8\">(str) </span><span style=\"color:#F97583\">as</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">      _serializer</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">      _messageId</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> number</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">      _timestamp</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> number</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">      data</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> T</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    };</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    // Log metadata (in real code, you might use this for debugging/tracing)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span></span>\n<span class=\"line\"><span style=\"color:#9ECBFF\">      `[SERIALIZER] Message #${</span><span style=\"color:#E1E4E8\">wrapped</span><span style=\"color:#9ECBFF\">.</span><span style=\"color:#E1E4E8\">_messageId</span><span style=\"color:#9ECBFF\">} from ${</span><span style=\"color:#E1E4E8\">wrapped</span><span style=\"color:#9ECBFF\">.</span><span style=\"color:#E1E4E8\">_serializer</span><span style=\"color:#9ECBFF\">}`</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    );</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#E1E4E8\"> wrapped.data;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Custom terminator - using double newline to avoid conflicts</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  terminator</span><span style=\"color:#F97583\"> =</span><span style=\"color:#9ECBFF\"> '</span><span style=\"color:#79B8FF\">\\n\\n</span><span style=\"color:#9ECBFF\">'</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>"},{"type":"html","html":"<h2>Using Custom Serializers</h2>\n<p><strong>Both host and worker must use the same serializer.</strong> Pass the serializer instance to both.</p>\n<p>On the host:</p>"},{"type":"file","filename":"host.ts","language":"typescript","content":"const worker = await createWorker<Messages>({\n    script: join(__dirname, 'worker.ts'),\n    timeout: 10000,\n    serializer: verboseSerializer,\n  });","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> worker</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/create-worker\" class=\"code-link\" title=\"View createWorker documentation\">createWorker</a></span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">Messages</span><span style=\"color:#E1E4E8\">>({</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    script: </span><span style=\"color:#B392F0\">join</span><span style=\"color:#E1E4E8\">(__dirname, </span><span style=\"color:#9ECBFF\">'worker.ts'</span><span style=\"color:#E1E4E8\">),</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    timeout: </span><span style=\"color:#79B8FF\">10000</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    serializer: verboseSerializer,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  });</span></span></code></pre>"},{"type":"html","html":"<p>On the worker:</p>"},{"type":"file","filename":"worker.ts","language":"typescript","content":"const server = await startWorkerServer(handlers, {\n    serializer: verboseSerializer,\n  });","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> server</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/start-worker-server\" class=\"code-link\" title=\"View startWorkerServer documentation\">startWorkerServer</a></span><span style=\"color:#E1E4E8\">(handlers, {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    serializer: verboseSerializer,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  });</span></span></code></pre>"},{"type":"html","html":"<h2>Use Cases</h2>\n<h3>Binary Formats (MessagePack, Protocol Buffers)</h3>\n<p>For better performance with large payloads:</p>"},{"type":"code-block","language":"typescript","content":"import { encode, decode } from '@msgpack/msgpack';\n\nclass MessagePackSerializer extends Serializer {\n  serialize<T>(data: T): Uint8Array {\n    return encode(data);\n  }\n\n  deserialize<T>(input: string | Uint8Array): T {\n    const bytes =\n      typeof input === 'string' ? new TextEncoder().encode(input) : input;\n    return decode(bytes) as T;\n  }\n}","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { encode, decode } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> '@msgpack/msgpack'</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">class</span><span style=\"color:#B392F0\"> MessagePackSerializer</span><span style=\"color:#F97583\"> extends</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/serializer\" class=\"code-link\" title=\"View Serializer documentation\">Serializer</a></span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  serialize</span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">T</span><span style=\"color:#E1E4E8\">>(</span><span style=\"color:#FFAB70\">data</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> T</span><span style=\"color:#E1E4E8\">)</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> Uint8Array</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#B392F0\"> encode</span><span style=\"color:#E1E4E8\">(data);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  deserialize</span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">T</span><span style=\"color:#E1E4E8\">>(</span><span style=\"color:#FFAB70\">input</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#F97583\"> |</span><span style=\"color:#B392F0\"> Uint8Array</span><span style=\"color:#E1E4E8\">)</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> T</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> bytes</span><span style=\"color:#F97583\"> =</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">      typeof</span><span style=\"color:#E1E4E8\"> input </span><span style=\"color:#F97583\">===</span><span style=\"color:#9ECBFF\"> 'string'</span><span style=\"color:#F97583\"> ?</span><span style=\"color:#F97583\"> new</span><span style=\"color:#B392F0\"> TextEncoder</span><span style=\"color:#E1E4E8\">().</span><span style=\"color:#B392F0\">encode</span><span style=\"color:#E1E4E8\">(input) </span><span style=\"color:#F97583\">:</span><span style=\"color:#E1E4E8\"> input;</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#B392F0\"> decode</span><span style=\"color:#E1E4E8\">(bytes) </span><span style=\"color:#F97583\">as</span><span style=\"color:#B392F0\"> T</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>"},{"type":"html","html":"<h3>Compression</h3>\n<p>For bandwidth-sensitive applications:</p>"},{"type":"code-block","language":"typescript","content":"import { gzipSync, gunzipSync } from 'zlib';\n\nclass CompressedSerializer extends Serializer {\n  serialize<T>(data: T): Uint8Array {\n    const json = JSON.stringify(data);\n    return gzipSync(json);\n  }\n\n  deserialize<T>(input: string | Uint8Array): T {\n    const bytes =\n      typeof input === 'string' ? new TextEncoder().encode(input) : input;\n    const json = gunzipSync(bytes).toString();\n    return JSON.parse(json) as T;\n  }\n}","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { gzipSync, gunzipSync } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'zlib'</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">class</span><span style=\"color:#B392F0\"> CompressedSerializer</span><span style=\"color:#F97583\"> extends</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/serializer\" class=\"code-link\" title=\"View Serializer documentation\">Serializer</a></span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  serialize</span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">T</span><span style=\"color:#E1E4E8\">>(</span><span style=\"color:#FFAB70\">data</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> T</span><span style=\"color:#E1E4E8\">)</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> Uint8Array</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> json</span><span style=\"color:#F97583\"> =</span><span style=\"color:#79B8FF\"> JSON</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">stringify</span><span style=\"color:#E1E4E8\">(data);</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#B392F0\"> gzipSync</span><span style=\"color:#E1E4E8\">(json);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  deserialize</span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">T</span><span style=\"color:#E1E4E8\">>(</span><span style=\"color:#FFAB70\">input</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#F97583\"> |</span><span style=\"color:#B392F0\"> Uint8Array</span><span style=\"color:#E1E4E8\">)</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> T</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> bytes</span><span style=\"color:#F97583\"> =</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">      typeof</span><span style=\"color:#E1E4E8\"> input </span><span style=\"color:#F97583\">===</span><span style=\"color:#9ECBFF\"> 'string'</span><span style=\"color:#F97583\"> ?</span><span style=\"color:#F97583\"> new</span><span style=\"color:#B392F0\"> TextEncoder</span><span style=\"color:#E1E4E8\">().</span><span style=\"color:#B392F0\">encode</span><span style=\"color:#E1E4E8\">(input) </span><span style=\"color:#F97583\">:</span><span style=\"color:#E1E4E8\"> input;</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> json</span><span style=\"color:#F97583\"> =</span><span style=\"color:#B392F0\"> gunzipSync</span><span style=\"color:#E1E4E8\">(bytes).</span><span style=\"color:#B392F0\">toString</span><span style=\"color:#E1E4E8\">();</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#79B8FF\"> JSON</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">parse</span><span style=\"color:#E1E4E8\">(json) </span><span style=\"color:#F97583\">as</span><span style=\"color:#B392F0\"> T</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>"},{"type":"html","html":"<h3>Encryption</h3>\n<p>For sensitive data crossing process boundaries:</p>"},{"type":"code-block","language":"typescript","content":"import crypto from 'crypto';\n\nclass EncryptedSerializer extends Serializer {\n  constructor(private key: Buffer, private iv: Buffer) {\n    super();\n  }\n\n  serialize<T>(data: T): string {\n    const json = JSON.stringify(data);\n    const cipher = crypto.createCipheriv('aes-256-cbc', this.key, this.iv);\n    return cipher.update(json, 'utf8', 'base64') + cipher.final('base64');\n  }\n\n  deserialize<T>(input: string | Uint8Array): T {\n    const str =\n      typeof input === 'string' ? input : new TextDecoder().decode(input);\n    const decipher = crypto.createDecipheriv('aes-256-cbc', this.key, this.iv);\n    const json =\n      decipher.update(str, 'base64', 'utf8') + decipher.final('utf8');\n    return JSON.parse(json) as T;\n  }\n}","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> crypto </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'crypto'</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">class</span><span style=\"color:#B392F0\"> EncryptedSerializer</span><span style=\"color:#F97583\"> extends</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/serializer\" class=\"code-link\" title=\"View Serializer documentation\">Serializer</a></span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  constructor</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#F97583\">private</span><span style=\"color:#FFAB70\"> key</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> Buffer</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#F97583\">private</span><span style=\"color:#FFAB70\"> iv</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> Buffer</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#79B8FF\">    super</span><span style=\"color:#E1E4E8\">();</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  serialize</span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">T</span><span style=\"color:#E1E4E8\">>(</span><span style=\"color:#FFAB70\">data</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> T</span><span style=\"color:#E1E4E8\">)</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> json</span><span style=\"color:#F97583\"> =</span><span style=\"color:#79B8FF\"> JSON</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">stringify</span><span style=\"color:#E1E4E8\">(data);</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> cipher</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> crypto.</span><span style=\"color:#B392F0\">createCipheriv</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'aes-256-cbc'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#79B8FF\">this</span><span style=\"color:#E1E4E8\">.key, </span><span style=\"color:#79B8FF\">this</span><span style=\"color:#E1E4E8\">.iv);</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#E1E4E8\"> cipher.</span><span style=\"color:#B392F0\">update</span><span style=\"color:#E1E4E8\">(json, </span><span style=\"color:#9ECBFF\">'utf8'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#9ECBFF\">'base64'</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#F97583\">+</span><span style=\"color:#E1E4E8\"> cipher.</span><span style=\"color:#B392F0\">final</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'base64'</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  deserialize</span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">T</span><span style=\"color:#E1E4E8\">>(</span><span style=\"color:#FFAB70\">input</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#F97583\"> |</span><span style=\"color:#B392F0\"> Uint8Array</span><span style=\"color:#E1E4E8\">)</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> T</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> str</span><span style=\"color:#F97583\"> =</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">      typeof</span><span style=\"color:#E1E4E8\"> input </span><span style=\"color:#F97583\">===</span><span style=\"color:#9ECBFF\"> 'string'</span><span style=\"color:#F97583\"> ?</span><span style=\"color:#E1E4E8\"> input </span><span style=\"color:#F97583\">:</span><span style=\"color:#F97583\"> new</span><span style=\"color:#B392F0\"> TextDecoder</span><span style=\"color:#E1E4E8\">().</span><span style=\"color:#B392F0\">decode</span><span style=\"color:#E1E4E8\">(input);</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> decipher</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> crypto.</span><span style=\"color:#B392F0\">createDecipheriv</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'aes-256-cbc'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#79B8FF\">this</span><span style=\"color:#E1E4E8\">.key, </span><span style=\"color:#79B8FF\">this</span><span style=\"color:#E1E4E8\">.iv);</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> json</span><span style=\"color:#F97583\"> =</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      decipher.</span><span style=\"color:#B392F0\">update</span><span style=\"color:#E1E4E8\">(str, </span><span style=\"color:#9ECBFF\">'base64'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#9ECBFF\">'utf8'</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#F97583\">+</span><span style=\"color:#E1E4E8\"> decipher.</span><span style=\"color:#B392F0\">final</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'utf8'</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#79B8FF\"> JSON</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">parse</span><span style=\"color:#E1E4E8\">(json) </span><span style=\"color:#F97583\">as</span><span style=\"color:#B392F0\"> T</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>"},{"type":"html","html":"<h2>Custom Terminators</h2>\n<p>Messages are delimited by a terminator string. The default is <code class=\"inline-code\">'\\n'</code> (newline). If your serialized data might contain newlines, use a different terminator:</p>"},{"type":"code-block","language":"typescript","content":"class MySerializer extends Serializer {\n  // Use double newline as terminator\n  terminator = '\\n\\n';\n\n  // Or use a unique sequence unlikely to appear in data\n  terminator = '\\x00\\x00END\\x00\\x00';\n}","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">class</span><span style=\"color:#B392F0\"> MySerializer</span><span style=\"color:#F97583\"> extends</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/serializer\" class=\"code-link\" title=\"View Serializer documentation\">Serializer</a></span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Use double newline as terminator</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  terminator</span><span style=\"color:#F97583\"> =</span><span style=\"color:#9ECBFF\"> '</span><span style=\"color:#79B8FF\">\\n\\n</span><span style=\"color:#9ECBFF\">'</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Or use a unique sequence unlikely to appear in data</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  terminator</span><span style=\"color:#F97583\"> =</span><span style=\"color:#9ECBFF\"> '</span><span style=\"color:#79B8FF\">\\x00\\x00</span><span style=\"color:#9ECBFF\">END</span><span style=\"color:#79B8FF\">\\x00\\x00</span><span style=\"color:#9ECBFF\">'</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>"},{"type":"html","html":"<h2>Serializer Mismatch Detection</h2>\n<p>isolated-workers detects when host and worker use different serializers. Name your serializer class to enable this:</p>"},{"type":"code-block","language":"typescript","content":"// Good - named class enables mismatch detection\nexport class VerboseJsonSerializer extends Serializer { ... }\n\n// Bad - anonymous class won't be detected properly\nexport const serializer = new (class extends Serializer { ... })();","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// Good - named class enables mismatch detection</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#F97583\"> class</span><span style=\"color:#B392F0\"> VerboseJsonSerializer</span><span style=\"color:#F97583\"> extends</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/serializer\" class=\"code-link\" title=\"View Serializer documentation\">Serializer</a></span><span style=\"color:#E1E4E8\"> { </span><span style=\"color:#F97583\">...</span><span style=\"color:#E1E4E8\"> }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Bad - anonymous class won't be detected properly</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#F97583\"> const</span><span style=\"color:#79B8FF\"> serializer</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> new</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#F97583\">class</span><span style=\"color:#F97583\"> extends</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/serializer\" class=\"code-link\" title=\"View Serializer documentation\">Serializer</a></span><span style=\"color:#E1E4E8\"> { </span><span style=\"color:#F97583\">...</span><span style=\"color:#E1E4E8\"> })();</span></span></code></pre>"},{"type":"html","html":"<h2>Best Practices</h2>\n<ol>\n<li><strong>Create singleton instances</strong> - Serializers can maintain state (like message counters)</li>\n<li><strong>Name your classes</strong> - Enables serializer mismatch detection</li>\n<li><strong>Handle both string and Uint8Array</strong> - The <code class=\"inline-code\">deserialize</code> method receives either</li>\n<li><strong>Keep serialization fast</strong> - It runs on every message</li>\n<li><strong>Test with your actual payloads</strong> - Ensure your data survives round-trip serialization</li>\n</ol>\n<h2>See Also</h2>\n<ul>\n<li>{% example-link custom-serializer %} - Complete custom serializer example</li>\n<li><a href=\"/isolated-workers/docs/guides/error-handling\">Error Handling</a> - How errors are serialized</li>\n</ul>"}]}}