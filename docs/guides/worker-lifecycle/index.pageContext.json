{"pageId":"/pages/docs","routeParams":{"splat":"guides/worker-lifecycle"},"data":{"doc":{"path":"/docs/guides/worker-lifecycle","filePath":"/home/runner/work/isolated-workers/isolated-workers/docs/guides/worker-lifecycle.md","title":"Worker Lifecycle","description":"Managing worker state, status checks, and graceful shutdown","nav":{"section":"Guides","order":5}},"segments":[{"type":"html","html":"<h1>Worker Lifecycle</h1>\n<p>Understanding of worker lifecycle helps you build robust applications that properly manage resources and handle failures gracefully.</p>\n<h2>Lifecycle Phases</h2>\n<p>A worker goes through these phases:</p>"},{"type":"code-block","language":"text","content":"createWorker() → Starting → Connected → Active → Closing → Closed\n                    ↓           ↓          ↓\n                  Error       Error      Error","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span>createWorker() → Starting → Connected → Active → Closing → Closed</span></span>\n<span class=\"line\"><span>                    ↓           ↓          ↓</span></span>\n<span class=\"line\"><span>                  Error       Error      Error</span></span></code></pre>"},{"type":"html","html":"<ol>\n<li><strong>Starting</strong>: Process spawned, waiting for socket connection</li>\n<li><strong>Connected</strong>: Socket established, ready to receive messages</li>\n<li><strong>Active</strong>: Processing messages normally</li>\n<li><strong>Closing</strong>: Graceful shutdown initiated</li>\n<li><strong>Closed</strong>: Process terminated, resources released</li>\n</ol>\n<h2>Checking Worker Status</h2>\n<p>The worker client exposes two status properties:</p>"},{"type":"file","filename":"host.ts","language":"typescript","content":"function printStatus(worker: WorkerClient) {\n  console.log(`  PID: ${worker.pid}`);\n  console.log(`  isActive: ${worker.isActive}`);\n  console.log(`  isConnected: ${worker.isConnected}`);\n}","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">function</span><span style=\"color:#B392F0\"> printStatus</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">worker</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/worker-client\" class=\"code-link\" title=\"View WorkerClient documentation\">WorkerClient</a></span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`  PID: ${</span><span style=\"color:#E1E4E8\">worker</span><span style=\"color:#9ECBFF\">.</span><span style=\"color:#E1E4E8\">pid</span><span style=\"color:#9ECBFF\">}`</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`  isActive: ${</span><span style=\"color:#E1E4E8\">worker</span><span style=\"color:#9ECBFF\">.</span><span style=\"color:#E1E4E8\">isActive</span><span style=\"color:#9ECBFF\">}`</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`  isConnected: ${</span><span style=\"color:#E1E4E8\">worker</span><span style=\"color:#9ECBFF\">.</span><span style=\"color:#E1E4E8\">isConnected</span><span style=\"color:#9ECBFF\">}`</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>"},{"type":"html","html":"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<table><thead><tr><th>Property</th><th>Description</th></tr></thead><tbody><tr><td><code class=\"inline-code\">isActive</code></td><td><code class=\"inline-code\">true</code> if worker process is alive AND connection is active</td></tr><tr><td><code class=\"inline-code\">isConnected</code></td><td><code class=\"inline-code\">true</code> if both local and channel connection states are active</td></tr></tbody></table>\n<p>A healthy worker has both <code class=\"inline-code\">isActive: true</code> and <code class=\"inline-code\">isConnected: true</code>.</p>\n<h2>Worker State Persistence</h2>\n<p>Workers maintain state across messages. Variables defined at the module level persist:</p>"},{"type":"file","filename":"worker.ts","language":"typescript","content":"// Worker state - persists across requests\nconst startTime = Date.now();\nlet requestCount = 0;\nlet counter = 0;","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// Worker state - persists across requests</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> startTime</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> Date.</span><span style=\"color:#B392F0\">now</span><span style=\"color:#E1E4E8\">();</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">let</span><span style=\"color:#E1E4E8\"> requestCount </span><span style=\"color:#F97583\">=</span><span style=\"color:#79B8FF\"> 0</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">let</span><span style=\"color:#E1E4E8\"> counter </span><span style=\"color:#F97583\">=</span><span style=\"color:#79B8FF\"> 0</span><span style=\"color:#E1E4E8\">;</span></span></code></pre>"},{"type":"html","html":"<p>Each message handler can read and modify this shared state:</p>"},{"type":"file","filename":"worker.ts","language":"typescript","content":"const handlers: Handlers<Messages> = {\n  getStatus: () => {\n    requestCount++;\n    return {\n      uptime: Date.now() - startTime,\n      requestCount,\n    };\n  },\n\n  incrementCounter: ({ amount }) => {\n    requestCount++;\n    counter += amount;\n    console.log(`Worker: Counter incremented by ${amount}, now ${counter}`);\n    return { newValue: counter };\n  },\n};","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> handlers</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/handlers\" class=\"code-link\" title=\"View Handlers documentation\">Handlers</a></span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">Messages</span><span style=\"color:#E1E4E8\">> </span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  getStatus</span><span style=\"color:#E1E4E8\">: () </span><span style=\"color:#F97583\">=></span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    requestCount</span><span style=\"color:#F97583\">++</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      uptime: Date.</span><span style=\"color:#B392F0\">now</span><span style=\"color:#E1E4E8\">() </span><span style=\"color:#F97583\">-</span><span style=\"color:#E1E4E8\"> startTime,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      requestCount,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    };</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  },</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  incrementCounter</span><span style=\"color:#E1E4E8\">: ({ </span><span style=\"color:#FFAB70\">amount</span><span style=\"color:#E1E4E8\"> }) </span><span style=\"color:#F97583\">=></span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    requestCount</span><span style=\"color:#F97583\">++</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    counter </span><span style=\"color:#F97583\">+=</span><span style=\"color:#E1E4E8\"> amount;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`Worker: Counter incremented by ${</span><span style=\"color:#E1E4E8\">amount</span><span style=\"color:#9ECBFF\">}, now ${</span><span style=\"color:#E1E4E8\">counter</span><span style=\"color:#9ECBFF\">}`</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#E1E4E8\"> { newValue: counter };</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  },</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">};</span></span></code></pre>"},{"type":"html","html":"<p>This is useful for:</p>\n<ul>\n<li>Caching computed results</li>\n<li>Tracking request counts</li>\n<li>Maintaining database connections</li>\n<li>Storing configuration loaded at startup</li>\n</ul>\n<h2>Graceful Shutdown</h2>\n<p>Always close workers when done to release resources:</p>"},{"type":"code-block","language":"typescript","content":"const worker = await createWorker<Messages>({ script: './worker.js' });\n\ntry {\n  // Use the worker\n  await worker.send('doWork', { data });\n} finally {\n  // Always close, even if an error occurred\n  await worker.close();\n}","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> worker</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/create-worker\" class=\"code-link\" title=\"View createWorker documentation\">createWorker</a></span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">Messages</span><span style=\"color:#E1E4E8\">>({ script: </span><span style=\"color:#9ECBFF\">'./worker.js'</span><span style=\"color:#E1E4E8\"> });</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">try</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Use the worker</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  await</span><span style=\"color:#E1E4E8\"> worker.</span><span style=\"color:#B392F0\">send</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'doWork'</span><span style=\"color:#E1E4E8\">, { data });</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">} </span><span style=\"color:#F97583\">finally</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Always close, even if an error occurred</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  await</span><span style=\"color:#E1E4E8\"> worker.</span><span style=\"color:#B392F0\">close</span><span style=\"color:#E1E4E8\">();</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>"},{"type":"html","html":"<p>The <code class=\"inline-code\">close()</code> method:</p>\n<ol>\n<li>Rejects all pending requests (they won't complete)</li>\n<li>Stops accepting new messages</li>\n<li>Sends SIGTERM to worker process</li>\n<li>Waits up to 5 seconds for graceful exit</li>\n<li>Force-kills worker if it doesn't exit</li>\n<li>Cleans up socket files</li>\n</ol>\n<h2>Sending After Close</h2>\n<p>Attempting to send a message after closing throws an error:</p>"},{"type":"file","filename":"host.ts","language":"typescript","content":"// Attempting to send after close should fail\n    console.log('--- Attempting Request After Close ---');\n    try {\n      await worker.send('getStatus', {});\n      console.log('ERROR: Should have thrown!');\n    } catch (err) {\n      console.log(`Expected error: ${(err as Error).message}`);\n    }","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// Attempting to send after close should fail</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'--- Attempting Request After Close ---'</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    try</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">      await</span><span style=\"color:#E1E4E8\"> worker.</span><span style=\"color:#B392F0\">send</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'getStatus'</span><span style=\"color:#E1E4E8\">, {});</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'ERROR: Should have thrown!'</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    } </span><span style=\"color:#F97583\">catch</span><span style=\"color:#E1E4E8\"> (err) {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`Expected error: ${</span><span style=\"color:#9ECBFF\">(</span><span style=\"color:#E1E4E8\">err</span><span style=\"color:#F97583\"> as</span><span style=\"color:#B392F0\"> Error</span><span style=\"color:#9ECBFF\">).</span><span style=\"color:#E1E4E8\">message</span><span style=\"color:#9ECBFF\">}`</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    }</span></span></code></pre>"},{"type":"html","html":"<p>Check <code class=\"inline-code\">isActive</code> before sending if you're unsure of the worker's state:</p>"},{"type":"code-block","language":"typescript","content":"if (worker.isActive) {\n  await worker.send('message', payload);\n} else {\n  console.log('Worker is not available');\n}","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">if</span><span style=\"color:#E1E4E8\"> (worker.isActive) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  await</span><span style=\"color:#E1E4E8\"> worker.</span><span style=\"color:#B392F0\">send</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'message'</span><span style=\"color:#E1E4E8\">, payload);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">} </span><span style=\"color:#F97583\">else</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'Worker is not available'</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>"},{"type":"html","html":"<h2>Timeout Configuration</h2>\n<p>Workers support built-in timeout keys for controlling worker startup, connection, and message timeouts:</p>\n<ul>\n<li><code class=\"inline-code\">WORKER_STARTUP</code>: Time to wait for worker process to start (default: 10 seconds)</li>\n<li><code class=\"inline-code\">SERVER_CONNECT</code>: Time for server to wait for host connection (default: 30 seconds)</li>\n<li><code class=\"inline-code\">WORKER_MESSAGE</code>: Default timeout for all messages (default: 5 minutes)</li>\n</ul>\n<p>For detailed timeout setup and per-message-type overrides, see <a href=\"/isolated-workers/docs/guides/timeout-configuration\">Timeout Configuration</a>.</p>\n<h2>Handling Worker Crashes</h2>\n<p>If the worker process crashes unexpectedly:</p>\n<ul>\n<li><code class=\"inline-code\">isActive</code> becomes <code class=\"inline-code\">false</code></li>\n<li><code class=\"inline-code\">isConnected</code> becomes <code class=\"inline-code\">false</code></li>\n<li>Pending messages reject with an error</li>\n<li>The socket is cleaned up automatically</li>\n</ul>\n<p>Detect crashes by checking status or catching send errors:</p>"},{"type":"code-block","language":"typescript","content":"try {\n  await worker.send('work', data);\n} catch (error) {\n  if (!worker.isActive) {\n    console.log('Worker crashed, restarting...');\n    worker = await createWorker<Messages>({ script: './worker.js' });\n    await worker.send('work', data);\n  }\n}","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">try</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  await</span><span style=\"color:#E1E4E8\"> worker.</span><span style=\"color:#B392F0\">send</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'work'</span><span style=\"color:#E1E4E8\">, data);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">} </span><span style=\"color:#F97583\">catch</span><span style=\"color:#E1E4E8\"> (error) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  if</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#F97583\">!</span><span style=\"color:#E1E4E8\">worker.isActive) {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'Worker crashed, restarting...'</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    worker </span><span style=\"color:#F97583\">=</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/create-worker\" class=\"code-link\" title=\"View createWorker documentation\">createWorker</a></span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">Messages</span><span style=\"color:#E1E4E8\">>({ script: </span><span style=\"color:#9ECBFF\">'./worker.js'</span><span style=\"color:#E1E4E8\"> });</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    await</span><span style=\"color:#E1E4E8\"> worker.</span><span style=\"color:#B392F0\">send</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'work'</span><span style=\"color:#E1E4E8\">, data);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>"},{"type":"html","html":"<h2>Worker-Side Shutdown Handling</h2>\n<p>Workers can handle SIGTERM to clean up before exit:</p>"},{"type":"code-block","language":"typescript","content":"process.on('SIGTERM', async () => {\n  console.log('Shutting down gracefully...');\n\n  // Close database connections\n  await db.close();\n\n  // Stop the worker server\n  await server.stop();\n\n  process.exit(0);\n});","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#E1E4E8\">process.</span><span style=\"color:#B392F0\">on</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'SIGTERM'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#F97583\">async</span><span style=\"color:#E1E4E8\"> () </span><span style=\"color:#F97583\">=></span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'Shutting down gracefully...'</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Close database connections</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  await</span><span style=\"color:#E1E4E8\"> db.</span><span style=\"color:#B392F0\">close</span><span style=\"color:#E1E4E8\">();</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Stop the worker server</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  await</span><span style=\"color:#E1E4E8\"> server.</span><span style=\"color:#B392F0\">stop</span><span style=\"color:#E1E4E8\">();</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  process.</span><span style=\"color:#B392F0\">exit</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#79B8FF\">0</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">});</span></span></code></pre>"},{"type":"html","html":"<h2>Best Practices</h2>\n<h3>1. Use try/finally for Cleanup</h3>"},{"type":"code-block","language":"typescript","content":"const worker = await createWorker<Messages>({ script: './worker.js' });\ntry {\n  await processAllItems(worker);\n} finally {\n  await worker.close();\n}","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> worker</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/create-worker\" class=\"code-link\" title=\"View createWorker documentation\">createWorker</a></span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">Messages</span><span style=\"color:#E1E4E8\">>({ script: </span><span style=\"color:#9ECBFF\">'./worker.js'</span><span style=\"color:#E1E4E8\"> });</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">try</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  await</span><span style=\"color:#B392F0\"> processAllItems</span><span style=\"color:#E1E4E8\">(worker);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">} </span><span style=\"color:#F97583\">finally</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  await</span><span style=\"color:#E1E4E8\"> worker.</span><span style=\"color:#B392F0\">close</span><span style=\"color:#E1E4E8\">();</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>"},{"type":"html","html":"<h3>2. Check Status Before Long Operations</h3>"},{"type":"code-block","language":"typescript","content":"async function processItems(worker: WorkerClient<Messages>, items: Item[]) {\n  for (const item of items) {\n    if (!worker.isActive) {\n      throw new Error('Worker died during processing');\n    }\n    await worker.send('process', item);\n  }\n}","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">async</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> processItems</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">worker</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/worker-client\" class=\"code-link\" title=\"View WorkerClient documentation\">WorkerClient</a></span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">Messages</span><span style=\"color:#E1E4E8\">>, </span><span style=\"color:#FFAB70\">items</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> Item</span><span style=\"color:#E1E4E8\">[]) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  for</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> item</span><span style=\"color:#F97583\"> of</span><span style=\"color:#E1E4E8\"> items) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    if</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#F97583\">!</span><span style=\"color:#E1E4E8\">worker.isActive) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">      throw</span><span style=\"color:#F97583\"> new</span><span style=\"color:#B392F0\"> Error</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'Worker died during processing'</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    }</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    await</span><span style=\"color:#E1E4E8\"> worker.</span><span style=\"color:#B392F0\">send</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'process'</span><span style=\"color:#E1E4E8\">, item);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>"},{"type":"html","html":"<h3>3. Implement Health Checks</h3>"},{"type":"code-block","language":"typescript","content":"async function healthCheck(worker: WorkerClient<Messages>): Promise<boolean> {\n  if (!worker.isActive || !worker.isConnected) {\n    return false;\n  }\n  try {\n    await worker.send('ping', {});\n    return true;\n  } catch {\n    return false;\n  }\n}","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">async</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> healthCheck</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">worker</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/worker-client\" class=\"code-link\" title=\"View WorkerClient documentation\">WorkerClient</a></span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">Messages</span><span style=\"color:#E1E4E8\">>)</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> Promise</span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#79B8FF\">boolean</span><span style=\"color:#E1E4E8\">> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  if</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#F97583\">!</span><span style=\"color:#E1E4E8\">worker.isActive </span><span style=\"color:#F97583\">||</span><span style=\"color:#F97583\"> !</span><span style=\"color:#E1E4E8\">worker.isConnected) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#79B8FF\"> false</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  try</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    await</span><span style=\"color:#E1E4E8\"> worker.</span><span style=\"color:#B392F0\">send</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'ping'</span><span style=\"color:#E1E4E8\">, {});</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#79B8FF\"> true</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  } </span><span style=\"color:#F97583\">catch</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#79B8FF\"> false</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>"},{"type":"html","html":"<h3>4. Don't Store Worker References Long-Term</h3>\n<p>Workers can crash. Store the creation parameters instead:</p>"},{"type":"code-block","language":"typescript","content":"// Instead of storing the worker\nconst workerConfig = { script: './worker.js', timeout: 10000 };\n\nasync function getWorker() {\n  return createWorker<Messages>(workerConfig);\n}","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// Instead of storing the worker</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> workerConfig</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> { script: </span><span style=\"color:#9ECBFF\">'./worker.js'</span><span style=\"color:#E1E4E8\">, timeout: </span><span style=\"color:#79B8FF\">10000</span><span style=\"color:#E1E4E8\"> };</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">async</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> getWorker</span><span style=\"color:#E1E4E8\">() {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  return</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/create-worker\" class=\"code-link\" title=\"View createWorker documentation\">createWorker</a></span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">Messages</span><span style=\"color:#E1E4E8\">>(workerConfig);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>"},{"type":"html","html":"<h2>See Also</h2>\n<ul>\n<li>{% example-link worker-lifecycle %} - Complete lifecycle example</li>\n<li><a href=\"/isolated-workers/docs/guides/timeout-configuration\">Timeout Configuration</a> - Configuring startup and message timeouts</li>\n<li><a href=\"/isolated-workers/docs/guides/error-handling\">Error Handling</a> - Handling worker errors</li>\n</ul>"}]}}