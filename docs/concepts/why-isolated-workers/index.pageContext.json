{"pageId":"/pages/docs","routeParams":{"splat":"concepts/why-isolated-workers"},"data":{"doc":{"path":"/docs/concepts/why-isolated-workers","filePath":"/home/runner/work/isolated-workers/isolated-workers/docs/concepts/why-isolated-workers.md","title":"Why isolated-workers?","description":"When and why to use isolated-workers over alternatives","nav":{"section":"Concepts","order":1}},"segments":[{"type":"html","html":"<h1>Why isolated-workers?</h1>\n<p>Node.js runs JavaScript in a single-threaded event loop. While this model works well for I/O-bound operations, CPU-intensive tasks can block of event loop and degrade the responsiveness of your application.</p>\n<h2>The Problem</h2>\n<p>Consider a web server that needs to parse large JSON files, compress images, or run complex calculations. While these operations run, the server cannot:</p>\n<ul>\n<li>Accept new connections</li>\n<li>Process other requests</li>\n<li>Respond to health checks</li>\n</ul>"},{"type":"code-block","language":"typescript","content":"// This blocks the event loop for all other operations\napp.post('/process', (req, res) => {\n  const result = expensiveComputation(req.body); // Blocks everything\n  res.json(result);\n});","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// This blocks the event loop for all other operations</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">app.</span><span style=\"color:#B392F0\">post</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'/process'</span><span style=\"color:#E1E4E8\">, (</span><span style=\"color:#FFAB70\">req</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">res</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#F97583\">=></span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> result</span><span style=\"color:#F97583\"> =</span><span style=\"color:#B392F0\"> expensiveComputation</span><span style=\"color:#E1E4E8\">(req.body); </span><span style=\"color:#6A737D\">// Blocks everything</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  res.</span><span style=\"color:#B392F0\">json</span><span style=\"color:#E1E4E8\">(result);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">});</span></span></code></pre>"},{"type":"html","html":"<p>The standard solution is to move CPU-intensive work to a separate process. Node.js provides two built-in options: <code class=\"inline-code\">worker_threads</code> and <code class=\"inline-code\">child_process</code>. Both work, but require significant boilerplate for production use.</p>\n<h2>Why Not worker_threads?</h2>\n<p>Node's <code class=\"inline-code\">worker_threads</code> module provides true multi-threading with shared memory support. However, using it effectively requires substantial manual work.</p>\n<h3>No Type Safety</h3>\n<p>Communication uses <code class=\"inline-code\">postMessage()</code> with no type checking:</p>"},{"type":"code-block","language":"typescript","content":"// host.ts\nworker.postMessage({ typ: 'process', data: input }); // Typo goes unnoticed\n\n// worker.ts\nparentPort.on('message', (msg) => {\n  // msg is `any` - no autocomplete, no type errors\n  if (msg.type === 'process') {\n    // ...\n  }\n});","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// host.ts</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">worker.</span><span style=\"color:#B392F0\">postMessage</span><span style=\"color:#E1E4E8\">({ typ: </span><span style=\"color:#9ECBFF\">'process'</span><span style=\"color:#E1E4E8\">, data: input }); </span><span style=\"color:#6A737D\">// Typo goes unnoticed</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// worker.ts</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">parentPort.</span><span style=\"color:#B392F0\">on</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'message'</span><span style=\"color:#E1E4E8\">, (</span><span style=\"color:#FFAB70\">msg</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#F97583\">=></span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // msg is `any` - no autocomplete, no type errors</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  if</span><span style=\"color:#E1E4E8\"> (msg.type </span><span style=\"color:#F97583\">===</span><span style=\"color:#9ECBFF\"> 'process'</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    // ...</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">});</span></span></code></pre>"},{"type":"html","html":"<h3>Manual Message Correlation</h3>\n<p>If you send multiple requests, you need to track which response belongs to which request:</p>"},{"type":"code-block","language":"typescript","content":"// You have to build this yourself\nconst pending = new Map<string, { resolve; reject }>();\n\nworker.on('message', (msg) => {\n  const handler = pending.get(msg.id);\n  if (handler) {\n    pending.delete(msg.id);\n    handler.resolve(msg.result);\n  }\n});\n\nfunction sendRequest(data) {\n  const id = generateId();\n  return new Promise((resolve, reject) => {\n    pending.set(id, { resolve, reject });\n    worker.postMessage({ id, ...data });\n  });\n}","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// You have to build this yourself</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> pending</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> new</span><span style=\"color:#B392F0\"> Map</span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#79B8FF\">string</span><span style=\"color:#E1E4E8\">, { </span><span style=\"color:#FFAB70\">resolve</span><span style=\"color:#E1E4E8\">; </span><span style=\"color:#FFAB70\">reject</span><span style=\"color:#E1E4E8\"> }>();</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">worker.</span><span style=\"color:#B392F0\">on</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'message'</span><span style=\"color:#E1E4E8\">, (</span><span style=\"color:#FFAB70\">msg</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#F97583\">=></span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> handler</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> pending.</span><span style=\"color:#B392F0\">get</span><span style=\"color:#E1E4E8\">(msg.id);</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  if</span><span style=\"color:#E1E4E8\"> (handler) {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    pending.</span><span style=\"color:#B392F0\">delete</span><span style=\"color:#E1E4E8\">(msg.id);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    handler.</span><span style=\"color:#B392F0\">resolve</span><span style=\"color:#E1E4E8\">(msg.result);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">});</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">function</span><span style=\"color:#B392F0\"> sendRequest</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">data</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> id</span><span style=\"color:#F97583\"> =</span><span style=\"color:#B392F0\"> generateId</span><span style=\"color:#E1E4E8\">();</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  return</span><span style=\"color:#F97583\"> new</span><span style=\"color:#79B8FF\"> Promise</span><span style=\"color:#E1E4E8\">((</span><span style=\"color:#FFAB70\">resolve</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">reject</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#F97583\">=></span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    pending.</span><span style=\"color:#B392F0\">set</span><span style=\"color:#E1E4E8\">(id, { resolve, reject });</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    worker.</span><span style=\"color:#B392F0\">postMessage</span><span style=\"color:#E1E4E8\">({ id, </span><span style=\"color:#F97583\">...</span><span style=\"color:#E1E4E8\">data });</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  });</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>"},{"type":"html","html":"<h3>No Timeout Handling</h3>\n<p>Long-running operations can hang forever without manual timeout implementation:</p>"},{"type":"code-block","language":"typescript","content":"// You need to add timeout logic yourself\nfunction sendRequest(data, timeoutMs = 30000) {\n  return new Promise((resolve, reject) => {\n    const timeout = setTimeout(() => {\n      pending.delete(id);\n      reject(new Error('Request timed out'));\n    }, timeoutMs);\n\n    pending.set(id, {\n      resolve: (result) => {\n        clearTimeout(timeout);\n        resolve(result);\n      },\n      reject,\n    });\n    worker.postMessage({ id, ...data });\n  });\n}","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// You need to add timeout logic yourself</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">function</span><span style=\"color:#B392F0\"> sendRequest</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#FFAB70\">data</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">timeoutMs</span><span style=\"color:#F97583\"> =</span><span style=\"color:#79B8FF\"> 30000</span><span style=\"color:#E1E4E8\">) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  return</span><span style=\"color:#F97583\"> new</span><span style=\"color:#79B8FF\"> Promise</span><span style=\"color:#E1E4E8\">((</span><span style=\"color:#FFAB70\">resolve</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">reject</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#F97583\">=></span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> timeout</span><span style=\"color:#F97583\"> =</span><span style=\"color:#B392F0\"> setTimeout</span><span style=\"color:#E1E4E8\">(() </span><span style=\"color:#F97583\">=></span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      pending.</span><span style=\"color:#B392F0\">delete</span><span style=\"color:#E1E4E8\">(id);</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">      reject</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#F97583\">new</span><span style=\"color:#B392F0\"> Error</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'Request timed out'</span><span style=\"color:#E1E4E8\">));</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    }, timeoutMs);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    pending.</span><span style=\"color:#B392F0\">set</span><span style=\"color:#E1E4E8\">(id, {</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">      resolve</span><span style=\"color:#E1E4E8\">: (</span><span style=\"color:#FFAB70\">result</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#F97583\">=></span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">        clearTimeout</span><span style=\"color:#E1E4E8\">(timeout);</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">        resolve</span><span style=\"color:#E1E4E8\">(result);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      },</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      reject,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    });</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    worker.</span><span style=\"color:#B392F0\">postMessage</span><span style=\"color:#E1E4E8\">({ id, </span><span style=\"color:#F97583\">...</span><span style=\"color:#E1E4E8\">data });</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  });</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>"},{"type":"html","html":"<h2>Why Not child_process?</h2>\n<p>The <code class=\"inline-code\">child_process</code> module spawns separate Node.js processes. It provides better isolation than worker_threads but has similar limitations.</p>\n<h3>Lower-Level API</h3>\n<p><code class=\"inline-code\">child_process</code> provides raw stdio streams or basic IPC, requiring you to build messaging infrastructure:</p>"},{"type":"code-block","language":"typescript","content":"const child = fork('./worker.js');\n\n// Basic IPC - same problems as worker_threads\nchild.send({ type: 'process', data: input });\nchild.on('message', (msg) => {\n  // Still untyped, still need manual correlation\n});","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> child</span><span style=\"color:#F97583\"> =</span><span style=\"color:#B392F0\"> fork</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'./worker.js'</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Basic IPC - same problems as worker_threads</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">child.</span><span style=\"color:#B392F0\">send</span><span style=\"color:#E1E4E8\">({ type: </span><span style=\"color:#9ECBFF\">'process'</span><span style=\"color:#E1E4E8\">, data: input });</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">child.</span><span style=\"color:#B392F0\">on</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'message'</span><span style=\"color:#E1E4E8\">, (</span><span style=\"color:#FFAB70\">msg</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#F97583\">=></span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Still untyped, still need manual correlation</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">});</span></span></code></pre>"},{"type":"html","html":"<h3>No Structured Messaging</h3>\n<p>You get raw message passing without any structure for request/response patterns, error propagation, or lifecycle management.</p>\n<h2>What isolated-workers Provides</h2>\n<p>isolated-workers builds on these primitives to provide a complete, type-safe worker management solution.</p>\n<h3>End-to-End Type Safety</h3>\n<p>Define your messages once and get full TypeScript inference everywhere:</p>"},{"type":"code-block","language":"typescript","content":"// messages.ts\nimport type { DefineMessages } from 'isolated-workers';\n\nexport type Messages = DefineMessages<{\n  process: {\n    payload: { data: string };\n    result: { result: number };\n  };\n}>;","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// messages.ts</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#F97583\"> type</span><span style=\"color:#E1E4E8\"> { <a href=\"/isolated-workers/api/define-messages\" class=\"code-link\" title=\"View DefineMessages documentation\">DefineMessages</a> } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'isolated-workers'</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#F97583\"> type</span><span style=\"color:#B392F0\"> Messages</span><span style=\"color:#F97583\"> =</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/define-messages\" class=\"code-link\" title=\"View DefineMessages documentation\">DefineMessages</a></span><span style=\"color:#E1E4E8\">&#x3C;{</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  process</span><span style=\"color:#F97583\">:</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">    payload</span><span style=\"color:#F97583\">:</span><span style=\"color:#E1E4E8\"> { </span><span style=\"color:#FFAB70\">data</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#E1E4E8\"> };</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">    result</span><span style=\"color:#F97583\">:</span><span style=\"color:#E1E4E8\"> { </span><span style=\"color:#FFAB70\">result</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> number</span><span style=\"color:#E1E4E8\"> };</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  };</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}>;</span></span></code></pre>"},{"type":"html","html":"<p>Both host and worker get autocomplete and type checking:</p>"},{"type":"code-block","language":"typescript","content":"// host.ts - TypeScript knows the response type\nconst response = await worker.sendRequest({\n  type: 'process',\n  data: 'input',\n});\nconsole.log(response.result); // Typed as number\n\n// worker.ts - Handler must return the correct type\nimport { startWorkerServer, Handlers } from 'isolated-workers';\nimport type { Messages } from './messages.js';\n\nconst handlers: Handlers<Messages> = {\n  process: async ({ data }) => {\n    // data is typed as string\n    return { result: data.length };\n  },\n};\n\nawait startWorkerServer(handlers);","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// host.ts - TypeScript knows the response type</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> response</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> worker.</span><span style=\"color:#B392F0\">sendRequest</span><span style=\"color:#E1E4E8\">({</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  type: </span><span style=\"color:#9ECBFF\">'process'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  data: </span><span style=\"color:#9ECBFF\">'input'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">});</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(response.result); </span><span style=\"color:#6A737D\">// Typed as number</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// worker.ts - Handler must return the correct type</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { <a href=\"/isolated-workers/api/start-worker-server\" class=\"code-link\" title=\"View startWorkerServer documentation\">startWorkerServer</a>, <a href=\"/isolated-workers/api/handlers\" class=\"code-link\" title=\"View Handlers documentation\">Handlers</a> } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'isolated-workers'</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#F97583\"> type</span><span style=\"color:#E1E4E8\"> { Messages } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> './messages.js'</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> handlers</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/handlers\" class=\"code-link\" title=\"View Handlers documentation\">Handlers</a></span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">Messages</span><span style=\"color:#E1E4E8\">> </span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  process</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#F97583\">async</span><span style=\"color:#E1E4E8\"> ({ </span><span style=\"color:#FFAB70\">data</span><span style=\"color:#E1E4E8\"> }) </span><span style=\"color:#F97583\">=></span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    // data is typed as string</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#E1E4E8\"> { result: data.</span><span style=\"color:#79B8FF\">length</span><span style=\"color:#E1E4E8\"> };</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  },</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">await</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/start-worker-server\" class=\"code-link\" title=\"View startWorkerServer documentation\">startWorkerServer</a></span><span style=\"color:#E1E4E8\">(handlers);</span></span></code></pre>"},{"type":"html","html":"<h3>Automatic Request/Response Correlation</h3>\n<p>Every request is automatically tracked with a transaction ID. The infrastructure handles matching responses to requests:</p>"},{"type":"code-block","language":"typescript","content":"// Send multiple concurrent requests - they're automatically correlated\nconst [a, b, c] = await Promise.all([\n  worker.sendRequest({ type: 'process', data: 'first' }),\n  worker.sendRequest({ type: 'process', data: 'second' }),\n  worker.sendRequest({ type: 'process', data: 'third' }),\n]);","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// Send multiple concurrent requests - they're automatically correlated</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#E1E4E8\"> [</span><span style=\"color:#79B8FF\">a</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#79B8FF\">b</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#79B8FF\">c</span><span style=\"color:#E1E4E8\">] </span><span style=\"color:#F97583\">=</span><span style=\"color:#F97583\"> await</span><span style=\"color:#79B8FF\"> Promise</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#B392F0\">all</span><span style=\"color:#E1E4E8\">([</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  worker.</span><span style=\"color:#B392F0\">sendRequest</span><span style=\"color:#E1E4E8\">({ type: </span><span style=\"color:#9ECBFF\">'process'</span><span style=\"color:#E1E4E8\">, data: </span><span style=\"color:#9ECBFF\">'first'</span><span style=\"color:#E1E4E8\"> }),</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  worker.</span><span style=\"color:#B392F0\">sendRequest</span><span style=\"color:#E1E4E8\">({ type: </span><span style=\"color:#9ECBFF\">'process'</span><span style=\"color:#E1E4E8\">, data: </span><span style=\"color:#9ECBFF\">'second'</span><span style=\"color:#E1E4E8\"> }),</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  worker.</span><span style=\"color:#B392F0\">sendRequest</span><span style=\"color:#E1E4E8\">({ type: </span><span style=\"color:#9ECBFF\">'process'</span><span style=\"color:#E1E4E8\">, data: </span><span style=\"color:#9ECBFF\">'third'</span><span style=\"color:#E1E4E8\"> }),</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">]);</span></span></code></pre>"},{"type":"html","html":"<h3>Timeout Handling</h3>\n<p>Configure timeouts at the worker level or per message type:</p>"},{"type":"code-block","language":"typescript","content":"const worker = await createWorker({\n  workerPath: './worker.js',\n  timeouts: {\n    default: 30_000, // 30 seconds default\n    startup: 5_000, // 5 seconds to start\n    perMessage: {\n      heavyComputation: 300_000, // 5 minutes for specific operations\n    },\n  },\n});","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> worker</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/create-worker\" class=\"code-link\" title=\"View createWorker documentation\">createWorker</a></span><span style=\"color:#E1E4E8\">({</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  workerPath: </span><span style=\"color:#9ECBFF\">'./worker.js'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  timeouts: {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    default: </span><span style=\"color:#79B8FF\">30_000</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#6A737D\">// 30 seconds default</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    startup: </span><span style=\"color:#79B8FF\">5_000</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#6A737D\">// 5 seconds to start</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    perMessage: {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      heavyComputation: </span><span style=\"color:#79B8FF\">300_000</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#6A737D\">// 5 minutes for specific operations</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    },</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  },</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">});</span></span></code></pre>"},{"type":"html","html":"<p>Timeouts trigger automatic cleanup and clear error messages.</p>\n<h3>Middleware Support</h3>\n<p>Add cross-cutting concerns like logging, validation, or timing without modifying handlers:</p>"},{"type":"code-block","language":"typescript","content":"createWorkerHost({\n  messages,\n  middleware: [\n    // Log all messages\n    async (msg, next) => {\n      console.log('Received:', msg.type);\n      const result = await next(msg);\n      console.log('Completed:', msg.type);\n      return result;\n    },\n    // Add timing\n    async (msg, next) => {\n      const start = Date.now();\n      const result = await next(msg);\n      console.log(`${msg.type} took ${Date.now() - start}ms`);\n      return result;\n    },\n  ],\n  handlers: {\n    /* ... */\n  },\n});","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#B392F0\">createWorkerHost</span><span style=\"color:#E1E4E8\">({</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  messages,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  middleware: [</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    // Log all messages</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    async</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#FFAB70\">msg</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">next</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#F97583\">=></span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'Received:'</span><span style=\"color:#E1E4E8\">, msg.type);</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">      const</span><span style=\"color:#79B8FF\"> result</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> next</span><span style=\"color:#E1E4E8\">(msg);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'Completed:'</span><span style=\"color:#E1E4E8\">, msg.type);</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">      return</span><span style=\"color:#E1E4E8\"> result;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    },</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    // Add timing</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    async</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#FFAB70\">msg</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#FFAB70\">next</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#F97583\">=></span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">      const</span><span style=\"color:#79B8FF\"> start</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> Date.</span><span style=\"color:#B392F0\">now</span><span style=\"color:#E1E4E8\">();</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">      const</span><span style=\"color:#79B8FF\"> result</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> next</span><span style=\"color:#E1E4E8\">(msg);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`${</span><span style=\"color:#E1E4E8\">msg</span><span style=\"color:#9ECBFF\">.</span><span style=\"color:#E1E4E8\">type</span><span style=\"color:#9ECBFF\">} took ${</span><span style=\"color:#E1E4E8\">Date</span><span style=\"color:#9ECBFF\">.</span><span style=\"color:#B392F0\">now</span><span style=\"color:#9ECBFF\">() </span><span style=\"color:#F97583\">-</span><span style=\"color:#E1E4E8\"> start</span><span style=\"color:#9ECBFF\">}ms`</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">      return</span><span style=\"color:#E1E4E8\"> result;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    },</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  ],</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  handlers: {</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    /* ... */</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  },</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">});</span></span></code></pre>"},{"type":"html","html":"<h3>Cross-Platform Socket Management</h3>\n<p>isolated-workers automatically uses the best IPC mechanism for your platform:</p>\n<ul>\n<li>Unix domain sockets on Linux/macOS</li>\n<li>Named pipes on Windows</li>\n</ul>\n<p>Socket lifecycle, cleanup, and reconnection are handled automatically.</p>\n<h2>When to Use isolated-workers</h2>\n<p>isolated-workers is a good fit when you need:</p>\n<h3>CPU-Intensive Tasks</h3>\n<p>Offload heavy computation without blocking your main process:</p>\n<ul>\n<li>Image processing and resizing</li>\n<li>PDF generation</li>\n<li>Data transformation and parsing</li>\n<li>Cryptographic operations</li>\n</ul>\n<h3>Plugin Systems</h3>\n<p>Run third-party code in isolated processes:</p>\n<ul>\n<li>Build tool plugins (like Nx's isolated plugins)</li>\n<li>User-provided transformations</li>\n<li>Extensible processing pipelines</li>\n</ul>\n<h3>Sandboxed Code Execution</h3>\n<p>Execute potentially risky code with process-level isolation:</p>\n<ul>\n<li>User-submitted code evaluation</li>\n<li>Template rendering</li>\n<li>Script execution</li>\n</ul>\n<h3>Long-Running Background Jobs</h3>\n<p>Manage persistent worker processes for ongoing tasks:</p>\n<ul>\n<li>Queue processors</li>\n<li>File watchers</li>\n<li>Background sync operations</li>\n</ul>\n<h2>When NOT to Use isolated-workers</h2>\n<p>isolated-workers adds overhead that may not be justified in all scenarios.</p>\n<h3>Simple Async Operations</h3>\n<p>If your work is I/O-bound (network requests, database queries, file reads), use Promises directly. Process spawning overhead provides no benefit:</p>"},{"type":"code-block","language":"typescript","content":"// Just use async/await - no worker needed\nconst data = await fetch(url);\nconst result = await db.query(sql);","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// Just use async/await - no worker needed</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> data</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> fetch</span><span style=\"color:#E1E4E8\">(url);</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> result</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> db.</span><span style=\"color:#B392F0\">query</span><span style=\"color:#E1E4E8\">(sql);</span></span></code></pre>"},{"type":"html","html":"<h3>Shared Memory Requirements</h3>\n<p>If you need to share large buffers between threads without copying, use <code class=\"inline-code\">worker_threads</code> with <code class=\"inline-code\">SharedArrayBuffer</code>:</p>"},{"type":"code-block","language":"typescript","content":"// When you need zero-copy shared memory\nconst buffer = new SharedArrayBuffer(1024 * 1024);\nconst worker = new Worker('./worker.js', { workerData: { buffer } });","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// When you need zero-copy shared memory</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> buffer</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> new</span><span style=\"color:#B392F0\"> SharedArrayBuffer</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#79B8FF\">1024</span><span style=\"color:#F97583\"> *</span><span style=\"color:#79B8FF\"> 1024</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> worker</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> new</span><span style=\"color:#B392F0\"> Worker</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'./worker.js'</span><span style=\"color:#E1E4E8\">, { workerData: { buffer } });</span></span></code></pre>"},{"type":"html","html":"<p>isolated-workers communicates via message passing, which involves serialization.</p>\n<h3>Very High-Frequency Messaging</h3>\n<p>If you're sending thousands of small messages per second, the serialization and IPC overhead may be significant. Consider:</p>\n<ul>\n<li>Batching messages to reduce round trips</li>\n<li>Using worker_threads with SharedArrayBuffer for high-frequency data sharing</li>\n<li>Keeping high-frequency work in the main thread if it's fast enough</li>\n</ul>\n<h2>Trade-offs Summary</h2>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n<table><thead><tr><th>Aspect</th><th>worker_threads</th><th>child_process</th><th>isolated-workers</th></tr></thead><tbody><tr><td>Type safety</td><td>Manual</td><td>Manual</td><td>Built-in</td></tr><tr><td>Message correlation</td><td>Manual</td><td>Manual</td><td>Automatic</td></tr><tr><td>Timeouts</td><td>Manual</td><td>Manual</td><td>Built-in</td></tr><tr><td>Shared memory</td><td>Yes (SharedArrayBuffer)</td><td>No</td><td>No</td></tr><tr><td>Process isolation</td><td>Same process</td><td>Full</td><td>Full</td></tr><tr><td>Setup complexity</td><td>Medium</td><td>Medium</td><td>Low</td></tr><tr><td>Overhead</td><td>Low</td><td>Medium</td><td>Medium</td></tr></tbody></table>\n<h2>See Also</h2>\n<ul>\n<li><a href=\"/isolated-workers/docs/getting-started/quick-start\">Quick Start</a> - Create your first worker</li>\n<li><a href=\"/isolated-workers/docs/guides/worker-lifecycle\">Worker Lifecycle</a> - Managing worker state</li>\n<li><a href=\"/isolated-workers/docs/guides/timeout-configuration\">Timeout Configuration</a> - Configure timeouts</li>\n</ul>"}]}}