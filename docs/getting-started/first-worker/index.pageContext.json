{"pageId":"/pages/docs","routeParams":{"splat":"getting-started/first-worker"},"data":{"doc":{"path":"/docs/getting-started/first-worker","filePath":"/home/runner/work/isolated-workers/isolated-workers/docs/getting-started/first-worker.md","title":"Building Your First Worker","description":"A complete guide to building a production-ready worker for CPU-intensive tasks","nav":{"section":"Getting Started","order":3}},"segments":[{"type":"html","html":"<h1>Building Your First Worker</h1>\n<p>A complete guide to building a production-ready worker for CPU-intensive tasks.</p>\n<h2>Use Case: Image Processing Worker</h2>\n<p>We'll build a worker that handles image processing operations. This demonstrates the key benefits of isolated-workers: offloading CPU-intensive work while maintaining type safety.</p>\n<h2>Step 1: Define the Message Contract</h2>\n<p>Create a shared types file that both host and worker will use:</p>"},{"type":"file","filename":"messages.ts","language":"typescript","content":"export type Messages = DefineMessages<{\n  // Process an image and return metadata\n  processImage: {\n    payload: {\n      imagePath: string;\n      options: { grayscale: boolean; quality: number };\n    };\n    result: {\n      width: number;\n      height: number;\n      format: string;\n      size: number;\n    };\n  };\n\n  // Batch process multiple images\n  batchProcess: {\n    payload: {\n      paths: string[];\n      options: { grayscale: boolean; quality: number };\n    };\n    result: {\n      successful: number;\n      failed: number;\n      results: Array<{ path: string; success: boolean }>;\n    };\n  };\n\n  // Get current worker status\n  getStatus: {\n    payload: Record<string, never>;\n    result: {\n      active: boolean;\n      processedCount: number;\n    };\n  };\n}>;","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#F97583\"> type</span><span style=\"color:#B392F0\"> Messages</span><span style=\"color:#F97583\"> =</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/define-messages\" class=\"code-link\" title=\"View DefineMessages documentation\">DefineMessages</a></span><span style=\"color:#E1E4E8\">&#x3C;{</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Process an image and return metadata</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  processImage</span><span style=\"color:#F97583\">:</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">    payload</span><span style=\"color:#F97583\">:</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">      imagePath</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">      options</span><span style=\"color:#F97583\">:</span><span style=\"color:#E1E4E8\"> { </span><span style=\"color:#FFAB70\">grayscale</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> boolean</span><span style=\"color:#E1E4E8\">; </span><span style=\"color:#FFAB70\">quality</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> number</span><span style=\"color:#E1E4E8\"> };</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    };</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">    result</span><span style=\"color:#F97583\">:</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">      width</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> number</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">      height</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> number</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">      format</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">      size</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> number</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    };</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  };</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Batch process multiple images</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  batchProcess</span><span style=\"color:#F97583\">:</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">    payload</span><span style=\"color:#F97583\">:</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">      paths</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#E1E4E8\">[];</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">      options</span><span style=\"color:#F97583\">:</span><span style=\"color:#E1E4E8\"> { </span><span style=\"color:#FFAB70\">grayscale</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> boolean</span><span style=\"color:#E1E4E8\">; </span><span style=\"color:#FFAB70\">quality</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> number</span><span style=\"color:#E1E4E8\"> };</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    };</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">    result</span><span style=\"color:#F97583\">:</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">      successful</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> number</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">      failed</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> number</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">      results</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> Array</span><span style=\"color:#E1E4E8\">&#x3C;{ </span><span style=\"color:#FFAB70\">path</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> string</span><span style=\"color:#E1E4E8\">; </span><span style=\"color:#FFAB70\">success</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> boolean</span><span style=\"color:#E1E4E8\"> }>;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    };</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  };</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Get current worker status</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  getStatus</span><span style=\"color:#F97583\">:</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">    payload</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> Record</span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#79B8FF\">string</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#79B8FF\">never</span><span style=\"color:#E1E4E8\">>;</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">    result</span><span style=\"color:#F97583\">:</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">      active</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> boolean</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">      processedCount</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> number</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    };</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  };</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}>;</span></span></code></pre>"},{"type":"html","html":"<h2>Step 2: Implement the Worker</h2>\n<p>Create the worker script with handlers for each message type:</p>"},{"type":"file","filename":"worker.ts","language":"typescript","content":"const handlers: Handlers<Messages> = {\n  processImage: async ({ imagePath }) => {\n    // Simulate image processing (replace with real logic)\n    console.log(`Processing: ${imagePath}`);\n\n    // In a real implementation, you would use sharp, jimp, or similar\n    await simulateProcessing();\n\n    processedCount++;\n\n    return {\n      width: 1920,\n      height: 1080,\n      format: 'jpeg',\n      size: 256000,\n    };\n  },\n\n  batchProcess: async ({ paths }) => {\n    const results = [];\n\n    for (const path of paths) {\n      try {\n        await simulateProcessing();\n        results.push({ path, success: true });\n      } catch {\n        results.push({ path, success: false });\n      }\n    }\n\n    return {\n      successful: results.filter((r) => r.success).length,\n      failed: results.filter((r) => !r.success).length,\n      results,\n    };\n  },\n\n  getStatus: async () => {\n    return {\n      active: true,\n      processedCount,\n    };\n  },\n};","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> handlers</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/handlers\" class=\"code-link\" title=\"View Handlers documentation\">Handlers</a></span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">Messages</span><span style=\"color:#E1E4E8\">> </span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  processImage</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#F97583\">async</span><span style=\"color:#E1E4E8\"> ({ </span><span style=\"color:#FFAB70\">imagePath</span><span style=\"color:#E1E4E8\"> }) </span><span style=\"color:#F97583\">=></span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    // Simulate image processing (replace with real logic)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`Processing: ${</span><span style=\"color:#E1E4E8\">imagePath</span><span style=\"color:#9ECBFF\">}`</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    // In a real implementation, you would use sharp, jimp, or similar</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    await</span><span style=\"color:#B392F0\"> simulateProcessing</span><span style=\"color:#E1E4E8\">();</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    processedCount</span><span style=\"color:#F97583\">++</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      width: </span><span style=\"color:#79B8FF\">1920</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      height: </span><span style=\"color:#79B8FF\">1080</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      format: </span><span style=\"color:#9ECBFF\">'jpeg'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      size: </span><span style=\"color:#79B8FF\">256000</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    };</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  },</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  batchProcess</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#F97583\">async</span><span style=\"color:#E1E4E8\"> ({ </span><span style=\"color:#FFAB70\">paths</span><span style=\"color:#E1E4E8\"> }) </span><span style=\"color:#F97583\">=></span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> results</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> [];</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">    for</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> path</span><span style=\"color:#F97583\"> of</span><span style=\"color:#E1E4E8\"> paths) {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">      try</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">        await</span><span style=\"color:#B392F0\"> simulateProcessing</span><span style=\"color:#E1E4E8\">();</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">        results.</span><span style=\"color:#B392F0\">push</span><span style=\"color:#E1E4E8\">({ path, success: </span><span style=\"color:#79B8FF\">true</span><span style=\"color:#E1E4E8\"> });</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      } </span><span style=\"color:#F97583\">catch</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">        results.</span><span style=\"color:#B392F0\">push</span><span style=\"color:#E1E4E8\">({ path, success: </span><span style=\"color:#79B8FF\">false</span><span style=\"color:#E1E4E8\"> });</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      successful: results.</span><span style=\"color:#B392F0\">filter</span><span style=\"color:#E1E4E8\">((</span><span style=\"color:#FFAB70\">r</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#F97583\">=></span><span style=\"color:#E1E4E8\"> r.success).</span><span style=\"color:#79B8FF\">length</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      failed: results.</span><span style=\"color:#B392F0\">filter</span><span style=\"color:#E1E4E8\">((</span><span style=\"color:#FFAB70\">r</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#F97583\">=></span><span style=\"color:#F97583\"> !</span><span style=\"color:#E1E4E8\">r.success).</span><span style=\"color:#79B8FF\">length</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      results,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    };</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  },</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  getStatus</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#F97583\">async</span><span style=\"color:#E1E4E8\"> () </span><span style=\"color:#F97583\">=></span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      active: </span><span style=\"color:#79B8FF\">true</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      processedCount,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    };</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  },</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">};</span></span></code></pre>"},{"type":"html","html":"<h2>Step 3: Create the Host Process</h2>\n<p>Create the main process that spawns and communicates with the worker. Note how we configure per-operation timeouts:</p>"},{"type":"file","filename":"host.ts","language":"typescript","content":"// Spawn the worker with per-operation timeouts\n  const worker = await createWorker<Messages>({\n    script: join(__dirname, 'worker.ts'),\n    // Configure timeouts for different operations\n    timeout: {\n      WORKER_STARTUP: 5000, // 5s to start\n      processImage: 30000, // 30s per image\n      batchProcess: 300000, // 5min for batch\n    },\n  });","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// Spawn the worker with per-operation timeouts</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> worker</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/create-worker\" class=\"code-link\" title=\"View createWorker documentation\">createWorker</a></span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">Messages</span><span style=\"color:#E1E4E8\">>({</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    script: </span><span style=\"color:#B392F0\">join</span><span style=\"color:#E1E4E8\">(__dirname, </span><span style=\"color:#9ECBFF\">'worker.ts'</span><span style=\"color:#E1E4E8\">),</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    // Configure timeouts for different operations</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    timeout: {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      WORKER_STARTUP: </span><span style=\"color:#79B8FF\">5000</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#6A737D\">// 5s to start</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      processImage: </span><span style=\"color:#79B8FF\">30000</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#6A737D\">// 30s per image</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      batchProcess: </span><span style=\"color:#79B8FF\">300000</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#6A737D\">// 5min for batch</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    },</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  });</span></span></code></pre>"},{"type":"html","html":"<p>Now use the worker to process images:</p>"},{"type":"file","filename":"host.ts","language":"typescript","content":"// Process a single image\n    const metadata = await worker.send('processImage', {\n      imagePath: './photo.jpg',\n      options: { grayscale: true, quality: 85 },\n    });\n    console.log('Image metadata:', metadata);","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// Process a single image</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> metadata</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> worker.</span><span style=\"color:#B392F0\">send</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'processImage'</span><span style=\"color:#E1E4E8\">, {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      imagePath: </span><span style=\"color:#9ECBFF\">'./photo.jpg'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      options: { grayscale: </span><span style=\"color:#79B8FF\">true</span><span style=\"color:#E1E4E8\">, quality: </span><span style=\"color:#79B8FF\">85</span><span style=\"color:#E1E4E8\"> },</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    });</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'Image metadata:'</span><span style=\"color:#E1E4E8\">, metadata);</span></span></code></pre>"},{"type":"html","html":"<p>Check worker status and batch process multiple images:</p>"},{"type":"file","filename":"host.ts","language":"typescript","content":"// Check worker status\n    const status = await worker.send('getStatus', {});\n    console.log('Worker status:', status);","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// Check worker status</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> status</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> worker.</span><span style=\"color:#B392F0\">send</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'getStatus'</span><span style=\"color:#E1E4E8\">, {});</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'Worker status:'</span><span style=\"color:#E1E4E8\">, status);</span></span></code></pre>"},{"type":"file","filename":"host.ts","language":"typescript","content":"// Batch process multiple images\n    const batchResult = await worker.send('batchProcess', {\n      paths: ['./a.jpg', './b.jpg', './c.jpg'],\n      options: { grayscale: false, quality: 90 },\n    });\n    console.log('Batch result:', batchResult);","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">// Batch process multiple images</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> batchResult</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> worker.</span><span style=\"color:#B392F0\">send</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'batchProcess'</span><span style=\"color:#E1E4E8\">, {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      paths: [</span><span style=\"color:#9ECBFF\">'./a.jpg'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#9ECBFF\">'./b.jpg'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#9ECBFF\">'./c.jpg'</span><span style=\"color:#E1E4E8\">],</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">      options: { grayscale: </span><span style=\"color:#79B8FF\">false</span><span style=\"color:#E1E4E8\">, quality: </span><span style=\"color:#79B8FF\">90</span><span style=\"color:#E1E4E8\"> },</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    });</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'Batch result:'</span><span style=\"color:#E1E4E8\">, batchResult);</span></span></code></pre>"},{"type":"html","html":"<h3>Built-in Timeout Keys</h3>\n<p>isolated-workers provides three built-in timeout keys:</p>\n<ul>\n<li><code class=\"inline-code\">WORKER_STARTUP</code>: Time to wait for worker process to start (default: 10 seconds)</li>\n<li><code class=\"inline-code\">SERVER_CONNECT</code>: Time for server to wait for host connection (default: 30 seconds)</li>\n<li><code class=\"inline-code\">WORKER_MESSAGE</code>: Default timeout for all messages (default: 5 minutes)</li>\n</ul>\n<p>Per-message-type timeouts (like <code class=\"inline-code\">processImage</code>) override <code class=\"inline-code\">WORKER_MESSAGE</code> for specific operations.</p>\n<p>Example:</p>"},{"type":"code-block","language":"typescript","content":"const timeout: TimeoutConfig<Messages> = {\n  // Built-in keys\n  WORKER_STARTUP: 5000, // 5s to start\n  SERVER_CONNECT: 10000, // 10s to connect\n  WORKER_MESSAGE: 60000, // 1min default for messages\n\n  // Per-message overrides\n  processImage: 30000, // 30s for image processing\n  batchProcess: 300000, // 5min for batch operations\n};","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> timeout</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/timeout-config\" class=\"code-link\" title=\"View TimeoutConfig documentation\">TimeoutConfig</a></span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">Messages</span><span style=\"color:#E1E4E8\">> </span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Built-in keys</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  WORKER_STARTUP: </span><span style=\"color:#79B8FF\">5000</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#6A737D\">// 5s to start</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  SERVER_CONNECT: </span><span style=\"color:#79B8FF\">10000</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#6A737D\">// 10s to connect</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  WORKER_MESSAGE: </span><span style=\"color:#79B8FF\">60000</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#6A737D\">// 1min default for messages</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Per-message overrides</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  processImage: </span><span style=\"color:#79B8FF\">30000</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#6A737D\">// 30s for image processing</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  batchProcess: </span><span style=\"color:#79B8FF\">300000</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#6A737D\">// 5min for batch operations</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">};</span></span></code></pre>"},{"type":"html","html":"<h3>Error Handling</h3>\n<p>Always handle errors when working with workers:</p>"},{"type":"code-block","language":"typescript","content":"const worker = await createWorker<Messages>({\n  script: './worker.js',\n});\n\ntry {\n  const result = await worker.send('add', { a: 5, b: 3 });\n  console.log(result.sum);\n} catch (err) {\n  // Handle worker errors (timeout, process crash, handler error)\n  console.error('Worker error:', err.message);\n} finally {\n  // Always close the worker when done\n  await worker.close();\n}","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> worker</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/create-worker\" class=\"code-link\" title=\"View createWorker documentation\">createWorker</a></span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">Messages</span><span style=\"color:#E1E4E8\">>({</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  script: </span><span style=\"color:#9ECBFF\">'./worker.js'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">});</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">try</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> result</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> worker.</span><span style=\"color:#B392F0\">send</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'add'</span><span style=\"color:#E1E4E8\">, { a: </span><span style=\"color:#79B8FF\">5</span><span style=\"color:#E1E4E8\">, b: </span><span style=\"color:#79B8FF\">3</span><span style=\"color:#E1E4E8\"> });</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(result.sum);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">} </span><span style=\"color:#F97583\">catch</span><span style=\"color:#E1E4E8\"> (err) {</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Handle worker errors (timeout, process crash, handler error)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  console.</span><span style=\"color:#B392F0\">error</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'Worker error:'</span><span style=\"color:#E1E4E8\">, err.message);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">} </span><span style=\"color:#F97583\">finally</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Always close the worker when done</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  await</span><span style=\"color:#E1E4E8\"> worker.</span><span style=\"color:#B392F0\">close</span><span style=\"color:#E1E4E8\">();</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>"},{"type":"html","html":"<h2>Graceful Shutdown</h2>\n<p>Always close workers when done to ensure clean shutdown:</p>"},{"type":"code-block","language":"typescript","content":"const worker = await createWorker<Messages>({\n  script: './worker.js',\n});\n\ntry {\n  await doWork(worker);\n} finally {\n  // Always close to terminate worker process and clean up resources\n  await worker.close();\n}","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> worker</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/create-worker\" class=\"code-link\" title=\"View createWorker documentation\">createWorker</a></span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">Messages</span><span style=\"color:#E1E4E8\">>({</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  script: </span><span style=\"color:#9ECBFF\">'./worker.js'</span><span style=\"color:#E1E4E8\">,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">});</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">try</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  await</span><span style=\"color:#B392F0\"> doWork</span><span style=\"color:#E1E4E8\">(worker);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">} </span><span style=\"color:#F97583\">finally</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Always close to terminate worker process and clean up resources</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  await</span><span style=\"color:#E1E4E8\"> worker.</span><span style=\"color:#B392F0\">close</span><span style=\"color:#E1E4E8\">();</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span></code></pre>"},{"type":"html","html":"<p>The <code class=\"inline-code\">close()</code> method:</p>\n<ul>\n<li>Rejects all pending requests</li>\n<li>Sends SIGTERM to worker process</li>\n<li>Waits up to 5 seconds for graceful exit</li>\n<li>Force-kills if needed</li>\n<li>Cleans up socket files</li>\n</ul>\n<p>This prevents resource leaks and orphaned processes.</p>\n<h2>Key Features Demonstrated</h2>\n<ul>\n<li><strong>Type Safety:</strong> Payload and result types are fully checked</li>\n<li><strong>Timeouts:</strong> Per-message-type timeout configuration</li>\n<li><strong>Error Handling:</strong> Try/finally ensures proper cleanup</li>\n<li><strong>Worker State:</strong> Worker maintains internal state between messages</li>\n</ul>\n<h2>Next Steps</h2>\n<p>Explore the <a href=\"/isolated-workers/docs/guides\">Guides</a> to learn more about advanced patterns, or check out the <a href=\"/isolated-workers/examples\">Examples</a> for more complete implementations.</p>"}]}}