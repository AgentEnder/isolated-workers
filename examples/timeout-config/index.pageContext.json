{"pageId":"/pages/examples/@id","routeParams":{"id":"timeout-config"},"data":{"example":{"id":"timeout-config","path":"/home/runner/work/isolated-workers/isolated-workers/examples/timeout-config","title":"Timeout Configuration","description":"Demonstrates the flexible timeout configuration system. You can set timeouts for worker startup, server connection, a default message timeout, and per-message-type timeouts for fine-grained control over long-running operations.\n","entryPoint":"host.ts","fileMap":{"./messages.ts":"messages.ts","./host.ts":"host.ts","./worker.ts":"worker.ts"},"commands":[{"command":"pnpm run:timeout-config","title":"Run the example","assertions":[{"contains":"Timeout configuration:"},{"contains":"Quick ping completed"},{"contains":"Slow process completed"},{"contains":"Worker closed successfully"}]}],"hidden":false},"segments":[{"type":"html","html":"<h1>Timeout Configuration</h1>\n<p>Demonstrates the flexible timeout configuration system. You can set timeouts for worker startup, server connection, a default message timeout, and per-message-type timeouts for fine-grained control over long-running operations.</p>"}],"files":[{"filename":"messages.ts","content":"/**\n * Shared message definitions for the timeout configuration example\n */\n\nimport { DefineMessages } from 'isolated-workers';\n\n/**\n * Message types demonstrating different timeout requirements\n */\nexport type Messages = DefineMessages<{\n  // Fast operation - should complete quickly\n  quickPing: {\n    payload: { timestamp: number };\n    result: { latency: number };\n  };\n  // Simulated slow operation\n  slowProcess: {\n    payload: { durationMs: number };\n    result: { completed: boolean; actualDuration: number };\n  };\n}>;\n","language":"typescript","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">/**</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\"> * Shared message definitions for the timeout configuration example</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\"> */</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { <a href=\"/isolated-workers/api/define-messages\" class=\"code-link\">DefineMessages</a> } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'isolated-workers'</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">/**</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\"> * Message types demonstrating different timeout requirements</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\"> */</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">export</span><span style=\"color:#F97583\"> type</span><span style=\"color:#B392F0\"> Messages</span><span style=\"color:#F97583\"> =</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/define-messages\" class=\"code-link\">DefineMessages</a></span><span style=\"color:#E1E4E8\">&#x3C;{</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Fast operation - should complete quickly</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  quickPing</span><span style=\"color:#F97583\">:</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">    payload</span><span style=\"color:#F97583\">:</span><span style=\"color:#E1E4E8\"> { </span><span style=\"color:#FFAB70\">timestamp</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> number</span><span style=\"color:#E1E4E8\"> };</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">    result</span><span style=\"color:#F97583\">:</span><span style=\"color:#E1E4E8\"> { </span><span style=\"color:#FFAB70\">latency</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> number</span><span style=\"color:#E1E4E8\"> };</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  };</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Simulated slow operation</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">  slowProcess</span><span style=\"color:#F97583\">:</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">    payload</span><span style=\"color:#F97583\">:</span><span style=\"color:#E1E4E8\"> { </span><span style=\"color:#FFAB70\">durationMs</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> number</span><span style=\"color:#E1E4E8\"> };</span></span>\n<span class=\"line\"><span style=\"color:#FFAB70\">    result</span><span style=\"color:#F97583\">:</span><span style=\"color:#E1E4E8\"> { </span><span style=\"color:#FFAB70\">completed</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> boolean</span><span style=\"color:#E1E4E8\">; </span><span style=\"color:#FFAB70\">actualDuration</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> number</span><span style=\"color:#E1E4E8\"> };</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  };</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}>;</span></span>\n<span class=\"line\"></span></code></pre>"},{"filename":"host.ts","content":"/**\n * Timeout Configuration Example - Host (Client) Side\n *\n * This example demonstrates the flexible timeout configuration:\n * - WORKER_STARTUP: Time to wait for worker to start\n * - SERVER_CONNECT: Time for server to wait for host connection\n * - WORKER_MESSAGE: Default timeout for all messages\n * - Per-message-type timeouts for fine-grained control\n */\n\nimport { createWorker, type TimeoutConfig } from 'isolated-workers';\nimport { fileURLToPath } from 'url';\nimport { dirname, join } from 'path';\nimport type { Messages } from './messages.js';\n\nconst __dirname = dirname(fileURLToPath(import.meta.url));\n\nasync function main() {\n  console.log('Starting timeout configuration example...\\n');\n\n  // Define timeout configuration\n  const timeoutConfig: TimeoutConfig<Messages> = {\n    // Worker lifecycle timeouts\n    WORKER_STARTUP: 5000, // 5 seconds to start\n    SERVER_CONNECT: 5000, // 5 seconds for server to accept connection\n\n    // Default message timeout\n    WORKER_MESSAGE: 3000, // 3 seconds default for messages\n\n    // Per-message-type timeouts (override WORKER_MESSAGE)\n    quickPing: 1000, // 1 second for quick operations\n    slowProcess: 10000, // 10 seconds for slow operations\n  };\n\n  console.log('Timeout configuration:');\n  console.log('  WORKER_STARTUP:', timeoutConfig.WORKER_STARTUP, 'ms');\n  console.log('  SERVER_CONNECT:', timeoutConfig.SERVER_CONNECT, 'ms');\n  console.log('  WORKER_MESSAGE:', timeoutConfig.WORKER_MESSAGE, 'ms');\n  console.log('  quickPing:', timeoutConfig.quickPing, 'ms');\n  console.log('  slowProcess:', timeoutConfig.slowProcess, 'ms');\n  console.log();\n\n  const worker = await createWorker<Messages>({\n    script: join(__dirname, 'worker.ts'),\n    timeout: timeoutConfig,\n  });\n\n  console.log(`Worker spawned with PID: ${worker.pid}\\n`);\n\n  try {\n    // Test 1: Quick ping (should succeed within 1s timeout)\n    console.log('--- Test 1: Quick Ping ---');\n    const pingStart = Date.now();\n    const pingResult = await worker.send('quickPing', { timestamp: pingStart });\n    console.log(`Quick ping completed in ${pingResult.latency}ms\\n`);\n\n    // Test 2: Slow process that completes within timeout\n    console.log('--- Test 2: Slow Process (within timeout) ---');\n    const slowResult = await worker.send('slowProcess', { durationMs: 500 });\n    console.log(`Slow process completed: ${slowResult.actualDuration}ms\\n`);\n\n    // Test 3: Demonstrate timeout (commented out to not fail the example)\n    // Uncomment to see timeout behavior:\n    // console.log('--- Test 3: Timeout Demo ---');\n    // await worker.send('slowProcess', { durationMs: 15000 }); // Would timeout\n\n    console.log('All operations completed successfully!');\n  } catch (err) {\n    console.error('Error:', (err as Error).message);\n  } finally {\n    await worker.close();\n    console.log('Worker closed successfully');\n  }\n}\n\nmain().catch((err) => {\n  console.error('Fatal error:', err);\n  process.exit(1);\n});\n","language":"typescript","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">/**</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\"> * Timeout Configuration Example - Host (Client) Side</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\"> *</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\"> * This example demonstrates the flexible timeout configuration:</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\"> * - WORKER_STARTUP: Time to wait for worker to start</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\"> * - SERVER_CONNECT: Time for server to wait for host connection</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\"> * - WORKER_MESSAGE: Default timeout for all messages</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\"> * - Per-message-type timeouts for fine-grained control</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\"> */</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { <a href=\"/isolated-workers/api/create-worker\" class=\"code-link\">createWorker</a>, </span><span style=\"color:#F97583\">type</span><span style=\"color:#E1E4E8\"> <a href=\"/isolated-workers/api/timeout-config\" class=\"code-link\">TimeoutConfig</a> } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'isolated-workers'</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { fileURLToPath } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'url'</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { dirname, join } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'path'</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#F97583\"> type</span><span style=\"color:#E1E4E8\"> { Messages } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> './messages.js'</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> __dirname</span><span style=\"color:#F97583\"> =</span><span style=\"color:#B392F0\"> dirname</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#B392F0\">fileURLToPath</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\">.</span><span style=\"color:#79B8FF\">meta</span><span style=\"color:#E1E4E8\">.url));</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">async</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> main</span><span style=\"color:#E1E4E8\">() {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'Starting timeout configuration example...</span><span style=\"color:#79B8FF\">\\n</span><span style=\"color:#9ECBFF\">'</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">  // Define timeout configuration</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> timeoutConfig</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/timeout-config\" class=\"code-link\">TimeoutConfig</a></span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">Messages</span><span style=\"color:#E1E4E8\">> </span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    // Worker lifecycle timeouts</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    WORKER_STARTUP: </span><span style=\"color:#79B8FF\">5000</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#6A737D\">// 5 seconds to start</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    SERVER_CONNECT: </span><span style=\"color:#79B8FF\">5000</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#6A737D\">// 5 seconds for server to accept connection</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    // Default message timeout</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    WORKER_MESSAGE: </span><span style=\"color:#79B8FF\">3000</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#6A737D\">// 3 seconds default for messages</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    // Per-message-type timeouts (override WORKER_MESSAGE)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    quickPing: </span><span style=\"color:#79B8FF\">1000</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#6A737D\">// 1 second for quick operations</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    slowProcess: </span><span style=\"color:#79B8FF\">10000</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#6A737D\">// 10 seconds for slow operations</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  };</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'Timeout configuration:'</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'  WORKER_STARTUP:'</span><span style=\"color:#E1E4E8\">, timeoutConfig.</span><span style=\"color:#79B8FF\">WORKER_STARTUP</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#9ECBFF\">'ms'</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'  SERVER_CONNECT:'</span><span style=\"color:#E1E4E8\">, timeoutConfig.</span><span style=\"color:#79B8FF\">SERVER_CONNECT</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#9ECBFF\">'ms'</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'  WORKER_MESSAGE:'</span><span style=\"color:#E1E4E8\">, timeoutConfig.</span><span style=\"color:#79B8FF\">WORKER_MESSAGE</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#9ECBFF\">'ms'</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'  quickPing:'</span><span style=\"color:#E1E4E8\">, timeoutConfig.quickPing, </span><span style=\"color:#9ECBFF\">'ms'</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'  slowProcess:'</span><span style=\"color:#E1E4E8\">, timeoutConfig.slowProcess, </span><span style=\"color:#9ECBFF\">'ms'</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">();</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> worker</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/create-worker\" class=\"code-link\">createWorker</a></span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">Messages</span><span style=\"color:#E1E4E8\">>({</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    script: </span><span style=\"color:#B392F0\">join</span><span style=\"color:#E1E4E8\">(__dirname, </span><span style=\"color:#9ECBFF\">'worker.ts'</span><span style=\"color:#E1E4E8\">),</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    timeout: timeoutConfig,</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  });</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`Worker spawned with PID: ${</span><span style=\"color:#E1E4E8\">worker</span><span style=\"color:#9ECBFF\">.</span><span style=\"color:#E1E4E8\">pid</span><span style=\"color:#9ECBFF\">}</span><span style=\"color:#79B8FF\">\\n</span><span style=\"color:#9ECBFF\">`</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  try</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    // Test 1: Quick ping (should succeed within 1s timeout)</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'--- Test 1: Quick Ping ---'</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> pingStart</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> Date.</span><span style=\"color:#B392F0\">now</span><span style=\"color:#E1E4E8\">();</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> pingResult</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> worker.</span><span style=\"color:#B392F0\">send</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'quickPing'</span><span style=\"color:#E1E4E8\">, { timestamp: pingStart });</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`Quick ping completed in ${</span><span style=\"color:#E1E4E8\">pingResult</span><span style=\"color:#9ECBFF\">.</span><span style=\"color:#E1E4E8\">latency</span><span style=\"color:#9ECBFF\">}ms</span><span style=\"color:#79B8FF\">\\n</span><span style=\"color:#9ECBFF\">`</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    // Test 2: Slow process that completes within timeout</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'--- Test 2: Slow Process (within timeout) ---'</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> slowResult</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#E1E4E8\"> worker.</span><span style=\"color:#B392F0\">send</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'slowProcess'</span><span style=\"color:#E1E4E8\">, { durationMs: </span><span style=\"color:#79B8FF\">500</span><span style=\"color:#E1E4E8\"> });</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`Slow process completed: ${</span><span style=\"color:#E1E4E8\">slowResult</span><span style=\"color:#9ECBFF\">.</span><span style=\"color:#E1E4E8\">actualDuration</span><span style=\"color:#9ECBFF\">}ms</span><span style=\"color:#79B8FF\">\\n</span><span style=\"color:#9ECBFF\">`</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    // Test 3: Demonstrate timeout (commented out to not fail the example)</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    // Uncomment to see timeout behavior:</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    // console.log('--- Test 3: Timeout Demo ---');</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\">    // await worker.send('slowProcess', { durationMs: 15000 }); // Would timeout</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'All operations completed successfully!'</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  } </span><span style=\"color:#F97583\">catch</span><span style=\"color:#E1E4E8\"> (err) {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    console.</span><span style=\"color:#B392F0\">error</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'Error:'</span><span style=\"color:#E1E4E8\">, (err </span><span style=\"color:#F97583\">as</span><span style=\"color:#B392F0\"> Error</span><span style=\"color:#E1E4E8\">).message);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  } </span><span style=\"color:#F97583\">finally</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    await</span><span style=\"color:#E1E4E8\"> worker.</span><span style=\"color:#B392F0\">close</span><span style=\"color:#E1E4E8\">();</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'Worker closed successfully'</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  }</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B392F0\">main</span><span style=\"color:#E1E4E8\">().</span><span style=\"color:#B392F0\">catch</span><span style=\"color:#E1E4E8\">((</span><span style=\"color:#FFAB70\">err</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#F97583\">=></span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  console.</span><span style=\"color:#B392F0\">error</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'Fatal error:'</span><span style=\"color:#E1E4E8\">, err);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  process.</span><span style=\"color:#B392F0\">exit</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#79B8FF\">1</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">});</span></span>\n<span class=\"line\"></span></code></pre>"},{"filename":"worker.ts","content":"/**\n * Timeout Configuration Example - Worker (Server) Side\n */\n\nimport { startWorkerServer, Handlers } from 'isolated-workers';\nimport type { Messages } from './messages.js';\n\n// Helper to simulate async work\nconst sleep = (ms: number) => new Promise((resolve) => setTimeout(resolve, ms));\n\nconst handlers: Handlers<Messages> = {\n  quickPing: ({ timestamp }) => {\n    const now = Date.now();\n    return { latency: now - timestamp };\n  },\n\n  slowProcess: async ({ durationMs }) => {\n    console.log(`Worker: Starting slow process (${durationMs}ms)`);\n    const start = Date.now();\n    await sleep(durationMs);\n    const actualDuration = Date.now() - start;\n    console.log(`Worker: Slow process completed in ${actualDuration}ms`);\n    return { completed: true, actualDuration };\n  },\n};\n\nasync function main() {\n  console.log('Worker starting...');\n\n  const server = await startWorkerServer(handlers);\n\n  console.log('Worker ready');\n\n  process.on('SIGTERM', async () => {\n    await server.stop();\n    process.exit(0);\n  });\n}\n\nmain().catch((err) => {\n  console.error('Worker error:', err);\n  process.exit(1);\n});\n","language":"typescript","highlightedHtml":"<pre class=\"shiki github-dark\" style=\"background-color:#00000000;color:#e1e4e8\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color:#6A737D\">/**</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\"> * Timeout Configuration Example - Worker (Server) Side</span></span>\n<span class=\"line\"><span style=\"color:#6A737D\"> */</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#E1E4E8\"> { <a href=\"/isolated-workers/api/start-worker-server\" class=\"code-link\">startWorkerServer</a>, <a href=\"/isolated-workers/api/handlers\" class=\"code-link\">Handlers</a> } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> 'isolated-workers'</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">import</span><span style=\"color:#F97583\"> type</span><span style=\"color:#E1E4E8\"> { Messages } </span><span style=\"color:#F97583\">from</span><span style=\"color:#9ECBFF\"> './messages.js'</span><span style=\"color:#E1E4E8\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#6A737D\">// Helper to simulate async work</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#B392F0\"> sleep</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> (</span><span style=\"color:#FFAB70\">ms</span><span style=\"color:#F97583\">:</span><span style=\"color:#79B8FF\"> number</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#F97583\">=></span><span style=\"color:#F97583\"> new</span><span style=\"color:#79B8FF\"> Promise</span><span style=\"color:#E1E4E8\">((</span><span style=\"color:#FFAB70\">resolve</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#F97583\">=></span><span style=\"color:#B392F0\"> setTimeout</span><span style=\"color:#E1E4E8\">(resolve, ms));</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">const</span><span style=\"color:#79B8FF\"> handlers</span><span style=\"color:#F97583\">:</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/handlers\" class=\"code-link\">Handlers</a></span><span style=\"color:#E1E4E8\">&#x3C;</span><span style=\"color:#B392F0\">Messages</span><span style=\"color:#E1E4E8\">> </span><span style=\"color:#F97583\">=</span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  quickPing</span><span style=\"color:#E1E4E8\">: ({ </span><span style=\"color:#FFAB70\">timestamp</span><span style=\"color:#E1E4E8\"> }) </span><span style=\"color:#F97583\">=></span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> now</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> Date.</span><span style=\"color:#B392F0\">now</span><span style=\"color:#E1E4E8\">();</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#E1E4E8\"> { latency: now </span><span style=\"color:#F97583\">-</span><span style=\"color:#E1E4E8\"> timestamp };</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  },</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B392F0\">  slowProcess</span><span style=\"color:#E1E4E8\">: </span><span style=\"color:#F97583\">async</span><span style=\"color:#E1E4E8\"> ({ </span><span style=\"color:#FFAB70\">durationMs</span><span style=\"color:#E1E4E8\"> }) </span><span style=\"color:#F97583\">=></span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`Worker: Starting slow process (${</span><span style=\"color:#E1E4E8\">durationMs</span><span style=\"color:#9ECBFF\">}ms)`</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> start</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> Date.</span><span style=\"color:#B392F0\">now</span><span style=\"color:#E1E4E8\">();</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    await</span><span style=\"color:#B392F0\"> sleep</span><span style=\"color:#E1E4E8\">(durationMs);</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    const</span><span style=\"color:#79B8FF\"> actualDuration</span><span style=\"color:#F97583\"> =</span><span style=\"color:#E1E4E8\"> Date.</span><span style=\"color:#B392F0\">now</span><span style=\"color:#E1E4E8\">() </span><span style=\"color:#F97583\">-</span><span style=\"color:#E1E4E8\"> start;</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">`Worker: Slow process completed in ${</span><span style=\"color:#E1E4E8\">actualDuration</span><span style=\"color:#9ECBFF\">}ms`</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    return</span><span style=\"color:#E1E4E8\"> { completed: </span><span style=\"color:#79B8FF\">true</span><span style=\"color:#E1E4E8\">, actualDuration };</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  },</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">async</span><span style=\"color:#F97583\"> function</span><span style=\"color:#B392F0\"> main</span><span style=\"color:#E1E4E8\">() {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'Worker starting...'</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#F97583\">  const</span><span style=\"color:#79B8FF\"> server</span><span style=\"color:#F97583\"> =</span><span style=\"color:#F97583\"> await</span><span style=\"color:#B392F0\"> <a href=\"/isolated-workers/api/start-worker-server\" class=\"code-link\">startWorkerServer</a></span><span style=\"color:#E1E4E8\">(handlers);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  console.</span><span style=\"color:#B392F0\">log</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'Worker ready'</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  process.</span><span style=\"color:#B392F0\">on</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'SIGTERM'</span><span style=\"color:#E1E4E8\">, </span><span style=\"color:#F97583\">async</span><span style=\"color:#E1E4E8\"> () </span><span style=\"color:#F97583\">=></span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#F97583\">    await</span><span style=\"color:#E1E4E8\"> server.</span><span style=\"color:#B392F0\">stop</span><span style=\"color:#E1E4E8\">();</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">    process.</span><span style=\"color:#B392F0\">exit</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#79B8FF\">0</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  });</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B392F0\">main</span><span style=\"color:#E1E4E8\">().</span><span style=\"color:#B392F0\">catch</span><span style=\"color:#E1E4E8\">((</span><span style=\"color:#FFAB70\">err</span><span style=\"color:#E1E4E8\">) </span><span style=\"color:#F97583\">=></span><span style=\"color:#E1E4E8\"> {</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  console.</span><span style=\"color:#B392F0\">error</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#9ECBFF\">'Worker error:'</span><span style=\"color:#E1E4E8\">, err);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">  process.</span><span style=\"color:#B392F0\">exit</span><span style=\"color:#E1E4E8\">(</span><span style=\"color:#79B8FF\">1</span><span style=\"color:#E1E4E8\">);</span></span>\n<span class=\"line\"><span style=\"color:#E1E4E8\">});</span></span>\n<span class=\"line\"></span></code></pre>"}],"renderedFiles":[]}}